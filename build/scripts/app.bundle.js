(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
!function(t,e){"use strict";var n=window.angulartics||(window.angulartics={});n.waitForVendorCount=0,n.waitForVendorApi=function(t,e,a,i,r){r||n.waitForVendorCount++,i||(i=a,a=void 0),!Object.prototype.hasOwnProperty.call(window,t)||void 0!==a&&void 0===window[t][a]?setTimeout(function(){n.waitForVendorApi(t,e,a,i,!0)},e):(n.waitForVendorCount--,i(window[t]))},t.module("angulartics",[]).provider("$analytics",function(){var e={pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},eventTracking:{},bufferFlushDelay:1e3,developerMode:!1},a=["pageTrack","eventTrack","setAlias","setUsername","setAlias","setUserProperties","setUserPropertiesOnce","setSuperProperties","setSuperPropertiesOnce"],i={},r={},s=function(t){return function(){n.waitForVendorCount&&(i[t]||(i[t]=[]),i[t].push(arguments))}},o=function(e,n){return r[e]||(r[e]=[]),r[e].push(n),function(){var n=arguments;t.forEach(r[e],function(t){t.apply(this,n)},this)}},u={settings:e},c=function(t,e){e?setTimeout(t,e):t()},g={$get:function(){return u},api:u,settings:e,virtualPageviews:function(t){this.settings.pageTracking.autoTrackVirtualPages=t},firstPageview:function(t){this.settings.pageTracking.autoTrackFirstPage=t},withBase:function(e){this.settings.pageTracking.basePath=e?t.element("base").attr("href").slice(0,-1):""},withAutoBase:function(t){this.settings.pageTracking.autoBasePath=t},developerMode:function(t){this.settings.developerMode=t}},f=function(n,a){u[n]=o(n,a);var r=e[n],s=r?r.bufferFlushDelay:null,g=null!==s?s:e.bufferFlushDelay;t.forEach(i[n],function(t,e){c(function(){a.apply(this,t)},e*g)})},l=function(t){return t.replace(/^./,function(t){return t.toUpperCase()})},p=function(t){var e="register"+l(t);g[e]=function(e){f(t,e)},u[t]=o(t,s(t))};return t.forEach(a,p),g}).run(["$rootScope","$window","$analytics","$injector",function(e,n,a,i){a.settings.pageTracking.autoTrackFirstPage&&i.invoke(["$location",function(t){var e=!0;if(i.has("$route")){var r=i.get("$route");for(var s in r.routes){e=!1;break}}else if(i.has("$state")){var o=i.get("$state");for(var u in o.get()){e=!1;break}}if(e)if(a.settings.pageTracking.autoBasePath&&(a.settings.pageTracking.basePath=n.location.pathname),a.settings.trackRelativePath){var c=a.settings.pageTracking.basePath+t.url();a.pageTrack(c,t)}else a.pageTrack(t.absUrl(),t)}]),a.settings.pageTracking.autoTrackVirtualPages&&i.invoke(["$location",function(t){a.settings.pageTracking.autoBasePath&&(a.settings.pageTracking.basePath=n.location.pathname+"#"),i.has("$route")&&e.$on("$routeChangeSuccess",function(e,n){if(!n||!(n.$$route||n).redirectTo){var i=a.settings.pageTracking.basePath+t.url();a.pageTrack(i,t)}}),i.has("$state")&&e.$on("$stateChangeSuccess",function(e,n){var i=a.settings.pageTracking.basePath+t.url();a.pageTrack(i,t)})}]),a.settings.developerMode&&t.forEach(a,function(t,e){"function"==typeof t&&(a[e]=function(){})})}]).directive("analyticsOn",["$analytics",function(e){function n(t){return["a:","button:","button:button","button:submit","input:button","input:submit"].indexOf(t.tagName.toLowerCase()+":"+(t.type||""))>=0}function a(t){return n(t),"click"}function i(t){return n(t)?t.innerText||t.value:t.id||t.name||t.tagName}function r(t){return"analytics"===t.substr(0,9)&&-1===["On","Event","If","Properties","EventType"].indexOf(t.substr(9))}function s(t){var e=t.slice(9);return"undefined"!=typeof e&&null!==e&&e.length>0?e.substring(0,1).toLowerCase()+e.substring(1):e}return{restrict:"A",link:function(n,o,u){var c=u.analyticsOn||a(o[0]),g={};t.forEach(u.$attr,function(t,e){r(e)&&(g[s(e)]=u[e],u.$observe(e,function(t){g[s(e)]=t}))}),t.element(o[0]).bind(c,function(a){var r=u.analyticsEvent||i(o[0]);g.eventType=a.type,u.analyticsIf&&!n.$eval(u.analyticsIf)||(u.analyticsProperties&&t.extend(g,n.$eval(u.analyticsProperties)),e.eventTrack(r,g))})}}}])}(angular);

},{}],2:[function(require,module,exports){
!function(n){function t(){var n,t;for(n=0;n<this.length;n++)t=this[n],e(t)||(u(t),a(t))}function e(n){"$$currentValue"in n||(n.$$currentValue=n.getAttribute("value"));var t=n.value,e=n.$$currentValue;return t||e?t===e:!0}function u(n){n.$$currentValue=n.value}function r(t){var e=n.jQuery||n.angular.element,u=e.prototype,r=u.val;u.val=function(n){var e=r.apply(this,arguments);return arguments.length>0&&c(this,function(e){t(e,n)}),e}}function i(n,t){function e(n){var e=n.target;t(e)}f.addEventListener(n,e,!0)}function o(n){for(;n;){if("FORM"===n.nodeName)return l(n);n=n.parentNode}return l()}function c(n,t){if(n.forEach)return n.forEach(t);var e;for(e=0;e<n.length;e++)t(n[e])}function a(t){var e=n.document,u=e.createEvent("HTMLEvents");u.initEvent("change",!0,!0),t.dispatchEvent(u)}var l=n.jQuery||n.angular.element,f=n.document.documentElement,v=l(f);i("change",u),r(u),l.prototype.checkAndTriggerAutoFillEvent=t,i("blur",function(t){n.setTimeout(function(){o(t).find("input").checkAndTriggerAutoFillEvent()},20)}),n.document.addEventListener("DOMContentLoaded",function(){c(document.getElementsByTagName("input"),u),n.setTimeout(function(){v.find("input").checkAndTriggerAutoFillEvent()},200)},!1)}(window);

},{}],3:[function(require,module,exports){
"use strict";function escapeHtml(e){var t=""+e,a=matchHtmlRegExp.exec(t);if(!a)return t;var r,c="",s=0,n=0;for(s=a.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#39;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}n!==s&&(c+=t.substring(n,s)),n=s+1,c+=r}return n!==s?c+t.substring(n,s):c}var matchHtmlRegExp=/["'&<>]/;module.exports=escapeHtml;

},{}],4:[function(require,module,exports){
var hasOwn=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,undefined,isArray=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===toStr.call(t)},isPlainObject=function(t){"use strict";if(!t||"[object Object]"!==toStr.call(t))return!1;var r=hasOwn.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&hasOwn.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!o)return!1;var n;for(n in t);return n===undefined||hasOwn.call(t,n)};module.exports=function t(){"use strict";var r,o,n,e,c,i,a=arguments[0],s=1,u=arguments.length,l=!1;for("boolean"==typeof a?(l=a,a=arguments[1]||{},s=2):("object"!=typeof a&&"function"!=typeof a||null==a)&&(a={});u>s;++s)if(r=arguments[s],null!=r)for(o in r)n=a[o],e=r[o],a!==e&&(l&&e&&(isPlainObject(e)||(c=isArray(e)))?(c?(c=!1,i=n&&isArray(n)?n:[]):i=n&&isPlainObject(n)?n:{},a[o]=t(l,i,e)):e!==undefined&&(a[o]=e));return a};

},{}],5:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};

},{}],6:[function(require,module,exports){
(function (global){
function checkGlobal(e){return e&&e.Object===Object?e:null}function isHostObject(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(a){}return t}function Hash(e){var t=-1,a=e?e.length:0;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(e){return this.has(e)&&delete this.__data__[e]}function hashGet(e){var t=this.__data__;if(nativeCreate){var a=t[e];return a===HASH_UNDEFINED?void 0:a}return hasOwnProperty.call(t,e)?t[e]:void 0}function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty.call(t,e)}function hashSet(e,t){var a=this.__data__;return a[e]=nativeCreate&&void 0===t?HASH_UNDEFINED:t,this}function ListCache(e){var t=-1,a=e?e.length:0;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(e){var t=this.__data__,a=assocIndexOf(t,e);if(0>a)return!1;var r=t.length-1;return a==r?t.pop():splice.call(t,a,1),!0}function listCacheGet(e){var t=this.__data__,a=assocIndexOf(t,e);return 0>a?void 0:t[a][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var a=this.__data__,r=assocIndexOf(a,e);return 0>r?a.push([e,t]):a[r][1]=t,this}function MapCache(e){var t=-1,a=e?e.length:0;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(e){return getMapData(this,e)["delete"](e)}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){return getMapData(this,e).set(e,t),this}function assocIndexOf(e,t){for(var a=e.length;a--;)if(eq(e[a][0],t))return a;return-1}function getMapData(e,t){var a=e.__data__;return isKeyable(t)?a["string"==typeof t?"string":"hash"]:a.map}function getNative(e,t){var a=e[t];return isNative(a)?a:void 0}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function toSource(e){if(null!=e){try{return funcToString.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function memoize(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);var a=function(){var r=arguments,o=t?t.apply(this,r):r[0],n=a.cache;if(n.has(o))return n.get(o);var i=e.apply(this,r);return a.cache=n.set(o,i),i};return a.cache=new(memoize.Cache||MapCache),a}function eq(e,t){return e===t||e!==e&&t!==t}function isFunction(e){var t=isObject(e)?objectToString.call(e):"";return t==funcTag||t==genTag}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isNative(e){if(!isObject(e))return!1;var t=isFunction(e)||isHostObject(e)?reIsNative:reIsHostCtor;return t.test(toSource(e))}function toString(e){return null==e?"":baseToString(e)}var baseToString=require("lodash._basetostring"),FUNC_ERROR_TEXT="Expected a function",HASH_UNDEFINED="__lodash_hash_undefined__",funcTag="[object Function]",genTag="[object GeneratorFunction]",rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reEscapeChar=/\\(\\)?/g,reIsHostCtor=/^\[object .+?Constructor\]$/,objectTypes={"function":!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:void 0,freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:void 0,freeGlobal=checkGlobal(freeExports&&freeModule&&"object"==typeof global&&global),freeSelf=checkGlobal(objectTypes[typeof self]&&self),freeWindow=checkGlobal(objectTypes[typeof window]&&window),thisGlobal=checkGlobal(objectTypes[typeof this]&&this),root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")(),arrayProto=Array.prototype,objectProto=Object.prototype,funcToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),splice=arrayProto.splice,Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create");Hash.prototype.clear=hashClear,Hash.prototype["delete"]=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype["delete"]=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype["delete"]=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var stringToPath=memoize(function(e){var t=[];return toString(e).replace(rePropName,function(e,a,r,o){t.push(r?o.replace(reEscapeChar,"$1"):a||e)}),t});memoize.Cache=MapCache,module.exports=stringToPath;

}).call(this,window)

},{"lodash._basetostring":7}],7:[function(require,module,exports){
(function (global){
function checkGlobal(o){return o&&o.Object===Object?o:null}function baseToString(o){if("string"==typeof o)return o;if(isSymbol(o))return symbolToString?symbolToString.call(o):"";var e=o+"";return"0"==e&&1/o==-INFINITY?"-0":e}function isObjectLike(o){return!!o&&"object"==typeof o}function isSymbol(o){return"symbol"==typeof o||isObjectLike(o)&&objectToString.call(o)==symbolTag}var INFINITY=1/0,symbolTag="[object Symbol]",objectTypes={"function":!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:void 0,freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:void 0,freeGlobal=checkGlobal(freeExports&&freeModule&&"object"==typeof global&&global),freeSelf=checkGlobal(objectTypes[typeof self]&&self),freeWindow=checkGlobal(objectTypes[typeof window]&&window),thisGlobal=checkGlobal(objectTypes[typeof this]&&this),root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,Symbol=root.Symbol,symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;module.exports=baseToString;

}).call(this,window)

},{}],8:[function(require,module,exports){
function debounce(t,e,n){function r(e){var n=l,r=v;return l=v=void 0,y=e,T=t.apply(r,n)}function i(t){return y=t,j=setTimeout(a,e),d?r(t):T}function o(t){var n=t-g,r=t-y,i=e-n;return p?nativeMin(i,m-r):i}function u(t){var n=t-g,r=t-y;return!g||n>=e||0>n||p&&r>=m}function a(){var t=now();return u(t)?c(t):void(j=setTimeout(a,o(t)))}function c(t){return clearTimeout(j),j=void 0,O&&l?r(t):(l=v=void 0,T)}function f(){void 0!==j&&clearTimeout(j),g=y=0,l=v=j=void 0}function s(){return void 0===j?T:c(now())}function b(){var t=now(),n=u(t);if(l=arguments,v=this,g=t,n){if(void 0===j)return i(g);if(p)return clearTimeout(j),j=setTimeout(a,e),r(g)}return void 0===j&&(j=setTimeout(a,e)),T}var l,v,m,T,j,g=0,y=0,d=!1,p=!1,O=!0;if("function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);return e=toNumber(e)||0,isObject(n)&&(d=!!n.leading,p="maxWait"in n,m=p?nativeMax(toNumber(n.maxWait)||0,e):m,O="trailing"in n?!!n.trailing:O),b.cancel=f,b.flush=s,b}function isFunction(t){var e=isObject(t)?objectToString.call(t):"";return e==funcTag||e==genTag}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag}function toNumber(t){if("number"==typeof t)return t;if(isSymbol(t))return NAN;if(isObject(t)){var e=isFunction(t.valueOf)?t.valueOf():t;t=isObject(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(reTrim,"");var n=reIsBinary.test(t);return n||reIsOctal.test(t)?freeParseInt(t.slice(2),n?2:8):reIsBadHex.test(t)?NAN:+t}var FUNC_ERROR_TEXT="Expected a function",NAN=NaN,funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=Date.now;module.exports=debounce;

},{}],9:[function(require,module,exports){
function baseGet(t,r){r=isKey(r,t)?[r]:castPath(r);for(var e=0,o=r.length;null!=t&&o>e;)t=t[toKey(r[e++])];return e&&e==o?t:void 0}function castPath(t){return isArray(t)?t:stringToPath(t)}function isKey(t,r){if(isArray(t))return!1;var e=typeof t;return"number"==e||"symbol"==e||"boolean"==e||null==t||isSymbol(t)?!0:reIsPlainProp.test(t)||!reIsDeepProp.test(t)||null!=r&&t in Object(r)}function toKey(t){if("string"==typeof t||isSymbol(t))return t;var r=t+"";return"0"==r&&1/t==-INFINITY?"-0":r}function isObjectLike(t){return!!t&&"object"==typeof t}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag}function get(t,r,e){var o=null==t?void 0:baseGet(t,r);return void 0===o?e:o}var stringToPath=require("lodash._stringtopath"),INFINITY=1/0,symbolTag="[object Symbol]",reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,objectProto=Object.prototype,objectToString=objectProto.toString,isArray=Array.isArray;module.exports=get;

},{"lodash._stringtopath":6}],10:[function(require,module,exports){
!function(n){"use strict";function e(){var e=n.crypto||n.msCrypto;if(!f&&e&&e.getRandomValues)try{var r=new Uint8Array(16);s=f=function(){return e.getRandomValues(r),r},f()}catch(o){}if(!f){var t=new Array(16);i=f=function(){for(var n,e=0;16>e;e++)0===(3&e)&&(n=4294967296*Math.random()),t[e]=n>>>((3&e)<<3)&255;return t},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function r(){if("function"==typeof require)try{var n=require("crypto").randomBytes;c=f=n&&function(){return n(16)},f()}catch(e){}}function o(n,e,r){var o=e&&r||0,t=0;for(e=e||[],n.toLowerCase().replace(/[0-9a-f]{2}/g,function(n){16>t&&(e[o+t++]=y[n])});16>t;)e[o+t++]=0;return e}function t(n,e){var r=e||0,o=v;return o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]}function u(n,e,r){var o=e&&r||0,u=e||[];n=n||{};var a=null!=n.clockseq?n.clockseq:g,f=null!=n.msecs?n.msecs:(new Date).getTime(),i=null!=n.nsecs?n.nsecs:C+1,c=f-h+(i-C)/1e4;if(0>c&&null==n.clockseq&&(a=a+1&16383),(0>c||f>h)&&null==n.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=f,C=i,g=a,f+=122192928e5;var s=(1e4*(268435455&f)+i)%4294967296;u[o++]=s>>>24&255,u[o++]=s>>>16&255,u[o++]=s>>>8&255,u[o++]=255&s;var l=f/4294967296*1e4&268435455;u[o++]=l>>>8&255,u[o++]=255&l,u[o++]=l>>>24&15|16,u[o++]=l>>>16&255,u[o++]=a>>>8|128,u[o++]=255&a;for(var d=n.node||w,v=0;6>v;v++)u[o+v]=d[v];return e?e:t(u)}function a(n,e,r){var o=e&&r||0;"string"==typeof n&&(e="binary"===n?new d(16):null,n=null),n=n||{};var u=n.random||(n.rng||f)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,e)for(var a=0;16>a;a++)e[o+a]=u[a];return e||t(u)}var f,i,c,s,l;n?e():r();for(var d="function"==typeof Buffer?Buffer:Array,v=[],y={},m=0;256>m;m++)v[m]=(m+256).toString(16).substr(1),y[v[m]]=m;var p=f(),w=[1|p[0],p[1],p[2],p[3],p[4],p[5]],g=16383&(p[6]<<8|p[7]),h=0,C=0,R=a;R.v1=u,R.v4=a,R.parse=o,R.unparse=t,R.BufferClass=d,R._rng=f,R._mathRNG=i,R._nodeRNG=c,R._whatwgRNG=s,"undefined"!=typeof module&&module.exports?module.exports=R:"function"==typeof define&&define.amd?define(function(){return R}):(l=n.uuid,R.noConflict=function(){return n.uuid=l,R},n.uuid=R)}("undefined"!=typeof window?window:null);

},{"crypto":undefined}],11:[function(require,module,exports){
(function (process){
(function(){var e,n,r;"undefined"!=typeof performance&&null!==performance&&performance.now?module.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(module.exports=function(){return(e()-r)/1e6},n=process.hrtime,e=function(){var e;return e=n(),1e9*e[0]+e[1]},r=e()):Date.now?(module.exports=function(){return Date.now()-r},r=Date.now()):(module.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this);

}).call(this,require('_process'))

},{"_process":12}],12:[function(require,module,exports){
function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var e=setTimeout(cleanUpNextTick);draining=!0;for(var n=queue.length;n;){for(currentQueue=queue,queue=[];++queueIndex<n;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,n=queue.length}currentQueue=null,draining=!1,clearTimeout(e)}}function Item(e,n){this.fun=e,this.array=n}function noop(){}var process=module.exports={},queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];queue.push(new Item(e,n)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],13:[function(require,module,exports){
"use strict";var strictUriEncode=require("strict-uri-encode");exports.extract=function(r){return r.split("?")[1]||""},exports.parse=function(r){return"string"!=typeof r?{}:(r=r.trim().replace(/^(\?|#|&)/,""),r?r.split("&").reduce(function(r,t){var e=t.replace(/\+/g," ").split("="),n=e.shift(),i=e.length>0?e.join("="):void 0;return n=decodeURIComponent(n),i=void 0===i?null:decodeURIComponent(i),r.hasOwnProperty(n)?Array.isArray(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i,r},{}):{})},exports.stringify=function(r){return r?Object.keys(r).sort().map(function(t){var e=r[t];return void 0===e?"":null===e?t:Array.isArray(e)?e.slice().sort().map(function(r){return strictUriEncode(t)+"="+strictUriEncode(r)}).join("&"):strictUriEncode(t)+"="+strictUriEncode(e)}).filter(function(r){return r.length>0}).join("&"):""};

},{"strict-uri-encode":33}],14:[function(require,module,exports){
(function (global){
for(var now=require("performance-now"),root="undefined"==typeof window?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix],i=0;!raf&&i<vendors.length;i++)raf=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(e){if(0===queue.length){var o=now(),a=Math.max(0,frameDuration-(o-last));last=a+o,setTimeout(function(){var e=queue.slice(0);queue.length=0;for(var o=0;o<e.length;o++)if(!e[o].cancelled)try{e[o].callback(last)}catch(a){setTimeout(function(){throw a},0)}},Math.round(a))}return queue.push({handle:++id,callback:e,cancelled:!1}),id},caf=function(e){for(var o=0;o<queue.length;o++)queue[o].handle===e&&(queue[o].cancelled=!0)}}module.exports=function(e){return raf.call(root,e)},module.exports.cancel=function(){caf.apply(root,arguments)},module.exports.polyfill=function(){root.requestAnimationFrame=raf,root.cancelAnimationFrame=caf};

}).call(this,window)

},{"performance-now":11}],15:[function(require,module,exports){
"use strict";function angularPlugin(a,n){function e(){this.$get=["$window",function(n){return a}]}function t(a){a.decorator("$exceptionHandler",["Raven","$delegate",u])}function u(a,n){return function(e,t){a.captureException(e,{extra:{cause:t}}),n(e,t)}}n=n||window.angular,n&&(n.module("ngRaven",[]).provider("Raven",e).config(["$provide",t]),a.setDataCallback(function(a,n){angularPlugin._normalizeData(a),n&&n(a)}))}var angularPattern=/^\[((?:[$a-zA-Z0-9]+:)?(?:[$a-zA-Z0-9]+))\] (.*?)\n?(\S+)$/;angularPlugin._normalizeData=function(a){var n=a.exception;if(n){n=n.values[0];var e=angularPattern.exec(n.value);e&&(n.type=e[1],n.value=e[2],a.message=n.type+": "+n.value,a.extra.angularDocs=e[3].substr(0,250))}},module.exports=angularPlugin;

},{}],16:[function(require,module,exports){
"use strict";function createThunkMiddleware(t){return function(e){var n=e.dispatch,r=e.getState;return function(e){return function(u){return"function"==typeof u?u(n,r,t):e(u)}}}}exports.__esModule=!0;var thunk=createThunkMiddleware();thunk.withExtraArgument=createThunkMiddleware,exports["default"]=thunk;

},{}],17:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function applyMiddleware(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return function(e){return function(r,n,o){var a=e(r,n,o),u=a.dispatch,p=[],i={getState:a.getState,dispatch:function(e){return u(e)}};return p=t.map(function(e){return e(i)}),u=_compose2["default"].apply(void 0,p)(a.dispatch),_extends({},a,{dispatch:u})}}}exports.__esModule=!0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};exports["default"]=applyMiddleware;var _compose=require("./compose"),_compose2=_interopRequireDefault(_compose);

},{"./compose":20}],18:[function(require,module,exports){
"use strict";function bindActionCreator(t,o){return function(){return o(t.apply(void 0,arguments))}}function bindActionCreators(t,o){if("function"==typeof t)return bindActionCreator(t,o);if("object"!=typeof t||null===t)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(t),n={},e=0;e<r.length;e++){var i=r[e],c=t[i];"function"==typeof c&&(n[i]=bindActionCreator(c,o))}return n}exports.__esModule=!0,exports["default"]=bindActionCreators;

},{}],19:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function getUndefinedStateErrorMessage(e,t){var n=t&&t.type,r=n&&'"'+n.toString()+'"'||"an action";return"Given action "+r+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state.'}function getUnexpectedStateShapeWarningMessage(e,t,n){var r=Object.keys(t),i=n&&n.type===_createStore.ActionTypes.INIT?"initialState argument passed to createStore":"previous state received by the reducer";if(0===r.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!(0,_isPlainObject2["default"])(e))return"The "+i+' has unexpected type of "'+{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following '+('keys: "'+r.join('", "')+'"');var a=Object.keys(e).filter(function(e){return!t.hasOwnProperty(e)});return a.length>0?"Unexpected "+(a.length>1?"keys":"key")+" "+('"'+a.join('", "')+'" found in '+i+". ")+"Expected to find one of the known reducer keys instead: "+('"'+r.join('", "')+'". Unexpected keys will be ignored.'):void 0}function assertReducerSanity(e){Object.keys(e).forEach(function(t){var n=e[t],r=n(void 0,{type:_createStore.ActionTypes.INIT});if("undefined"==typeof r)throw new Error('Reducer "'+t+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');var i="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if("undefined"==typeof n(void 0,{type:i}))throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+_createStore.ActionTypes.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.")})}function combineReducers(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];"function"==typeof e[i]&&(n[i]=e[i])}var a,o=Object.keys(n);try{assertReducerSanity(n)}catch(u){a=u}return function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1];if(a)throw a;for(var r=!1,i={},u=0;u<o.length;u++){var s=o[u],d=n[s],c=e[s],f=d(c,t);if("undefined"==typeof f){var l=getUndefinedStateErrorMessage(s,t);throw new Error(l)}i[s]=f,r=r||f!==c}return r?i:e}}exports.__esModule=!0,exports["default"]=combineReducers;var _createStore=require("./createStore"),_isPlainObject=require("lodash/isPlainObject"),_isPlainObject2=_interopRequireDefault(_isPlainObject),_warning=require("./utils/warning"),_warning2=_interopRequireDefault(_warning);

},{"./createStore":21,"./utils/warning":23,"lodash/isPlainObject":27}],20:[function(require,module,exports){
"use strict";function compose(){for(var e=arguments.length,r=Array(e),t=0;e>t;t++)r[t]=arguments[t];if(0===r.length)return function(e){return e};var n=function(){var e=r[r.length-1],t=r.slice(0,-1);return{v:function(){return t.reduceRight(function(e,r){return r(e)},e.apply(void 0,arguments))}}}();return"object"==typeof n?n.v:void 0}exports.__esModule=!0,exports["default"]=compose;

},{}],21:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function createStore(e,t,r){function n(){l===b&&(l=b.slice())}function o(){return p}function i(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return n(),l.push(e),function(){if(t){t=!1,n();var r=l.indexOf(e);l.splice(r,1)}}}function c(e){if(!(0,_isPlainObject2["default"])(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"==typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(d)throw new Error("Reducers may not dispatch actions.");try{d=!0,p=a(p,e)}finally{d=!1}for(var t=b=l,r=0;r<t.length;r++)t[r]();return e}function u(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");a=e,c({type:ActionTypes.INIT})}function s(){var e,t=i;return e={subscribe:function(e){function r(){e.next&&e.next(o())}if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");r();var n=t(r);return{unsubscribe:n}}},e[_symbolObservable2["default"]]=function(){return this},e}var f;if("function"==typeof t&&"undefined"==typeof r&&(r=t,t=void 0),"undefined"!=typeof r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(createStore)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var a=e,p=t,b=[],l=b,d=!1;return c({type:ActionTypes.INIT}),f={dispatch:c,subscribe:i,getState:o,replaceReducer:u},f[_symbolObservable2["default"]]=s,f}exports.__esModule=!0,exports.ActionTypes=void 0,exports["default"]=createStore;var _isPlainObject=require("lodash/isPlainObject"),_isPlainObject2=_interopRequireDefault(_isPlainObject),_symbolObservable=require("symbol-observable"),_symbolObservable2=_interopRequireDefault(_symbolObservable),ActionTypes=exports.ActionTypes={INIT:"@@redux/INIT"};

},{"lodash/isPlainObject":27,"symbol-observable":34}],22:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function isCrushed(){}exports.__esModule=!0,exports.compose=exports.applyMiddleware=exports.bindActionCreators=exports.combineReducers=exports.createStore=void 0;var _createStore=require("./createStore"),_createStore2=_interopRequireDefault(_createStore),_combineReducers=require("./combineReducers"),_combineReducers2=_interopRequireDefault(_combineReducers),_bindActionCreators=require("./bindActionCreators"),_bindActionCreators2=_interopRequireDefault(_bindActionCreators),_applyMiddleware=require("./applyMiddleware"),_applyMiddleware2=_interopRequireDefault(_applyMiddleware),_compose=require("./compose"),_compose2=_interopRequireDefault(_compose),_warning=require("./utils/warning"),_warning2=_interopRequireDefault(_warning);exports.createStore=_createStore2["default"],exports.combineReducers=_combineReducers2["default"],exports.bindActionCreators=_bindActionCreators2["default"],exports.applyMiddleware=_applyMiddleware2["default"],exports.compose=_compose2["default"];

},{"./applyMiddleware":17,"./bindActionCreators":18,"./combineReducers":19,"./compose":20,"./createStore":21,"./utils/warning":23}],23:[function(require,module,exports){
"use strict";function warning(o){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(o);try{throw new Error(o)}catch(e){}}exports.__esModule=!0,exports["default"]=warning;

},{}],24:[function(require,module,exports){
function getPrototype(t){return nativeGetPrototype(Object(t))}var nativeGetPrototype=Object.getPrototypeOf;module.exports=getPrototype;

},{}],25:[function(require,module,exports){
function isHostObject(t){var o=!1;if(null!=t&&"function"!=typeof t.toString)try{o=!!(t+"")}catch(n){}return o}module.exports=isHostObject;

},{}],26:[function(require,module,exports){
function isObjectLike(e){return!!e&&"object"==typeof e}module.exports=isObjectLike;

},{}],27:[function(require,module,exports){
function isPlainObject(t){if(!isObjectLike(t)||objectToString.call(t)!=objectTag||isHostObject(t))return!1;var o=getPrototype(t);if(null===o)return!0;var e=hasOwnProperty.call(o,"constructor")&&o.constructor;return"function"==typeof e&&e instanceof e&&funcToString.call(e)==objectCtorString}var getPrototype=require("./_getPrototype"),isHostObject=require("./_isHostObject"),isObjectLike=require("./isObjectLike"),objectTag="[object Object]",objectProto=Object.prototype,funcToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,objectCtorString=funcToString.call(Object),objectToString=objectProto.toString;module.exports=isPlainObject;

},{"./_getPrototype":24,"./_isHostObject":25,"./isObjectLike":26}],28:[function(require,module,exports){
module.exports=require("./lib/retry");

},{"./lib/retry":29}],29:[function(require,module,exports){
var RetryOperation=require("./retry_operation");exports.operation=function(r){var t=!1;r&&r.forever===!0&&(t=!0);var o=exports.timeouts(r);return new RetryOperation(o,t)},exports.timeouts=function(r){if(r instanceof Array)return[].concat(r);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var o in r)t[o]=r[o];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var e=[],n=0;n<t.retries;n++)e.push(this.createTimeout(n,t));return e.sort(function(r,t){return r-t}),e},exports.createTimeout=function(r,t){var o=t.randomize?Math.random()+1:1,e=Math.round(o*t.minTimeout*Math.pow(t.factor,r));return e=Math.min(e,t.maxTimeout)},exports.wrap=function(r,t,o){if(t instanceof Array&&(o=t,t=null),!o){o=[];for(var e in r)"function"==typeof r[e]&&o.push(e)}for(var n=0;n<o.length;n++){var i=o[n],a=r[i];r[i]=function(){var o=exports.operation(t),e=Array.prototype.slice.call(arguments),n=e.pop();e.push(function(r){o.retry(r)||(r&&(arguments[0]=o.mainError()),n.apply(this,arguments))}),o.attempt(function(){a.apply(r,e)})},r[i].options=t}};

},{"./retry_operation":30}],30:[function(require,module,exports){
function RetryOperation(t,e){this._timeouts=t,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,e&&(this._cachedTimeouts=this._timeouts.slice(0))}module.exports=RetryOperation,RetryOperation.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;this._errors.push(t);var e=this._timeouts.shift();if(void 0===e){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),e=this._timeouts.shift()}var i=this;return setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout)),i._fn(i._attempts)},e),!0},RetryOperation.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var i=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){i._operationTimeoutCb()},i._operationTimeout)),this._fn(this._attempts)},RetryOperation.prototype["try"]=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},RetryOperation.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},RetryOperation.prototype.start=RetryOperation.prototype["try"],RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,i=0,o=0;o<this._errors.length;o++){var r=this._errors[o],s=r.message,n=(t[s]||0)+1;t[s]=n,n>=i&&(e=r,i=n)}return e};

},{}],31:[function(require,module,exports){
function setElementScroll(t,e,n){t===window?t.scrollTo(e,n):(t.scrollLeft=e,t.scrollTop=n)}function getTargetScrollLocation(t,e,n){var i,l,o,r,a,c=t.getBoundingClientRect(),d=n&&null!=n.left?n.left:.5,s=n&&null!=n.top?n.top:.5,h=d,f=s;if(e===window)l=c.left+window.scrollX-window.innerWidth*h+Math.min(c.width,window.innerWidth)*h,o=c.top+window.scrollY-window.innerHeight*f+Math.min(c.height,window.innerHeight)*f,l=Math.max(Math.min(l,document.body.scrollWidth-window.innerWidth*h),0),o=Math.max(Math.min(o,document.body.scrollHeight-window.innerHeight*f),0),r=l-window.scrollX,a=o-window.scrollY;else{i=e.getBoundingClientRect();var g=c.top-(i.top-e.scrollTop),w=c.left-(i.left-e.scrollLeft);l=w+c.width*h-e.clientWidth*h,o=g+c.height*f-e.clientHeight*f,l=Math.max(Math.min(l,e.scrollWidth-e.clientWidth),0),o=Math.max(Math.min(o,e.scrollHeight-e.clientHeight),0),r=l-e.scrollLeft,a=o-e.scrollTop}return{x:l,y:o,differenceX:r,differenceY:a}}function animate(t){raf(function(){var e=t._scrollSettings;if(e){var n=getTargetScrollLocation(e.target,t,e.align),i=Date.now()-e.startTime,l=Math.min(1/e.time*i,1);if(i>e.time+20||Math.abs(n.differenceY)<=1&&Math.abs(n.differenceX)<=1)return setElementScroll(t,n.x,n.y),t._scrollSettings=null,e.end(COMPLETE);var o=l,r=l;setElementScroll(t,n.x-n.differenceX*Math.pow(1-o,o/2),n.y-n.differenceY*Math.pow(1-r,r/2)),animate(t)}})}function transitionScrollTo(t,e,n,i){function l(t){e._scrollSettings=null,i(t),e.removeEventListener("touchstart",l)}var o=!e._scrollSettings;e._scrollSettings&&e._scrollSettings.end(CANCELED),e._scrollSettings={startTime:Date.now(),target:t,time:n.time,ease:n.ease,align:n.align,end:l},e.addEventListener("touchstart",l.bind(null,CANCELED)),o&&animate(e)}var raf=require("raf"),COMPLETE="complete",CANCELED="canceled";module.exports=function(t,e,n){function i(t){o--,o||n&&n(t)}if(t){"function"==typeof e&&(n=e,e=null),e||(e={}),e.time=e.time||1e3,e.ease=e.ease||function(t){return t};for(var l=t.parentElement,o=0;l;){if((e.validTarget?e.validTarget(l,o):l===window||(l.scrollHeight!==l.clientHeight||l.scrollWidth!==l.clientWidth)&&"hidden"!==getComputedStyle(l).overflow)&&(o++,transitionScrollTo(t,l,e,i)),l=l.parentElement,!l)return;"BODY"===l.tagName&&(l=window)}}};

},{"raf":14}],32:[function(require,module,exports){
(function (process,global){
!function(){"use strict";function t(t,e,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:n})}function e(e,n){t(e,n,function(){throw new o("The "+n+" method cannot be invoked on an Immutable data structure.")})}function n(e){t(e,S,!0)}function r(t){return"object"==typeof t?null===t||Boolean(Object.getOwnPropertyDescriptor(t,S)):!0}function i(t){return!(null===t||"object"!=typeof t||t instanceof Array||t instanceof Date)}function o(t){var e=new Error(t);return e.__proto__=o,e}function s(t,r){if(n(t),"production"!==process.env.NODE_ENV){for(var i in r)r.hasOwnProperty(i)&&e(t,r[i]);Object.freeze(t)}return t}function a(e,n){var r=e[n];t(e,n,function(){return _(r.apply(e,arguments))})}function c(t,e){if(t in this&&this[t]===e)return this;var n=b.call(this);return n[t]=_(e),f(n)}function u(t,e){var n=t[0];if(1===t.length)return c.call(this,n,e);var r,i=t.slice(1),o=this[n];if(r="object"==typeof o&&null!==o&&"function"==typeof o.setIn?o.setIn(i,e):u.call(H,i,e),n in this&&o===r)return this;var s=b.call(this);return s[n]=r,f(s)}function f(e){for(var n in x)if(x.hasOwnProperty(n)){var r=x[n];a(e,r)}t(e,"flatMap",h),t(e,"asObject",m),t(e,"asMutable",b),t(e,"set",c),t(e,"setIn",u),t(e,"update",g),t(e,"updateIn",P);for(var i=0,o=e.length;o>i;i++)e[i]=_(e[i]);return s(e,k)}function l(e){return t(e,"asMutable",p),s(e,$)}function p(){return new Date(this.getTime())}function h(t){if(0===arguments.length)return this;var e,n=[],r=this.length;for(e=0;r>e;e++){var i=t(this[e],e,this);i instanceof Array?n.push.apply(n,i):n.push(i)}return f(n)}function y(t){if("undefined"==typeof t&&0===arguments.length)return this;if("function"!=typeof t){var e=t instanceof Array?t:Array.prototype.slice.call(arguments);t=function(t,n){return-1!==e.indexOf(n)}}var n=this.instantiateEmptyObject();for(var r in this)this.hasOwnProperty(r)&&t(this[r],r)===!1&&(n[r]=this[r]);return T(n,{instantiateEmptyObject:this.instantiateEmptyObject})}function b(t){var e,n,r=[];if(t&&t.deep)for(e=0,n=this.length;n>e;e++)r.push(v(this[e]));else for(e=0,n=this.length;n>e;e++)r.push(this[e]);return r}function m(t){"function"!=typeof t&&(t=function(t){return t});var e,n={},r=this.length;for(e=0;r>e;e++){var i=t(this[e],e,this),o=i[0],s=i[1];n[o]=s}return T(n)}function v(t){return!t||"object"!=typeof t||!Object.getOwnPropertyDescriptor(t,S)||t instanceof Date?t:t.asMutable({deep:!0})}function d(t,e){for(var n in t)Object.getOwnPropertyDescriptor(t,n)&&(e[n]=t[n]);return e}function O(t,e){function n(t,n,o){var s=_(n[o]),u=c&&c(t[o],s,e),f=t[o];if(void 0!==r||void 0!==u||!t.hasOwnProperty(o)||s!==f&&s===s){var l;l=u?u:a&&i(f)&&i(s)?f.merge(s,e):s,(f!==l&&l===l||!t.hasOwnProperty(o))&&(void 0===r&&(r=d(t,t.instantiateEmptyObject())),r[o]=l)}}if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(t));var r,o,s=t instanceof Array,a=e&&e.deep,c=e&&e.merger;if(s)for(var u=0;u<t.length;u++){var f=t[u];for(o in f)f.hasOwnProperty(o)&&n(this,f,o)}else for(o in t)Object.getOwnPropertyDescriptor(t,o)&&n(this,t,o);return void 0===r?this:T(r,{instantiateEmptyObject:this.instantiateEmptyObject})}function j(t,e){var n=t[0];if(1===t.length)return w.call(this,n,e);var r,i=t.slice(1),o=this[n];if(r=this.hasOwnProperty(n)&&"object"==typeof o&&null!==o&&"function"==typeof o.setIn?o.setIn(i,e):j.call(Y,i,e),this.hasOwnProperty(n)&&o===r)return this;var s=d(this,this.instantiateEmptyObject());return s[n]=r,T(s,this)}function w(t,e){if(this.hasOwnProperty(t)&&this[t]===e)return this;var n=d(this,this.instantiateEmptyObject());return n[t]=_(e),T(n,this)}function g(t,e){var n=Array.prototype.slice.call(arguments,2),r=this[t];return this.set(t,e.apply(r,[r].concat(n)))}function E(t,e){for(var n=0,r=e.length;null!=t&&r>n;n++)t=t[e[n]];return n&&n==r?t:void 0}function P(t,e){var n=Array.prototype.slice.call(arguments,2),r=E(this,t);return this.setIn(t,e.apply(r,[r].concat(n)))}function I(t){var e,n=this.instantiateEmptyObject();if(t&&t.deep)for(e in this)this.hasOwnProperty(e)&&(n[e]=v(this[e]));else for(e in this)this.hasOwnProperty(e)&&(n[e]=this[e]);return n}function D(){return{}}function T(e,n){var r=n&&n.instantiateEmptyObject?n.instantiateEmptyObject:D;return t(e,"merge",O),t(e,"without",y),t(e,"asMutable",I),t(e,"instantiateEmptyObject",r),t(e,"set",w),t(e,"setIn",j),t(e,"update",g),t(e,"updateIn",P),s(e,U)}function M(t){return"object"==typeof t&&null!==t&&(t.$$typeof===C||t.$$typeof===A)}function _(t,e,n){if(r(t)||M(t))return t;if(t instanceof Array)return f(t.slice());if(t instanceof Date)return l(new Date(t.getTime()));var i=e&&e.prototype,s=i&&i!==Object.prototype?function(){return Object.create(i)}:D,a=s();if("production"!==process.env.NODE_ENV){if(null==n&&(n=64),0>=n)throw new o("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");n-=1}for(var c in t)Object.getOwnPropertyDescriptor(t,c)&&(a[c]=_(t[c],void 0,n));return T(a,{instantiateEmptyObject:s})}var A="function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element"),C=60103,S="__immutable_invariants_hold",U=["setPrototypeOf"],N=["keys"],k=U.concat(["push","pop","sort","splice","shift","unshift","reverse"]),x=N.concat(["map","filter","slice","concat","reduce","reduceRight"]),$=U.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);o.prototype=Error.prototype;var H=_([]),Y=_({});_.isImmutable=r,_.ImmutableError=o,Object.freeze(_),"object"==typeof module?module.exports=_:"object"==typeof exports?exports.Immutable=_:"object"==typeof window?window.Immutable=_:"object"==typeof global&&(global.Immutable=_)}();

}).call(this,require('_process'),window)

},{"_process":12}],33:[function(require,module,exports){
"use strict";module.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})};

},{}],34:[function(require,module,exports){
(function (global){
"use strict";module.exports=require("./ponyfill")(global||window||this);

}).call(this,window)

},{"./ponyfill":35}],35:[function(require,module,exports){
"use strict";module.exports=function(e){var b,o=e.Symbol;return"function"==typeof o?o.observable?b=o.observable:(b=o("observable"),o.observable=b):b="@@observable",b};

},{}],36:[function(require,module,exports){
function E(){}E.prototype={on:function(t,n,e){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:n,ctx:e}),this},once:function(t,n,e){function i(){f.off(t,i),n.apply(e,arguments)}var f=this;return i._=n,this.on(t,i,e)},emit:function(t){var n=[].slice.call(arguments,1),e=((this.e||(this.e={}))[t]||[]).slice(),i=0,f=e.length;for(i;f>i;i++)e[i].fn.apply(e[i].ctx,n);return this},off:function(t,n){var e=this.e||(this.e={}),i=e[t],f=[];if(i&&n)for(var o=0,r=i.length;r>o;o++)i[o].fn!==n&&i[o].fn._!==n&&f.push(i[o]);return f.length?e[t]=f:delete e[t],this}},module.exports=E;

},{}],37:[function(require,module,exports){
module.exports='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <!-- Generator: Sketch 39.1 (31720) - http://www.bohemiancoding.com/sketch -->\n    <defs/>\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Artboard" fill="#D00032">\n            <g id="Group">\n                <path d="M0,8 C0,12.418278 3.581722,16 8,16 C12.418278,16 16,12.418278 16,8 C16,4.89580324 14.2154684,2.11256098 11.4682644,0.789110134 L10.6002482,2.59092808 C12.661769,3.58405472 14,5.6712248 14,8 C14,11.3137085 11.3137085,14 8,14 C4.6862915,14 2,11.3137085 2,8 C2,5.65296151 3.35941993,3.55225774 5.44569583,2.56903563 L4.59307587,0.759881355 C1.81273067,2.07020511 0,4.87140735 0,8 Z" id="Oval"/>\n                <polygon id="Combined-Shape" points="7 8.58578644 7 0 9 0 9 8.58578644 10.2928932 7.29289322 11 6.58578644 12.4142136 8 11.7071068 8.70710678 8.70710678 11.7071068 8 12.4142136 7.64644661 12.0606602 7.29289322 11.7071068 4.29289322 8.70710678 3.58578644 8 5 6.58578644 5.70710678 7.29289322"/>\n            </g>\n        </g>\n    </g>\n</svg>\n';

},{}],38:[function(require,module,exports){
"use strict";module.exports={PUBLIC_ANNOTATION_COUNT_CHANGED:"publicAnnotationCountChanged",DO_LOGIN:"doLogin"};

},{}],39:[function(require,module,exports){
var Bridge,RPC,extend,slice=[].slice;extend=require("extend"),RPC=require("./frame-rpc"),module.exports=Bridge=function(){function n(){this.links=[],this.channelListeners={},this.onConnectListeners=[]}return n.prototype.links=null,n.prototype.channelListeners=null,n.prototype.onConnectListeners=null,n.prototype.destroy=function(){var n,t,e,r,i;for(r=this.links,i=[],n=0,t=r.length;t>n;n++)e=r[n],i.push(e.channel.destroy());return i},n.prototype.createChannel=function(n,t,e){var r,i,o,l,c;return r=null,o=!1,c=function(t){return function(){var e,i,l,c,u;if(!o){for(o=!0,c=t.onConnectListeners,u=[],i=0,l=c.length;l>i;i++)e=c[i],u.push(e.call(null,r,n));return u}}}(this),i=function(n){return function(n,t){return n===e?(t(),c()):void 0}}(this),l=extend({connect:i},this.channelListeners),r=new RPC(window,n,t,l),r.call("connect",e,c),this.links.push({channel:r,window:n}),r},n.prototype.call=function(){var n,t,e,r,i,o;return r=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],e=null,"function"==typeof t[t.length-1]&&(e=t[t.length-1],t=t.slice(0,-1)),n=function(n){return function(t){return function(e){var r;throw t.destroy(),n.links=function(){var n,e,i,o;for(i=this.links,o=[],n=0,e=i.length;e>n;n++)r=i[n],r.channel!==t&&o.push(r);return o}.call(n),e}}}(this),i=this.links.map(function(e){var i;return i=new Promise(function(n,i){var o,l,c,u;u=setTimeout(function(){return n(null)},1e3);try{return(c=e.channel).call.apply(c,[r].concat(slice.call(t),[function(t,e){return clearTimeout(u),t?i(t):n(e)}]))}catch(l){return o=l,i(o)}}),i["catch"](n(e.channel))}),o=Promise.all(i),null!=e&&(o=o.then(function(n){return e(null,n)})["catch"](function(n){return e(n)})),o},n.prototype.on=function(n,t){if(this.channelListeners[n])throw new Error("Listener '"+n+"' already bound in Bridge");return this.channelListeners[n]=t,this},n.prototype.off=function(n){return delete this.channelListeners[n],this},n.prototype.onConnect=function(n){return this.onConnectListeners.push(n),this},n}();

},{"./frame-rpc":41,"extend":4}],40:[function(require,module,exports){
var Discovery,bind=function(e,s){return function(){return e.apply(s,arguments)}};module.exports=Discovery=function(){function e(e,s){this.target=e,null==s&&(s={}),this._onMessage=bind(this._onMessage,this),this.stopDiscovery=bind(this.stopDiscovery,this),s.server&&(this.server=s.server),s.origin&&(this.origin=s.origin)}return e.prototype.server=!1,e.prototype.origin="*",e.prototype.onDiscovery=null,e.prototype.requestInProgress=!1,e.prototype.startDiscovery=function(e){if(this.onDiscovery)throw new Error("Discovery is already in progress, call .stopDiscovery() first");this.onDiscovery=e,this.target.addEventListener("message",this._onMessage,!1),this._beacon()},e.prototype.stopDiscovery=function(){this.onDiscovery=null,this.target.removeEventListener("message",this._onMessage)},e.prototype._beacon=function(){var e,s,r,o,t,i,n;for(e=this.server?"__cross_frame_dhcp_offer":"__cross_frame_dhcp_discovery",i=[this.target.top];i.length;)for(t=i.shift(),t!==this.target&&t.postMessage(e,this.origin),n=t.frames,r=0,o=n.length;o>r;r++)s=n[r],i.push(s)},e.prototype._onMessage=function(e){var s,r,o,t,i,n,c,a,p;a=e.source,i=e.origin,s=e.data,("null"===i||i.match("moz-extension:")||"moz-extension:"===window.location.protocol)&&(i="*"),o="function"==typeof s.match?s.match(/^__cross_frame_dhcp_(discovery|offer|request|ack)(?::(\d+))?$/):void 0,o&&(t=o[1],p=o[2],n=this._processMessage(t,p,i),c=n.reply,r=n.discovered,p=n.token,c&&a.postMessage("__cross_frame_dhcp_"+c,i),r&&this.onDiscovery.call(null,a,i,p))},e.prototype._processMessage=function(e,s,r){var o,t;if(t=null,o=!1,this.server){if("discovery"===e)t="offer";else if("request"===e)s=this._generateToken(),t="ack:"+s,o=!0;else if("offer"===e||"ack"===e)throw new Error("A second Discovery server has been detected at "+r+".\nThis is unsupported and will cause unexpected behaviour.")}else"offer"===e?this.requestInProgress||(this.requestInProgress=!0,t="request"):"ack"===e&&(this.requestInProgress=!1,o=!0);return{reply:t,discovered:o,token:s}},e.prototype._generateToken=function(){return(""+Math.random()).replace(/\D/g,"")},e}();

},{}],41:[function(require,module,exports){
"use strict";function RPC(e,t,s,o){if(!(this instanceof RPC))return new RPC(e,t,s,o);var r=this;if(this.src=e,this.dst=t,"*"===s)this.origin="*";else{var i=new URL(s);this.origin=i.protocol+"//"+i.host}this._sequence=0,this._callbacks={},this._onmessage=function(e){r._destroyed||"*"!==r.origin&&e.origin!==r.origin||e.data&&"object"==typeof e.data&&"frame-rpc"===e.data.protocol&&Array.isArray(e.data.arguments)&&r._handle(e.data)},this.src.addEventListener("message",this._onmessage),this._methods=("function"==typeof o?o(this):o)||{}}var VERSION="1.0.0";module.exports=RPC,RPC.prototype.destroy=function(){this._destroyed=!0,this.src.removeEventListener("message",this._onmessage)},RPC.prototype.call=function(e){var t=[].slice.call(arguments,1);return this.apply(e,t)},RPC.prototype.apply=function(e,t){if(!this._destroyed){var s=this._sequence++;"function"==typeof t[t.length-1]&&(this._callbacks[s]=t[t.length-1],t=t.slice(0,-1)),this.dst.postMessage({protocol:"frame-rpc",version:VERSION,sequence:s,method:e,arguments:t},this.origin)}},RPC.prototype._handle=function(e){var t=this;if(!t._destroyed)if(e.hasOwnProperty("method")){if(!this._methods.hasOwnProperty(e.method))return;var s=e.arguments.concat(function(){t.dst.postMessage({protocol:"frame-rpc",version:VERSION,response:e.sequence,arguments:[].slice.call(arguments)},t.origin)});this._methods[e.method].apply(this._methods,s)}else if(e.hasOwnProperty("response")){var o=this._callbacks[e.response];delete this._callbacks[e.response],o&&o.apply(null,e.arguments)}};

},{}],42:[function(require,module,exports){
"use strict";function assign(t,s){for(var e in s)s.hasOwnProperty(e)&&(t[e]=s[e]);return t}function settings(t){for(var s=t.querySelectorAll("script.js-hypothesis-config"),e={},n=0;n<s.length;n++)assign(e,JSON.parse(s[n].textContent));return e}module.exports=settings;

},{}],43:[function(require,module,exports){
"use strict";function analytics(e,t,a){var o=t?globalGAOptions(t,a):{};return{track:function(t,a,E){e.eventTrack(t,Object.assign({},{label:a||void 0,metricValue:isNaN(E)?void 0:E},o))},events:{ANNOTATION_CREATED:"annotationCreated",ANNOTATION_DELETED:"annotationDeleted",ANNOTATION_FLAGGED:"annotationFlagged",ANNOTATION_SHARED:"annotationShared",ANNOTATION_UPDATED:"annotationUpdated",DOCUMENT_SHARED:"documentShared",HIGHLIGHT_CREATED:"highlightCreated",HIGHLIGHT_UPDATED:"highlightUpdated",HIGHLIGHT_DELETED:"highlightDeleted",LOGIN_FAILURE:"loginFailure",LOGIN_SUCCESS:"loginSuccessful",LOGOUT_FAILURE:"logoutFailure",LOGOUT_SUCCESS:"logoutSuccessful",PAGE_NOTE_CREATED:"pageNoteCreated",PAGE_NOTE_UPDATED:"pageNoteUpdated",PAGE_NOTE_DELETED:"pageNoteDeleted",REPLY_CREATED:"replyCreated",REPLY_UPDATED:"replyUpdated",REPLY_DELETED:"replyDeleted",SIDEBAR_OPENED:"sidebarOpened",SIGN_UP_REQUESTED:"signUpRequested"}}}analytics.$inject=["$analytics","$window","settings"];var VIA_REFERRER=/^https:\/\/(qa-)?via.hypothes.is\//,globalGAOptions=function(e,t){t=t||{};var a={category:""},o=["chrome-extension","firefox-extension","embed","bookmarklet","via"];return o.indexOf((t.appType||"").toLowerCase())>-1?a.category=t.appType.toLowerCase():"chrome-extension:"===e.location.protocol?a.category="chrome-extension":VIA_REFERRER.test(e.document.referrer)?a.category="via":a.category="embed",a};module.exports=analytics;

},{}],44:[function(require,module,exports){
"use strict";function getExistingAnnotation(n,t){return n.getState().annotations.find(function(n){return n.id===t})}function annotationMapper(n,t,o){function a(o,a){o=o.concat(a||[]);var e=[];o.forEach(function(o){var a=getExistingAnnotation(t,o.id);return a?void n.$broadcast(events.ANNOTATION_UPDATED,o):void e.push(o)}),n.$broadcast(events.ANNOTATIONS_LOADED,e)}function e(o){var a=o.map(function(n){var o=getExistingAnnotation(t,n.id);return o&&n!==o&&(n=angular.copy(n,o)),n});n.$broadcast(events.ANNOTATIONS_UNLOADED,a)}function i(t){return n.$broadcast(events.BEFORE_ANNOTATION_CREATED,t),t}function r(t){return o.annotation["delete"]({id:t.id}).then(function(){return n.$broadcast(events.ANNOTATION_DELETED,t),t})}function u(t){return o.annotation.flag({id:t.id}).then(function(){return n.$broadcast(events.ANNOTATION_FLAGGED,t),t})}return{loadAnnotations:a,unloadAnnotations:e,createAnnotation:i,deleteAnnotation:r,flagAnnotation:u}}annotationMapper.$inject=["$rootScope","annotationUI","store"];var angular=require("angular"),events=require("./events");module.exports=annotationMapper;

},{"./events":90,"angular":"angular"}],45:[function(require,module,exports){
"use strict";function documentMetadata(t){var n=t.uri,i=new URL(n).hostname,e=i;return t.document&&t.document.title&&(e=t.document.title[0]),"localhost"===i&&(i=""),{uri:n,domain:i,title:e}}function domainAndTitle(t){return{domain:domainTextFromAnnotation(t),titleText:titleTextFromAnnotation(t),titleLink:titleLinkFromAnnotation(t)}}function titleLinkFromAnnotation(t){var n=t.uri;return n&&0!==n.indexOf("http://")&&0!==n.indexOf("https://")&&(n=null),t.links&&t.links.incontext&&(n=t.links.incontext),n}function domainTextFromAnnotation(t){var n=documentMetadata(t),i="";if(n.uri&&0===n.uri.indexOf("file://")&&n.title){var e=n.uri.split("/"),o=e[e.length-1];o&&(i=o)}else n.domain&&n.domain!==n.title&&(i=n.domain);return i}function titleTextFromAnnotation(t){var n=documentMetadata(t),i=n.title;return i.length>30&&(i=i.slice(0,30)+"…"),i}function isReply(t){return(t.references||[]).length>0}function isNew(t){return!t.id}function isPublic(t){var n=!1;return t.permissions?(t.permissions.read.forEach(function(t){var i=t.split(":");2===i.length&&"group"===i[0]&&(n=!0)}),n):n}function hasSelector(t){return!!(t.target&&t.target.length>0&&t.target[0].selector)}function isWaitingToAnchor(t){return hasSelector(t)&&"undefined"==typeof t.$orphan&&!t.$anchorTimeout}function isOrphan(t){return hasSelector(t)&&t.$orphan}function isPageNote(t){return!hasSelector(t)&&!isReply(t)}function isAnnotation(t){return!(!hasSelector(t)||isOrphan(t))}function location(t){if(t)for(var n=t.target||[],i=0;i<n.length;i++)for(var e=n[i].selector||[],o=0;o<e.length;o++)if("TextPositionSelector"===e[o].type)return e[o].start;return Number.POSITIVE_INFINITY}module.exports={documentMetadata:documentMetadata,domainAndTitle:domainAndTitle,isAnnotation:isAnnotation,isNew:isNew,isOrphan:isOrphan,isPageNote:isPageNote,isPublic:isPublic,isReply:isReply,isWaitingToAnchor:isWaitingToAnchor,location:location};

},{}],46:[function(require,module,exports){
"use strict";function angularDigestMiddleware(e){return function(r){return function(n){r(n),e.$$phase||e.$applyAsync(function(){})}}}var redux=require("redux"),thunk=require("redux-thunk")["default"],reducers=require("./reducers"),annotationsReducer=require("./reducers/annotations"),framesReducer=require("./reducers/frames"),moderationReducer=require("./reducers/moderation"),selectionReducer=require("./reducers/selection"),sessionReducer=require("./reducers/session"),viewerReducer=require("./reducers/viewer"),util=require("./reducers/util"),debugMiddleware=require("./reducers/debug-middleware");module.exports=function(e,r){var n=redux.applyMiddleware(thunk,debugMiddleware,angularDigestMiddleware.bind(null,e)),t=redux.createStore(reducers.update,reducers.init(r),n),i=redux.bindActionCreators(Object.assign({},annotationsReducer.actions,framesReducer.actions,moderationReducer.actions,selectionReducer.actions,sessionReducer.actions,viewerReducer.actions),t.dispatch),d=util.bindSelectors({isAnnotationSelected:selectionReducer.isAnnotationSelected,hasSelectedAnnotations:selectionReducer.hasSelectedAnnotations,annotationExists:annotationsReducer.annotationExists,findIDsForTags:annotationsReducer.findIDsForTags,savedAnnotations:annotationsReducer.savedAnnotations,frames:framesReducer.frames,isHiddenByModerator:moderationReducer.isHiddenByModerator,flagCount:moderationReducer.flagCount,isSidebar:viewerReducer.isSidebar},t.getState);return Object.assign(t,i,d)},module.exports.$inject=["$rootScope","settings"];

},{"./reducers":112,"./reducers/annotations":109,"./reducers/debug-middleware":110,"./reducers/frames":111,"./reducers/moderation":113,"./reducers/selection":114,"./reducers/session":115,"./reducers/util":116,"./reducers/viewer":117,"redux":22,"redux-thunk":16}],47:[function(require,module,exports){
"use strict";function configureLocation(e){return e.html5Mode(!0)}function configureRoutes(e){e.when("/a/:id",{template:'<annotation-viewer-content search="vm.search"></annotation-viewer-content>',reloadOnSearch:!1,resolve:resolve}),e.when("/stream",{template:'<stream-content search="vm.search"></stream-content>',reloadOnSearch:!1,resolve:resolve}),e.otherwise({template:'<sidebar-content search="vm.search" auth="vm.auth"></sidebar-content>',reloadOnSearch:!1,resolve:resolve})}function configureHttp(e){e.defaults.xsrfHeaderName="X-CSRF-Token"}function setupHttp(e,r){e.defaults.headers.common["X-Client-Id"]=r.clientId}function processAppOpts(){settings.liveReloadServer&&require("./live-reload-client").connect(settings.liveReloadServer)}configureLocation.$inject=["$locationProvider"],configureRoutes.$inject=["$routeProvider"],configureHttp.$inject=["$httpProvider"],setupHttp.$inject=["$http","streamer"];var addAnalytics=require("./ga");require("../shared/polyfills");var raven,settings=require("../shared/settings")(document);settings.raven&&(raven=require("./raven"),raven.init(settings.raven));var hostPageConfig=require("./host-config");Object.assign(settings,hostPageConfig(window)),document.body.setAttribute("ng-csp","");var angular=require("angular");require("autofill-event"),settings.raven?raven.angularModule(angular):angular.module("ngRaven",[]),settings.googleAnalytics&&addAnalytics(settings.googleAnalytics);var resolve={sessionState:["session",function(e){return e.load()}]},authService;authService=Array.isArray(settings.services)?require("./oauth-auth"):require("./auth"),module.exports=angular.module("h",[require("angular-jwt"),require("angular-resource"),require("angular-route"),require("angular-sanitize"),require("angular-toastr"),["angulartics",require("angulartics")][0],["angulartics.google.analytics",require("angulartics/src/angulartics-ga")][0],["ngTagsInput",require("ng-tags-input")][0],["ui.bootstrap",require("./vendor/ui-bootstrap-custom-tpls-0.13.4")][0],"ngRaven"]).component("hypothesisApp",require("./components/hypothesis-app")).component("annotation",require("./components/annotation").component).component("annotationShareDialog",require("./components/annotation-share-dialog")).component("annotationThread",require("./components/annotation-thread")).component("annotationViewerContent",require("./components/annotation-viewer-content")).component("dropdownMenuBtn",require("./components/dropdown-menu-btn")).component("excerpt",require("./components/excerpt")).component("groupList",require("./components/group-list")).component("helpLink",require("./components/help-link")).component("helpPanel",require("./components/help-panel")).component("loggedoutMessage",require("./components/loggedout-message")).component("loginControl",require("./components/login-control")).component("loginForm",require("./components/login-form").component).component("markdown",require("./components/markdown")).component("moderationBanner",require("./components/moderation-banner")).component("publishAnnotationBtn",require("./components/publish-annotation-btn")).component("searchInput",require("./components/search-input")).component("searchStatusBar",require("./components/search-status-bar")).component("selectionTabs",require("./components/selection-tabs")).component("sidebarContent",require("./components/sidebar-content")).component("sidebarTutorial",require("./components/sidebar-tutorial").component).component("shareDialog",require("./components/share-dialog")).component("sortDropdown",require("./components/sort-dropdown")).component("streamContent",require("./components/stream-content")).component("svgIcon",require("./components/svg-icon")).component("tagEditor",require("./components/tag-editor")).component("threadList",require("./components/thread-list")).component("timestamp",require("./components/timestamp")).component("topBar",require("./components/top-bar")).directive("formInput",require("./directive/form-input")).directive("formValidate",require("./directive/form-validate")).directive("hAutofocus",require("./directive/h-autofocus")).directive("hBranding",require("./directive/h-branding")).directive("hOnTouch",require("./directive/h-on-touch")).directive("hTooltip",require("./directive/h-tooltip")).directive("spinner",require("./directive/spinner")).directive("statusButton",require("./directive/status-button")).directive("windowScroll",require("./directive/window-scroll")).service("analytics",require("./analytics")).service("annotationMapper",require("./annotation-mapper")).service("annotationUI",require("./annotation-ui")).service("auth",authService).service("bridge",require("../shared/bridge")).service("drafts",require("./drafts")).service("features",require("./features")).service("flash",require("./flash")).service("formRespond",require("./form-respond")).service("frameSync",require("./frame-sync")["default"]).service("groups",require("./groups")).service("host",require("./host")).service("localStorage",require("./local-storage")).service("permissions",require("./permissions")).service("queryParser",require("./query-parser")).service("rootThread",require("./root-thread")).service("searchFilter",require("./search-filter")).service("serviceUrl",require("./service-url")).service("session",require("./session")).service("streamer",require("./streamer")).service("streamFilter",require("./stream-filter")).service("tags",require("./tags")).service("unicode",require("./unicode")).service("viewFilter",require("./view-filter")).factory("store",require("./store")).value("Discovery",require("../shared/discovery")).value("ExcerptOverflowMonitor",require("./util/excerpt-overflow-monitor")).value("VirtualThreadList",require("./virtual-thread-list")).value("raven",require("./raven")).value("settings",settings).value("time",require("./time")).value("urlEncodeFilter",require("./filter/url").encode).config(configureHttp).config(configureLocation).config(configureRoutes).run(setupHttp),processAppOpts();var appEl=document.querySelector("hypothesis-app");angular.bootstrap(appEl,["h"],{strictDi:!0});

},{"../shared/bridge":39,"../shared/discovery":40,"../shared/polyfills":"/src/shared/polyfills.js","../shared/settings":42,"./analytics":43,"./annotation-mapper":44,"./annotation-ui":46,"./auth":48,"./components/annotation":53,"./components/annotation-share-dialog":50,"./components/annotation-thread":51,"./components/annotation-viewer-content":52,"./components/dropdown-menu-btn":54,"./components/excerpt":55,"./components/group-list":56,"./components/help-link":57,"./components/help-panel":58,"./components/hypothesis-app":59,"./components/loggedout-message":60,"./components/login-control":61,"./components/login-form":62,"./components/markdown":63,"./components/moderation-banner":64,"./components/publish-annotation-btn":65,"./components/search-input":66,"./components/search-status-bar":67,"./components/selection-tabs":68,"./components/share-dialog":69,"./components/sidebar-content":70,"./components/sidebar-tutorial":71,"./components/sort-dropdown":72,"./components/stream-content":73,"./components/svg-icon":74,"./components/tag-editor":75,"./components/thread-list":76,"./components/timestamp":77,"./components/top-bar":78,"./directive/form-input":80,"./directive/form-validate":81,"./directive/h-autofocus":82,"./directive/h-branding":83,"./directive/h-on-touch":84,"./directive/h-tooltip":85,"./directive/spinner":86,"./directive/status-button":87,"./directive/window-scroll":88,"./drafts":89,"./features":91,"./filter/url":93,"./flash":94,"./form-respond":95,"./frame-sync":96,"./ga":97,"./groups":98,"./host":100,"./host-config":99,"./live-reload-client":101,"./local-storage":102,"./oauth-auth":105,"./permissions":106,"./query-parser":107,"./raven":108,"./root-thread":120,"./search-filter":122,"./service-url":124,"./session":125,"./store":126,"./stream-filter":127,"./streamer":128,"./tags":130,"./time":158,"./unicode":160,"./util/excerpt-overflow-monitor":162,"./vendor/ui-bootstrap-custom-tpls-0.13.4":166,"./view-filter":167,"./virtual-thread-list":168,"angular":"angular","angular-jwt":"angular-jwt","angular-resource":"angular-resource","angular-route":"angular-route","angular-sanitize":"angular-sanitize","angular-toastr":"angular-toastr","angulartics":1,"angulartics/src/angulartics-ga":"angulartics/src/angulartics-ga","autofill-event":2,"ng-tags-input":"ng-tags-input"}],48:[function(require,module,exports){
"use strict";function auth(t,e,n){function r(){var e=new URL("token",n.apiUrl).href;return t.get(e,{}).then(function(t){return t.data})}function u(){return o.then(function(t){return!t||e.isTokenExpired(t)?o=r():t})}function i(){o=NULL_TOKEN}var o=NULL_TOKEN;return{clearCache:i,tokenGetter:u}}auth.$inject=["$http","jwtHelper","settings"];var NULL_TOKEN=Promise.resolve(null);module.exports=auth;

},{}],49:[function(require,module,exports){
"use strict";function id(n){return n.id||n.$tag}function setParentID(n,e,t){if(!n[e].parent&&t.length){var i=t[t.length-1];n[i]||(n[i]=Object.assign({},DEFAULT_THREAD_STATE,{id:i,children:[]}),setParentID(n,i,t.slice(0,-1)));for(var r=n[i].parent;r;){if(r===e)return;r=n[r].parent}n[e].parent=i,n[i].children.push(n[e])}}function threadAnnotations(n){var e={};n.forEach(function(n){e[id(n)]=Object.assign({},DEFAULT_THREAD_STATE,{id:id(n),annotation:n,children:[]})}),n.forEach(function(n){n.references&&setParentID(e,id(n),n.references)});var t=[];Object.keys(e).forEach(function(n){e[n].parent||(e[n].collapsed=!0,t.push(e[n]))});var i={annotation:void 0,children:t,visible:!0,collapsed:!1,totalChildren:t.length};return i}function mapThread(n,e){return Object.assign({},e(n),{children:n.children.map(function(n){return mapThread(n,e)})})}function sort(n,e){return n.slice().sort(function(n,t){return n.annotation&&t.annotation?e(n.annotation,t.annotation)?-1:e(t.annotation,n.annotation)?1:0:n.annotation||t.annotation?n.annotation?1:-1:0})}function sortThread(n,e,t){var i=n.children.map(function(n){return sortThread(n,t,t)});return Object.assign({},n,{children:sort(i,e)})}function countRepliesAndDepth(n,e){var t=n.children.map(function(n){return countRepliesAndDepth(n,e+1)});return Object.assign({},n,{children:t,depth:e,replyCount:t.reduce(function(n,e){return n+1+e.replyCount},0)})}function hasVisibleChildren(n){return n.children.some(function(n){return n.visible||hasVisibleChildren(n)})}function buildThread(n,e){e=Object.assign({},defaultOpts,e);var t=threadAnnotations(n),i=function(n){return e.forceVisible&&-1!==e.forceVisible.indexOf(id(n))?!0:!e.filterFn||e.filterFn(n)};return e.selected.length>0&&(t=Object.assign({},t,{children:t.children.filter(function(n){return-1!==e.selected.indexOf(n.id)})})),t=mapThread(t,function(n){var t;if(e.highlighted.length>0){var r=n.annotation&&-1!==e.highlighted.indexOf(n.id);t=r?"highlight":"dim"}return Object.assign({},n,{highlightState:t,visible:n.visible&&n.annotation&&i(n.annotation)})}),t=mapThread(t,function(n){var t=n.id;if(e.expanded.hasOwnProperty(t))return Object.assign({},n,{collapsed:!e.expanded[t]});var i=e.filterFn&&hasVisibleChildren(n);return Object.assign({},n,{collapsed:n.collapsed&&!i})}),t.children=t.children.filter(function(n){return n.visible||hasVisibleChildren(n)}),e.threadFilterFn&&(t.children=t.children.filter(e.threadFilterFn)),t=sortThread(t,e.sortCompareFn,e.replySortCompareFn),t=countRepliesAndDepth(t,-1)}var DEFAULT_THREAD_STATE={id:void 0,annotation:void 0,parent:void 0,collapsed:!1,visible:!0,children:[],totalChildren:0,highlightState:void 0},defaultOpts={selected:[],forceVisible:void 0,filterFn:void 0,threadFilterFn:void 0,expanded:{},highlighted:[],sortCompareFn:function(n,e){return n.id<e.id},replySortCompareFn:function(n,e){return n.created<e.created}};module.exports=buildThread;

},{}],50:[function(require,module,exports){
"use strict";var angular=require("angular"),scopeTimeout=require("../util/scope-timeout");module.exports={controllerAs:"vm",template:require("../templates/annotation_share_dialog.html"),controller:["$scope","$element","analytics",function(e,t,i){var n=t.find("input")[0];e.$watch("vm.isOpen",function(i){if(i){scopeTimeout(e,function(){n.focus(),n.select()});var o=function(i){e.$apply(function(){t[0].contains(i.target)||(document.removeEventListener("click",o),this.onClose())}.bind(this))}.bind(this);scopeTimeout(e,function(){document.addEventListener("click",o)},0)}}.bind(this)),this.copyToClipboard=function(t){var i=angular.element(t.currentTarget).parent(),n=i.find("input")[0];try{if(n.select(),!document.execCommand("copy"))throw new Error("Copying link failed");this.copyToClipboardMessage="Link copied to clipboard!"}catch(o){this.copyToClipboardMessage="Select and copy to share."}finally{setTimeout(function(){this.copyToClipboardMessage=null,e.$digest()}.bind(this),1e3)}}.bind(this),e.onShareClick=function(e){e&&i.track(i.events.ANNOTATION_SHARED,e)}}],bindings:{group:"<",uri:"<",isPrivate:"<",isOpen:"<",onClose:"&"}};

},{"../templates/annotation_share_dialog.html":132,"../util/scope-timeout":164,"angular":"angular"}],51:[function(require,module,exports){
"use strict";function hiddenCount(t){var n=t.annotation&&!t.visible;return t.children.reduce(function(t,n){return t+hiddenCount(n)},n?1:0)}function visibleCount(t){var n=t.annotation&&t.visible;return t.children.reduce(function(t,n){return t+visibleCount(n)},n?1:0)}function showAllChildren(t,n){t.children.forEach(function(t){n({thread:t}),showAllChildren(t,n)})}function showAllParents(t,n){for(;t.parent&&t.parent.annotation;)n({thread:t.parent}),t=t.parent}function AnnotationThreadController(){this.annotationHovered=!1,this.toggleCollapsed=function(){this.onChangeCollapsed({id:this.thread.id,collapsed:!this.thread.collapsed})},this.threadClasses=function(){return{"annotation-thread":!0,"annotation-thread--reply":this.thread.depth>0,"annotation-thread--top-reply":1===this.thread.depth}},this.threadToggleClasses=function(){return{"annotation-thread__collapse-toggle":!0,"is-open":!this.thread.collapsed,"is-hovered":this.annotationHovered}},this.annotationClasses=function(){return{annotation:!0,"annotation--reply":this.thread.depth>0,"is-collapsed":this.thread.collapsed,"is-highlighted":"highlight"===this.thread.highlightState,"is-dimmed":"dim"===this.thread.highlightState}},this.showThreadAndReplies=function(){showAllParents(this.thread,this.onForceVisible),this.onForceVisible({thread:this.thread}),showAllChildren(this.thread,this.onForceVisible)},this.isTopLevelThread=function(){return!this.thread.parent},this.hiddenCount=function(){return hiddenCount(this.thread)},this.shouldShowReply=function(t){return visibleCount(t)>0}}module.exports={controllerAs:"vm",controller:AnnotationThreadController,bindings:{thread:"<",showDocumentInfo:"<",onChangeCollapsed:"&",onForceVisible:"&"},template:require("../templates/annotation_thread.html")};

},{"../templates/annotation_thread.html":133}],52:[function(require,module,exports){
"use strict";function fetchThread(e,t){var n;return e.annotation.get({id:t}).then(function(t){return t.references&&t.references.length?e.annotation.get({id:t.references[0]}):t}).then(function(t){return n=t,e.search({references:n.id})}).then(function(e){return[n].concat(e.rows)})}function AnnotationViewerContentController(e,t,n,r,o,i,a,s){var c=this;n.setAppIsSidebar(!1);var l=t.id;this.search.update=function(t){e.path("/stream").search("q",t)},n.subscribe(function(){c.rootThread=r.thread(n.getState())}),this.setCollapsed=function(e,t){n.setCollapsed(e,t)},this.ready=fetchThread(i,l).then(function(e){s.loadAnnotations(e);var t=e.filter(function(e){return 0===(e.references||[]).length})[0];t&&(a.setMatchPolicyIncludeAny().addClause("/references","one_of",t.id,!0).addClause("/id","equals",t.id,!0),o.setConfig("filter",{filter:a.getFilter()}),o.connect(),e.forEach(function(e){n.setCollapsed(e.id,!1)}),t.id!==l&&n.highlightAnnotations([l]))})}AnnotationViewerContentController.$inject=["$location","$routeParams","annotationUI","rootThread","streamer","store","streamFilter","annotationMapper"],module.exports={controller:AnnotationViewerContentController,controllerAs:"vm",bindings:{search:"<"},template:require("../templates/annotation_viewer_content.html")};

},{"../templates/annotation_viewer_content.html":134}],53:[function(require,module,exports){
"use strict";function errorMessage(t){var n;return t.status<=0?n="Service unreachable.":(n=t.status+" "+t.statusText,t.data&&t.data.reason&&(n=n+": "+t.data.reason)),n}function updateModel(t,n,e){return Object.assign({},t,{tags:n.tags,text:n.text,permissions:n.isPrivate?e["private"]():e.shared(t.group)})}function AnnotationController(t,n,e,a,o,i,r,s,u,l,c,d,g,f,p,v,h,T,m){function E(t){var n,e=!!t.id;return n=e?T.annotation.update({id:t.id},t):T.annotation.create({},t),n.then(function(n){var a;return n.$tag=t.$tag,Object.keys(t).forEach(function(e){"$"===e[0]&&(n[e]=t[e])}),a=D.isReply()?e?r.events.REPLY_UPDATED:r.events.REPLY_CREATED:D.isHighlight()?e?r.events.HIGHLIGHT_UPDATED:r.events.HIGHLIGHT_CREATED:isPageNote(D.annotation)?e?r.events.PAGE_NOTE_UPDATED:r.events.PAGE_NOTE_CREATED:e?r.events.ANNOTATION_UPDATED:r.events.ANNOTATION_CREATED,r.track(a),n})}function A(){D.serviceUrl=p,D.canCollapseBody=!1,D.collapseBody=!0,D.isSaving=!1,D.showShareDialog=!1,y=D.annotation.$highlight||!1,D.annotation.user=D.annotation.user||v.state.userid,D.annotation.group=D.annotation.group||g.focused().id,D.annotation.permissions||(D.annotation.permissions=f["default"](D.annotation.group)),D.annotation.text=D.annotation.text||"",Array.isArray(D.annotation.tags)||(D.annotation.tags=[]),N(),y||(isNew(D.annotation)||l.get(D.annotation))&&D.edit()}function N(){isNew(D.annotation)&&D.isHighlight()&&(D.annotation.user?(D.annotation.permissions=f["private"](),E(D.annotation).then(function(t){t.$tag=D.annotation.$tag,e.$broadcast(events.ANNOTATION_CREATED,t)})):l.update(D.annotation,D.state()))}var y,D=this;D.authorize=function(t){return f.permits(t,D.annotation,v.state.userid)},D.flag=function(){var t=function(t){c.error(errorMessage(t),"Flagging annotation failed")};u.flagAnnotation(D.annotation).then(function(){r.track(r.events.ANNOTATION_FLAGGED),D.isFlagged=!0},t)},D["delete"]=function(){return o(function(){var t="Are you sure you want to delete this annotation?";if(i.confirm(t)){var n=function(t){c.error(errorMessage(t),"Deleting annotation failed")};a.$apply(function(){u.deleteAnnotation(D.annotation).then(function(){var t;t=D.isReply()?r.events.REPLY_DELETED:D.isHighlight()?r.events.HIGHLIGHT_DELETED:isPageNote(D.annotation)?r.events.PAGE_NOTE_DELETED:r.events.ANNOTATION_DELETED,r.track(t)},n)})}},!0)},D.edit=function(){l.get(D.annotation)||l.update(D.annotation,D.state())},D.editing=function(){return l.get(D.annotation)&&!D.isSaving},D.group=function(){return g.get(D.annotation.group)},D.hasContent=function(){return D.state().text.length>0||D.state().tags.length>0},D.hasQuotes=function(){return D.annotation.target.some(function(t){return t.selector&&t.selector.some(function(t){return"TextQuoteSelector"===t.type})})},D.id=function(){return D.annotation.id},D.isHighlight=function(){return y?!0:isNew(D.annotation)?!1:!isPageNote(D.annotation)&&!isReply(D.annotation)&&!D.hasContent()},D.isShared=function(){return!D.state().isPrivate},D.onKeydown=function(t){13===t.keyCode&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),D.save())},D.toggleCollapseBody=function(t){t.stopPropagation(),D.collapseBody=!D.collapseBody},D.reply=function(){var t,n=(D.annotation.references||[]).concat(D.annotation.id),e=D.annotation.group;v.state.userid&&(t=D.state().isPrivate?f["private"]():f.shared(e)),u.createAnnotation({group:e,references:n,permissions:t,uri:D.annotation.uri})},D.revert=function(){l.remove(D.annotation),isNew(D.annotation)&&e.$broadcast(events.ANNOTATION_DELETED,D.annotation)},D.save=function(){if(!D.annotation.user)return c.info("Please log in to save your annotations."),Promise.resolve();if(!D.hasContent()&&D.isShared())return c.info("Please add text or a tag before publishing."),Promise.resolve();var t=updateModel(D.annotation,D.state(),f);return D.isSaving=!0,E(t).then(function(n){Object.assign(t,n),D.isSaving=!1;var a=isNew(D.annotation)?events.ANNOTATION_CREATED:events.ANNOTATION_UPDATED;l.remove(D.annotation),e.$broadcast(a,t)})["catch"](function(t){D.isSaving=!1,D.edit(),c.error(errorMessage(t),"Saving annotation failed")})},D.setPrivacy=function(t){isReply(D.annotation)||f.setDefault(t),l.update(D.annotation,{tags:D.state().tags,text:D.state().text,isPrivate:"private"===t})},D.tagSearchURL=function(t){return p("search.tag",{tag:t})},D.target=function(){return D.annotation.target};var P=d.flagEnabled("orphans_tab");D.isOrphan=function(){return P?"undefined"==typeof D.annotation.$orphan?D.annotation.$anchorTimeout:D.annotation.$orphan:!1},D.updated=function(){return D.annotation.updated},D.user=function(){return D.annotation.user},D.isThirdPartyUser=function(){return persona.isThirdPartyUser(D.annotation.user,h.authDomain)},D.username=function(){return persona.username(D.annotation.user)},D.isDeleted=function(){return m.hasPendingDeletion(D.annotation.id)},D.isHiddenByModerator=function(){return s.isHiddenByModerator(D.annotation.id)},D.isReply=function(){return isReply(D.annotation)},D.links=function(){return D.annotation.links?{incontext:D.annotation.links.incontext||D.annotation.links.html||"",html:D.annotation.links.html}:{incontext:"",html:""}},D.setBodyCollapsible=function(t){t!==D.canCollapseBody&&(D.canCollapseBody=t,a.$digest())},D.setText=function(t){l.update(D.annotation,{isPrivate:D.state().isPrivate,tags:D.state().tags,text:t})},D.setTags=function(t){l.update(D.annotation,{isPrivate:D.state().isPrivate,tags:t,text:D.state().text})},D.state=function(){var t=l.get(D.annotation);return t?t:{tags:D.annotation.tags,text:D.annotation.text,isPrivate:f.isPrivate(D.annotation.permissions,D.annotation.user)}};var C=memoize(annotationMetadata.domainAndTitle);D.documentMeta=function(){return C(D.annotation)},A()}AnnotationController.$inject=["$document","$q","$rootScope","$scope","$timeout","$window","analytics","annotationUI","annotationMapper","drafts","flash","features","groups","permissions","serviceUrl","session","settings","store","streamer"];var annotationMetadata=require("../annotation-metadata"),events=require("../events"),memoize=require("../util/memoize"),persona=require("../filter/persona"),isNew=annotationMetadata.isNew,isReply=annotationMetadata.isReply,isPageNote=annotationMetadata.isPageNote,component={controller:AnnotationController,controllerAs:"vm",bindings:{annotation:"<",showDocumentInfo:"<",onReplyCountClick:"&",replyCount:"<",isCollapsed:"<"},template:require("../templates/annotation.html")};module.exports={updateModel:updateModel,component:component,Controller:AnnotationController};

},{"../annotation-metadata":45,"../events":90,"../filter/persona":92,"../templates/annotation.html":131,"../util/memoize":163}],54:[function(require,module,exports){
"use strict";function DropdownMenuBtnController(o){var n=this;this.toggleDropdown=function(t){t.stopPropagation(),o(function(){n.onToggleDropdown()},0)}}DropdownMenuBtnController.$inject=["$timeout"],module.exports={controller:DropdownMenuBtnController,controllerAs:"vm",bindings:{isDisabled:"<",label:"<",dropdownMenuLabel:"@",onClick:"&",onToggleDropdown:"&"},template:require("../templates/dropdown_menu_btn.html")};

},{"../templates/dropdown_menu_btn.html":135}],55:[function(require,module,exports){
"use strict";function ExcerptController(e,t,n){function o(){for(var t=e[0];t;){if(t.classList.contains("ng-hide"))return!0;t=t.parentElement}return!1}var i=this;void 0===this.collapse&&(this.collapse=!0),void 0===this.animate&&(this.animate=!0),void 0===this.enabled&&(this.enabled=!0),this.isExpandable=function(){return this.overflowing&&this.collapse},this.isCollapsible=function(){return this.overflowing&&!this.collapse},this.toggle=function(e){e.stopPropagation(),this.collapse=!this.collapse},this.expand=function(){this.collapse=!1},this.showInlineControls=function(){return this.overflowing&&this.inlineControls},this.bottomShadowStyles=function(){return{excerpt__shadow:!0,"excerpt__shadow--transparent":this.inlineControls,"is-hidden":!this.isExpandable()}};var l=new n({getState:function(){return{enabled:i.enabled,animate:i.animate,collapsedHeight:i.collapsedHeight,collapse:i.collapse,overflowHysteresis:i.overflowHysteresis}},contentHeight:function(){var t=e[0].querySelector(".excerpt");return t?t.scrollHeight:null},onOverflowChanged:function(e){i.overflowing=e,i.onCollapsibleChanged&&i.onCollapsibleChanged({collapsible:e}),t.$digest()}},window.requestAnimationFrame);this.contentStyle=l.contentStyle,e[0].addEventListener("load",l.check,!1),window.addEventListener("resize",l.check),t.$on("$destroy",function(){window.removeEventListener("resize",l.check)}),t.$watch(o,function(e){e||l.check()}),t.$watch("vm.contentData",l.check),t.$watch("vm.enabled",l.check),l.check()}ExcerptController.$inject=["$element","$scope","ExcerptOverflowMonitor"],module.exports={controller:ExcerptController,controllerAs:"vm",bindings:{animate:"<?",contentData:"<",enabled:"<?",inlineControls:"<",collapse:"=?",onCollapsibleChanged:"&?",collapsedHeight:"<",overflowHysteresis:"<?"},transclude:!0,template:require("../templates/excerpt.html")};

},{"../templates/excerpt.html":136}],56:[function(require,module,exports){
"use strict";function GroupListController(r,e,o,t){this.groups=e,this.createNewGroup=function(){r.open(t("groups.new"),"_blank")},this.isThirdPartyUser=function(){return persona.isThirdPartyUser(this.auth.userid,o.authDomain)},this.leaveGroup=function(o){var t=e.get(o).name,i='Are you sure you want to leave the group "'+t+'"?';r.confirm(i)&&e.leave(o)},this.focusGroup=function(r){e.focus(r)};var i=serviceConfig(o);i&&i.icon&&(this.thirdPartyGroupIcon=i.icon)}GroupListController.$inject=["$window","groups","settings","serviceUrl"];var persona=require("../filter/persona"),serviceConfig=require("../service-config");module.exports={controller:GroupListController,controllerAs:"vm",bindings:{auth:"<"},template:require("../templates/group_list.html")};

},{"../filter/persona":92,"../service-config":123,"../templates/group_list.html":137}],57:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",template:require("../templates/help_link.html"),controller:function(){},scope:{version:"<",userAgent:"<",url:"<",documentFingerprint:"<",auth:"<",dateTime:"<"}};

},{"../templates/help_link.html":138}],58:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",controller:["$scope","$window","annotationUI","serviceUrl",function(e,t,n,i){this.userAgent=t.navigator.userAgent,this.version="1.9.0",this.dateTime=new Date,this.serviceUrl=i,e.$watch(function(){return n.frames()},function(e){0!==e.length&&(this.url=e[0].uri,this.documentFingerprint=e[0].documentFingerprint)}.bind(this))}],template:require("../templates/help_panel.html"),bindings:{auth:"<",onClose:"&"}};

},{"../templates/help_panel.html":139}],59:[function(require,module,exports){
"use strict";function authStateFromUserID(e){if(e){var t=parseAccountID(e);return{status:"logged-in",userid:e,username:t.username,provider:t.provider}}return{status:"logged-out"}}function HypothesisAppController(e,t,i,o,n,r,s,a,u,c,l,h,d,p,v,g,f,y){function m(t){scopeTimeout(n,function(){scrollIntoView(e[0].querySelector(t))},0)}var D=this;this.auth={status:"unknown"},this.accountDialog={visible:!1},this.shareDialog={visible:!1},this.helpPanel={visible:!1},this.isSidebar=r.top!==r,this.isSidebar&&d.connect(),this.serviceUrl=v,this.sortKey=function(){return a.getState().sortKey},this.sortKeysAvailable=function(){return a.getState().sortKeysAvailable},this.setSortKey=a.setSortKey,n.$on(events.USER_CHANGED,function(e,t){D.auth=authStateFromUserID(t.userid),D.accountDialog.visible=!1,t&&t.initialLoad||o.reload()}),g.load().then(function(e){D.auth=authStateFromUserID(e.userid),!e.userid&&f.openLoginForm&&D.login()}),this.login=function(){return serviceConfig(f)?void c.call(bridgeEvents.DO_LOGIN):(D.accountDialog.visible=!0,void m("login-form"))},this.signUp=function(){s.track(s.events.SIGN_UP_REQUESTED)},this.share=function(){this.shareDialog.visible=!0,m("share-dialog")};var S=function(){var e="";return 1===l.count()?e="You have an unsaved annotation.\nDo you really want to discard this draft?":l.count()>1&&(e="You have "+l.count()+" unsaved annotations.\nDo you really want to discard these drafts?"),0===l.count()||r.confirm(e)};this.logout=function(){S()&&(l.unsaved().forEach(function(e){i.$emit(events.ANNOTATION_DELETED,e)}),l.discard(),this.accountDialog.visible=!1,g.logout())},this.search={query:function(){return a.getState().filterQuery},update:function(e){a.setFilterQuery(e)}},this.countPendingUpdates=y.countPendingUpdates,this.applyPendingUpdates=y.applyPendingUpdates}HypothesisAppController.$inject=["$document","$location","$rootScope","$route","$scope","$window","analytics","annotationUI","auth","bridge","drafts","features","frameSync","groups","serviceUrl","session","settings","streamer"];var scrollIntoView=require("scroll-into-view"),events=require("../events"),parseAccountID=require("../filter/persona").parseAccountID,scopeTimeout=require("../util/scope-timeout"),serviceConfig=require("../service-config"),bridgeEvents=require("../../shared/bridge-events");module.exports={controller:HypothesisAppController,controllerAs:"vm",template:require("../templates/hypothesis_app.html")};

},{"../../shared/bridge-events":38,"../events":90,"../filter/persona":92,"../service-config":123,"../templates/hypothesis_app.html":140,"../util/scope-timeout":164,"scroll-into-view":31}],60:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",controller:["serviceUrl",function(e){this.serviceUrl=e}],bindings:{onLogin:"&"},template:require("../templates/loggedout_message.html")};

},{"../templates/loggedout_message.html":141}],61:[function(require,module,exports){
"use strict";var persona=require("../filter/persona");module.exports={controllerAs:"vm",controller:["serviceUrl","settings",function(e,r){this.serviceUrl=e,this.isThirdPartyUser=function(){return persona.isThirdPartyUser(this.auth.userid,r.authDomain)}}],bindings:{auth:"<",onShowHelpPanel:"&",onLogin:"&",onSignUp:"&",onLogout:"&",newStyle:"<"},template:require("../templates/login_control.html")};

},{"../filter/persona":92,"../templates/login_control.html":142}],62:[function(require,module,exports){
"use strict";function Controller(e,n,o,t,r,a,l){function i(n){n.userid&&e.$emit("auth",null,n),o.track(o.events.LOGIN_SUCCESS),angular.copy({},e.model),e.form&&e.form.$setPristine()}function s(e,n){var t,r;try{t=n.data.errors,r=n.data.reason}catch(l){r="Oops, something went wrong on the server. Please try again later!"}return o.track(o.events.LOGIN_FAILURE),a(e,t,r)}function c(){angular.copy({},e.model),e.form&&e.form.$setPristine(),t.info("For your security, the forms have been reset due to inactivity.")}function u(){m&&(n.cancel(m),m=null)}var m=null;this.serviceUrl=l,this.submit=function(n){if(a(n),n.$valid){e.$broadcast("formState",n.$name,"loading");var o=r[n.$name],t=angular.bind(this,s,n),l=o(e.model,i,t);l.$promise["finally"](function(){return e.$broadcast("formState",n.$name,"")})}},e.model||(e.model={});var f=e.$on("$destroy",function(){u(m),e.$emit("auth","cancel")});e.$on("auth",f),e.$watchCollection("model",function(e){u(m),e&&!angular.equals(e,{})&&(m=n(c,3e5))})}Controller.$inject=["$scope","$timeout","analytics","flash","session","formRespond","serviceUrl"];var angular=require("angular"),component={controller:Controller,controllerAs:"vm",bindings:{onClose:"&"},template:require("../templates/login_form.html")};module.exports={component:component,Controller:Controller};

},{"../templates/login_form.html":143,"angular":"angular"}],63:[function(require,module,exports){
"use strict";function MarkdownController(e,t,n){function o(e){var t=e({text:r.value,selectionStart:r.selectionStart,selectionEnd:r.selectionEnd});r.value=t.text,r.selectionStart=t.selectionStart,r.selectionEnd=t.selectionEnd,r.focus(),s.onEditText({text:r.value})}function i(){scopeTimeout(n,function(){r.focus()},0)}var r=e[0].querySelector(".js-markdown-input"),c=e[0].querySelector(".js-markdown-preview"),s=this;this.insertBold=function(){o(function(e){return commands.toggleSpanStyle(e,"**","**","Bold")})},this.insertItalic=function(){o(function(e){return commands.toggleSpanStyle(e,"*","*","Italic")})},this.insertMath=function(){o(function(e){var t=e.text.slice(0,e.selectionStart);return 0===t.length||"\n"===t.slice(-1)||"$$"===t.slice(-2)?commands.toggleSpanStyle(e,"$$","$$","Insert LaTeX"):commands.toggleSpanStyle(e,"\\(","\\)","Insert LaTeX")})},this.insertLink=function(){o(function(e){return commands.convertSelectionToLink(e)})},this.insertIMG=function(){o(function(e){return commands.convertSelectionToLink(e,commands.LinkType.IMAGE_LINK)})},this.insertList=function(){o(function(e){return commands.toggleBlockStyle(e,"* ")})},this.insertNumList=function(){o(function(e){return commands.toggleBlockStyle(e,"1. ")})},this.insertQuote=function(){o(function(e){return commands.toggleBlockStyle(e,"> ")})},e.on("keydown",function(e){var t={66:s.insertBold,73:s.insertItalic,75:s.insertLink},n=t[e.keyCode];n&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),n())}),this.preview=!1,this.togglePreview=function(){s.preview=!s.preview};var l=debounce(function(){n.$apply(function(){s.onEditText({text:r.value})})},100);r.addEventListener("input",l),n.$watch("vm.text",function(){c.innerHTML=renderMarkdown(s.text||"",t),mediaEmbedder.replaceLinksWithEmbeds(c)}),this.showEditor=function(){return!s.readOnly&&!s.preview},n.$watch("vm.readOnly",function(){s.preview=!1}),n.$watch("vm.showEditor()",function(e){e&&(r.value=s.text||"",i())})}MarkdownController.$inject=["$element","$sanitize","$scope"];var debounce=require("lodash.debounce"),commands=require("../markdown-commands"),mediaEmbedder=require("../media-embedder"),renderMarkdown=require("../render-markdown"),scopeTimeout=require("../util/scope-timeout");module.exports={controller:MarkdownController,controllerAs:"vm",bindings:{customTextClass:"<?",readOnly:"<",text:"<?",onEditText:"&"},template:require("../templates/markdown.html")};

},{"../markdown-commands":103,"../media-embedder":104,"../render-markdown":118,"../templates/markdown.html":144,"../util/scope-timeout":164,"lodash.debounce":8}],64:[function(require,module,exports){
"use strict";function ModerationBannerController(n,t,o){this.flagCount=function(){return n.flagCount(this.annotationId)},this.isHidden=function(){return n.isHiddenByModerator(this.annotationId)},this.hideAnnotation=function(){o.annotation.hide({id:this.annotationId}).then(function(){n.annotationHiddenChanged(this.annotationId,!0)})["catch"](function(n){t.error(n.message)})},this.unhideAnnotation=function(){o.annotation.unhide({id:this.annotationId}).then(function(){n.annotationHiddenChanged(this.annotationId,!1)})["catch"](function(n){t.error(n.message)})}}ModerationBannerController.$inject=["annotationUI","flash","store"],module.exports={controller:ModerationBannerController,controllerAs:"vm",bindings:{annotationId:"<",isReply:"<"},template:require("../templates/moderation_banner.html")};

},{"../templates/moderation_banner.html":145}],65:[function(require,module,exports){
"use strict";module.exports={controller:function(){this.showDropdown=!1,this.privateLabel="Only Me",this.publishDestination=function(){return this.isShared?this.group.name:this.privateLabel},this.groupType=function(){return this.group["public"]?"public":"group"},this.setPrivacy=function(t){this.onSetPrivacy({level:t})}},controllerAs:"vm",bindings:{group:"<",canPost:"<",isShared:"<",onCancel:"&",onSave:"&",onSetPrivacy:"&"},template:require("../templates/publish_annotation_btn.html")};

},{"../templates/publish_annotation_btn.html":146}],66:[function(require,module,exports){
"use strict";function SearchInputController(n,e,t){var r=this,u=n.find("button"),o=n.find("input")[0],i=n.find("form")[0];u.on("click",function(){o.focus()}),t.$watch(function(){return e.pendingRequests.length},function(n){r.loading=n>0}),i.onsubmit=function(n){n.preventDefault(),r.onSearch({$query:o.value})},this.inputClasses=function(){return{"is-expanded":r.alwaysExpanded||r.query}},this.$onChanges=function(n){n.query&&(o.value=n.query.currentValue)}}SearchInputController.$inject=["$element","$http","$scope"],module.exports={controller:SearchInputController,controllerAs:"vm",bindings:{alwaysExpanded:"<",query:"<",onSearch:"&"},template:require("../templates/search_input.html")};

},{"../templates/search_input.html":147}],67:[function(require,module,exports){
"use strict";var uiConstants=require("../ui-constants");module.exports={controllerAs:"vm",controller:function(){this.TAB_ANNOTATIONS=uiConstants.TAB_ANNOTATIONS,this.TAB_NOTES=uiConstants.TAB_NOTES,this.TAB_ORPHANS=uiConstants.TAB_ORPHANS},bindings:{filterActive:"<",filterMatchCount:"<",onClearSelection:"&",searchQuery:"<",selectedTab:"<",selectionCount:"<",totalAnnotations:"<",totalNotes:"<"},template:require("../templates/search_status_bar.html")};

},{"../templates/search_status_bar.html":148,"../ui-constants":159}],68:[function(require,module,exports){
"use strict";var uiConstants=require("../ui-constants");module.exports={controllerAs:"vm",controller:["$element","annotationUI","features",function(t,n,s){this.TAB_ANNOTATIONS=uiConstants.TAB_ANNOTATIONS,this.TAB_NOTES=uiConstants.TAB_NOTES,this.TAB_ORPHANS=uiConstants.TAB_ORPHANS,this.selectTab=function(t){n.clearSelectedAnnotations(),n.selectTab(t)},this.orphansTabFlagEnabled=function(){return s.flagEnabled("orphans_tab")},this.showAnnotationsUnavailableMessage=function(){return this.selectedTab===this.TAB_ANNOTATIONS&&0===this.totalAnnotations&&!this.isWaitingToAnchorAnnotations},this.showNotesUnavailableMessage=function(){return this.selectedTab===this.TAB_NOTES&&0===this.totalNotes}}],bindings:{isLoading:"<",isWaitingToAnchorAnnotations:"<",selectedTab:"<",totalAnnotations:"<",totalNotes:"<",totalOrphans:"<"},template:require("../templates/selection_tabs.html")};

},{"../templates/selection_tabs.html":149,"../ui-constants":159}],69:[function(require,module,exports){
"use strict";function ShareDialogController(e,t,i,r){function n(e){return e.length?void(0===e[0].uri.indexOf(VIA_PREFIX)?o.viaPageLink=e[0].uri:o.viaPageLink=VIA_PREFIX+e[0].uri):void(o.viaPageLink="")}var o=this,a=t[0].querySelector(".js-via");a.focus(),a.select(),e.$watch(function(){return r.frames()},n),e.onShareClick=function(e){e&&i.track(i.events.DOCUMENT_SHARED,e)}}ShareDialogController.$inject=["$scope","$element","analytics","annotationUI"];var VIA_PREFIX="https://via.hypothes.is/";module.exports={controller:ShareDialogController,controllerAs:"vm",bindings:{onClose:"&"},template:require("../templates/share_dialog.html")};

},{"../templates/share_dialog.html":150}],70:[function(require,module,exports){
"use strict";function firstKey(t){for(var n in t)if(t.hasOwnProperty(n))return n;return null}function groupIDFromSelection(t,n){var e=firstKey(t),o=n.find(function(t){return t.id===e});return o?o.group:null}function SidebarContentController(t,n,e,o,r,a,i,s,u,c,l,f,d){function h(){return u.thread(e.getState())}function g(t){var n=[];t&&(n=[t.$tag]),i.focusAnnotations(n)}function p(t){t&&i.scrollToAnnotation(t.$tag)}function S(){if(e.getState().selectedAnnotationMap){var t=Object.keys(e.getState().selectedAnnotationMap)[0];return e.getState().annotations.find(function(n){return n.id===t})}return null}function v(){o.unloadAnnotations(e.savedAnnotations())}function A(n,r){var a=new SearchClient(d.search,{incremental:!!r});T.push(a),a.on("results",function(t){if(e.hasSelectedAnnotations()){var n=groupIDFromSelection(e.getState().selectedAnnotationMap,t);n||(n=s.focused().id),t=t.filter(function(t){return t.group===n}),s.focus(n)}t.length&&o.loadAnnotations(t)}),a.on("end",function(){t.$evalAsync(function(){T.splice(T.indexOf(a),1)}),e.frames().forEach(function(t){0<=n.indexOf(t.uri)&&e.updateFrameAnnotationFetchStatus(t.uri,!0)})}),a.get({uri:n,group:r})}function b(){return e.frames().some(function(t){return t.uri})?T.length>0:!0}function m(){v(),T.forEach(function(t){t.cancel()});var t=e.frames(),n=t.reduce(function(t,n){for(var e=0;e<n.searchUris.length;e++){var o=n.searchUris[e];-1===t.indexOf(o)&&t.push(o)}return t},[]),o=e.hasSelectedAnnotations()?null:s.focused().id;n.length>0&&(A(n,o),f.resetFilter().addClause("/uri","one_of",n),l.setConfig("filter",{filter:f.getFilter()}))}var C=this,O=e.subscribe(function(){var t=e.getState();C.rootThread=h(),C.selectedTab=t.selectedTab;var n=tabs.shouldSeparateOrphans(t),o=tabs.counts(t.annotations,n);Object.assign(C,{totalNotes:o.notes,totalAnnotations:o.annotations,totalOrphans:o.orphans,waitingToAnchorAnnotations:o.anchoring>0})});t.$on("$destroy",O);var T=[];t.$on("sidebarOpened",function(){n.track(n.events.SIDEBAR_OPENED),l.connect()}),"logged-in"===this.auth.status&&l.connect(),t.$on(events.USER_CHANGED,function(){l.reconnect()}),t.$on(events.ANNOTATIONS_SYNCED,function(t,n){var o=S();if(o){var r=n.some(function(t){return t===o.$tag});if(r){g(o),p(o);var a=tabs.shouldSeparateOrphans(e.getState());e.selectTab(tabs.tabForAnnotation(o,a))}}}),t.$on(events.GROUP_FOCUSED,function(){b()||(e.clearSelectedAnnotations(),m())}),t.$watch(function(){return e.frames().map(function(t){return t.uri})},m,!0),this.setCollapsed=function(t,n){e.setCollapsed(t,n)},this.forceVisible=function(t){e.setForceVisible(t.id,!0),t.parent&&e.setCollapsed(t.parent.id,!1)},this.focus=g,this.scrollTo=p,this.selectedAnnotationCount=function(){var t=e.getState().selectedAnnotationMap;return t?Object.keys(t).length:0},this.selectedAnnotationUnavailable=function(){var t=firstKey(e.getState().selectedAnnotationMap);return!b()&&!!t&&!e.annotationExists(t)},this.shouldShowLoggedOutMessage=function(){if("logged-out"!==C.auth.status)return!1;if(!c.annotations)return!1;var t=firstKey(e.getState().selectedAnnotationMap);return!b()&&!!t&&e.annotationExists(t)},this.isLoading=b;var $=memoize(function(t){return t.children.reduce(function(t,n){return t+$(n)},t.visible?1:0)});this.visibleCount=function(){return $(h())},this.topLevelThreadCount=function(){return h().totalChildren},this.clearSelection=function(){var t=e.getState().selectedTab;e.getState().selectedTab&&e.getState().selectedTab!==uiConstants.TAB_ORPHANS||(t=uiConstants.TAB_ANNOTATIONS),e.clearSelectedAnnotations(),e.selectTab(t)}}SidebarContentController.$inject=["$scope","analytics","annotationUI","annotationMapper","drafts","features","frameSync","groups","rootThread","settings","streamer","streamFilter","store"];var SearchClient=require("../search-client"),events=require("../events"),memoize=require("../util/memoize"),tabs=require("../tabs"),uiConstants=require("../ui-constants");module.exports={controller:SidebarContentController,controllerAs:"vm",bindings:{auth:"<",search:"<"},template:require("../templates/sidebar_content.html")};

},{"../events":90,"../search-client":121,"../tabs":129,"../templates/sidebar_content.html":151,"../ui-constants":159,"../util/memoize":163}],71:[function(require,module,exports){
"use strict";function SidebarTutorialController(r){this.showSidebarTutorial=function(){return!(!r.state.preferences||!r.state.preferences.show_sidebar_tutorial)},this.dismiss=function(){r.dismissSidebarTutorial()}}SidebarTutorialController.$inject=["session"],module.exports={component:{controller:SidebarTutorialController,controllerAs:"vm",bindings:{},template:require("../templates/sidebar_tutorial.html")},Controller:SidebarTutorialController};

},{"../templates/sidebar_tutorial.html":152}],72:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",controller:function(){},bindings:{sortKey:"<",sortKeysAvailable:"<",onChangeSortKey:"&"},template:require("../templates/sort_dropdown.html")};

},{"../templates/sort_dropdown.html":153}],73:[function(require,module,exports){
"use strict";function StreamContentController(e,t,r,o,n,s,a,i,l,c,u,h){var p=this;s.setAppIsSidebar(!1);var d=0,f=function(e){d+=e.rows.length,n.loadAnnotations(e.rows,e.replies)},m=function(e){var t=Object.assign({_separate_replies:!0,offset:d,limit:e},l.toObject(o.q));c.search(t).then(f)["catch"](function(e){console.error(e)})},b=o.q;e.$on("$routeUpdate",function(){o.q!==b&&(s.clearAnnotations(),r.reload())}),u.resetFilter().setMatchPolicyIncludeAll();var q=l.generateFacetedFilter(o.q);a.populateFilter(u,q),h.setConfig("filter",{filter:u.getFilter()}),h.connect(),m(20),this.setCollapsed=s.setCollapsed,this.forceVisible=function(e){s.setForceVisible(e,!0)},Object.assign(this.search,{query:function(){return o.q||""},update:function(e){t.search({q:e})}}),s.subscribe(function(){p.rootThread=i.thread(s.getState())}),s.setSortKey("Newest"),this.loadMore=m}StreamContentController.$inject=["$scope","$location","$route","$routeParams","annotationMapper","annotationUI","queryParser","rootThread","searchFilter","store","streamFilter","streamer"],module.exports={controller:StreamContentController,controllerAs:"vm",bindings:{search:"<"},template:require("../templates/stream_content.html")};

},{"../templates/stream_content.html":154}],74:[function(require,module,exports){
"use strict";function SvgIconController(n){if(!icons[this.name])throw new Error("Unknown icon: "+this.name);n[0].innerHTML=icons[this.name]}SvgIconController.$inject=["$element"];var icons={refresh:require("../../images/icons/refresh.svg")};module.exports={controllerAs:"vm",controller:SvgIconController,bindings:{name:"<"}};

},{"../../images/icons/refresh.svg":37}],75:[function(require,module,exports){
"use strict";function TagEditorController(t){this.onTagsChanged=function(){t.store(this.tagList);var e=this.tagList.map(function(t){return t.text});this.onEditTags({tags:e})},this.autocomplete=function(e){return Promise.resolve(t.filter(e))},this.$onChanges=function(t){t.tags&&(this.tagList=t.tags.currentValue.map(function(t){return{text:t}}))}}TagEditorController.$inject=["tags"],module.exports={controller:TagEditorController,controllerAs:"vm",bindings:{tags:"<",onEditTags:"&"},template:require("../templates/tag_editor.html")};

},{"../templates/tag_editor.html":155}],76:[function(require,module,exports){
"use strict";function getThreadHeight(e){var t=document.getElementById(e);if(!t)return null;var o=t.getBoundingClientRect().height,r=window.getComputedStyle(t),n=parseFloat(r.marginTop)+parseFloat(r.marginBottom);return o+n}function closestScrollableAncestor(e){for(var t=e;t!==document.body;){var o=window.getComputedStyle(t);if("scroll"===o.overflowY)return t;t=t.parentElement}return t}function ThreadListController(e,t,o){function r(e){var t=i.scrollRoot.scrollHeight-i.scrollRoot.clientHeight;return Math.min(t,l.yOffsetOf(e))}function n(e){var o=r(e);i.scrollRoot.scrollTop=o,scopeTimeout(t,function(){var t=r(e);t!==o&&n(e)},200)}var i=this;this.scrollRoot=closestScrollableAncestor(e[0]);var a=Object.assign({scrollRoot:this.scrollRoot},virtualThreadOptions),l=new o(t,window,this.thread,a);l.on("changed",function(e){i.virtualThreadList={visibleThreads:e.visibleThreads,invisibleThreads:e.invisibleThreads,offscreenUpperHeight:e.offscreenUpperHeight+"px",offscreenLowerHeight:e.offscreenLowerHeight+"px"},scopeTimeout(t,function(){e.visibleThreads.forEach(function(e){var t=getThreadHeight(e.id);t&&l.setThreadHeight(e.id,t)})},50)}),t.$on(events.BEFORE_ANNOTATION_CREATED,function(e,t){t.$highlight||metadata.isReply(t)||(i.onClearSelection(),n(t.$tag))}),this.$onChanges=function(e){e.thread&&l.setRootThread(e.thread.currentValue)},this.$onDestroy=function(){l.detach()}}ThreadListController.$inject=["$element","$scope","VirtualThreadList"];var events=require("../events"),metadata=require("../annotation-metadata"),scopeTimeout=require("../util/scope-timeout"),virtualThreadOptions={invisibleThreadFilter:function(e){return e.annotation.$highlight&&metadata.isNew(e.annotation)}};module.exports={controller:ThreadListController,controllerAs:"vm",bindings:{thread:"<",showDocumentInfo:"<",onForceVisible:"&",onFocus:"&",onSelect:"&",onChangeCollapsed:"&",onClearSelection:"&"},template:require("../templates/thread_list.html")};

},{"../annotation-metadata":45,"../events":90,"../templates/thread_list.html":156,"../util/scope-timeout":164}],77:[function(require,module,exports){
"use strict";function TimestampController(t,e){function i(){m.relativeTimestamp=e.toFuzzyString(m.timestamp),m.absoluteTimestamp=dateUtil.format(new Date(m.timestamp)),m.timestamp&&(a&&a(),a=e.decayingInterval(m.timestamp,function(){i(),t.$digest()}))}this.relativeTimestamp=null,this.absoluteTimestamp="";var a,m=this;this.$onChanges=function(t){t.timestamp&&i()},this.$onDestroy=function(){a&&a()}}TimestampController.$inject=["$scope","time"];var dateUtil=require("../date-util");module.exports={controller:TimestampController,controllerAs:"vm",bindings:{className:"<",href:"<",timestamp:"<"},template:['<a class="{{vm.className}}" target="_blank" ng-title="vm.absoluteTimestamp"',' href="{{vm.href}}"',">{{vm.relativeTimestamp}}</a>"].join("")};

},{"../date-util":79}],78:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",bindings:{auth:"<",isSidebar:"<",onShowHelpPanel:"&",onLogin:"&",onLogout:"&",onSharePage:"&",onSignUp:"&",searchController:"<",sortKey:"<",sortKeysAvailable:"<",onChangeSortKey:"&",pendingUpdateCount:"<",onApplyPendingUpdates:"&"},template:require("../templates/top_bar.html")};

},{"../templates/top_bar.html":157}],79:[function(require,module,exports){
"use strict";function format(t){return"undefined"!=typeof Intl&&Intl.DateTimeFormat?(formatter||(formatter=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})),formatter.format(t)):t.toDateString()+" "+t.toLocaleTimeString()}var formatter;module.exports={format:format};

},{}],80:[function(require,module,exports){
module.exports=function(){return{link:function(r,n,e,t){var o,i,l,u,d,s,a;return l=t[0],a=t[1],l?(i="form-field",o="form-field-error",u=l.$render,d=function(r){return l.$setValidity("response",!0),r},s=function(r){return n.toggleClass(o,r),n.parent().toggleClass(o,r)},l.$parsers.unshift(d),l.$render=function(){return s(l.$invalid&&l.$dirty),u()},null!=a&&(a.addControl(l),r.$on("$destroy",function(){return a.removeControl(l)})),r.$watch(function(){(null!=l.$modelValue||l.$pristine)&&s(l.$invalid&&l.$dirty)})):void 0},require:["?ngModel","^?formValidate"],restrict:"C"}};

},{}],81:[function(require,module,exports){
module.exports=function(){return{controller:function(){var n;return n={},{addControl:function(e){return e.$name?n[e.$name]=e:void 0},removeControl:function(e){return e.$name?delete n[e.$name]:void 0},submit:function(){var e,r,t;t=[];for(e in n)r=n[e],r.$setViewValue(r.$viewValue),t.push(r.$render());return t}}},link:function(n,e,r,t){return e.on("submit",function(){return t.submit()})}}};

},{}],82:[function(require,module,exports){
"use strict";module.exports=function(){return{restrict:"A",link:function(t,n){n[0].focus()}}};

},{}],83:[function(require,module,exports){
"use strict";function BrandingDirective(n){var r=!!n.branding,o={highlightColor:"color",appBackgroundColor:"backgroundColor",ctaBackgroundColor:"backgroundColor",ctaTextColor:"color",selectionFontFamily:"fontFamily",annotationFontFamily:"fontFamily"},t=function(n){return n.split(",").map(function(n){return n.trim()}).filter(function(n){return n in o})};return{restrict:"A",link:function(i,a,c){r&&t(c.hBranding).forEach(function(r){var t=n.branding[r];t&&(a[0].style[o[r]]=t)})}}}BrandingDirective.$inject=["settings"],module.exports=BrandingDirective;

},{}],84:[function(require,module,exports){
"use strict";function addEventHandler(n,t,e,o){var r=function(t){n.$apply(function(){o(n,{$event:t})})};e.forEach(function(n){t.addEventListener(n,r)})}module.exports=function(n){return{restrict:"A",link:function(t,e,o){var r=n(o.hOnTouch,null);addEventHandler(t,e[0],["click","mousedown","touchstart"],r)}}},module.exports.$inject=["$parse"];

},{}],85:[function(require,module,exports){
"use strict";function Tooltip(t){this.setState=function(t){this.state=Object.freeze(Object.assign({},this.state,t)),this.render()},this.render=function(){var t=7;if(!this.state.target)return void(this._el.style.visibility="hidden");var e=this.state.target,i=e.getAttribute("aria-label");this._labelEl.textContent=i;var o,s=this._el.getBoundingClientRect(),l=e.getBoundingClientRect();o="up"===this.state.direction?l.bottom+t:l.top-s.height-t;var n=l.right-s.width;this._el.classList.toggle("tooltip--up","up"===this.state.direction),this._el.classList.toggle("tooltip--down","down"===this.state.direction),Object.assign(this._el.style,{visibility:"",top:o+"px",left:n+"px"})},this._el=t.ownerDocument.createElement("div"),this._el.innerHTML='<span class="tooltip-label js-tooltip-label"></span>',this._el.className="tooltip",t.appendChild(this._el),this._labelEl=this._el.querySelector(".js-tooltip-label"),this.setState({direction:"down"})}var theTooltip;module.exports=function(){return theTooltip||(theTooltip=new Tooltip(document.body)),{restrict:"A",link:function(t,e){var i=e[0];i.addEventListener("mouseover",function(){var t=i.getAttribute("tooltip-direction")||"down";theTooltip.setState({direction:t,target:i})}),i.addEventListener("mouseout",function(){theTooltip.setState({target:null})}),t.$on("$destroy",function(){theTooltip.state.target===i&&theTooltip.setState({target:null})})}}};

},{}],86:[function(require,module,exports){
"use strict";module.exports=["$animate",function(n){return{link:function(t,e){n.enabled(!1,e)},restrict:"C",template:"<span><span></span></span>"}}];

},{}],87:[function(require,module,exports){
module.exports=["$compile",function(n){var s,t,a,e;return s="status-button-state",t="loading",a="success",e='<span class="btn-with-message">\n  <span class="btn-message btn-message-loading">\n    <span class="btn-icon spinner"></span>\n  </span>\n  <span class="btn-message btn-message-success">\n    <span class="btn-message-text">Saved!</span> <i class="btn-message-icon h-icon-check"></i>\n  </span>\n</span>',{link:function(r,o,c,u,i){var l,p;if(p=c.statusButton,!p)throw new Error("status-button attribute should provide a form name");return l=angular.element(e).attr(s,""),n(l)(r),o.after(l),i(r,function(n){return l.append(n)}),r.$on("formState",function(n,e,r){return e===p?(r!==t&&r!==a&&(r=""),l.attr(s,r)):void 0})},transclude:"element"}}];

},{}],88:[function(require,module,exports){
"use strict";module.exports=function(){return{link:function(e,n,o){function t(){var n=l.clientHeight,t=l.scrollHeight;c.scrollY+n>=t-n?r&&(r=!1,e.$apply(o.windowScroll)):r=!0}var r=!0,l=n.prop("ownerDocument").documentElement,c=n.prop("ownerDocument").defaultView;c.addEventListener("scroll",t,!1),e.$on("$destroy",function(){c.removeEventListener("scroll",t)})}}};

},{}],89:[function(require,module,exports){
"use strict";function isEmpty(t){return t?!t.text&&0===t.tags.length:!0}function DraftStore(){function t(t,i){return t.model.$tag&&i.$tag===t.model.$tag||t.model.id&&i.id===t.model.id}this._drafts=[],this.count=function(){return this._drafts.length},this.unsaved=function(){return this._drafts.filter(function(t){return!t.model.id}).map(function(t){return t.model})},this.get=function(i){for(var r=0;r<this._drafts.length;r++){var e=this._drafts[r];if(t(e,i))return{isPrivate:e.isPrivate,tags:e.tags,text:e.text}}return null},this.getIfNotEmpty=function(t){var i=this.get(t);return isEmpty(i)?null:i},this.update=function(t,i){var r={model:{id:t.id,$tag:t.$tag},isPrivate:i.isPrivate,tags:i.tags,text:i.text};this.remove(t),this._drafts.push(r)},this.remove=function(i){this._drafts=this._drafts.filter(function(r){return!t(r,i)})},this.discard=function(){this._drafts=[]}}module.exports=function(){return new DraftStore};

},{}],90:[function(require,module,exports){
"use strict";module.exports={GROUPS_CHANGED:"groupsChanged",USER_CHANGED:"userChanged",GROUP_FOCUSED:"groupFocused",BEFORE_ANNOTATION_CREATED:"beforeAnnotationCreated",ANNOTATIONS_SYNCED:"sync",ANNOTATION_CREATED:"annotationCreated",ANNOTATION_DELETED:"annotationDeleted",ANNOTATION_FLAGGED:"annotationFlagged",ANNOTATION_UPDATED:"annotationUpdated",ANNOTATIONS_LOADED:"annotationsLoaded",ANNOTATIONS_UNLOADED:"annotationsUnloaded"};

},{}],91:[function(require,module,exports){
"use strict";function features(e,t){function r(r){if(t.load(),!t.state.features)return!1;var n=t.state.features;return r in n?n[r]:(e.warn("looked up unknown feature",r),!1)}return{flagEnabled:r}}features.$inject=["$log","session"],module.exports=features;

},{}],92:[function(require,module,exports){
"use strict";function parseAccountID(r){if(!r)return null;var e=r.match(/^acct:([^@]+)@(.+)/);return e?{username:e[1],provider:e[2]}:null}function username(r){var e=parseAccountID(r);return e?e.username:""}function isThirdPartyUser(r,e){var n=parseAccountID(r);return n?n.provider!==e:!1}module.exports={isThirdPartyUser:isThirdPartyUser,parseAccountID:parseAccountID,username:username};

},{}],93:[function(require,module,exports){
"use strict";function encode(e){return e?window.encodeURIComponent(e):""}module.exports={encode:encode};

},{}],94:[function(require,module,exports){
module.exports=["toastr",function(n){return{info:angular.bind(n,n.info),success:angular.bind(n,n.success),warning:angular.bind(n,n.warning),error:angular.bind(n,n.error)}}];

},{}],95:[function(require,module,exports){
var hasProp={}.hasOwnProperty;module.exports=function(){return function(r,e,s){var o,n,a;r.$setValidity("response",!s),r.responseErrorMessage=s,a=[];for(n in e)hasProp.call(e,n)&&(o=e[n],s||""!==n?(r[n].$setValidity("response",!1),a.push(r[n].responseErrorMessage=o)):(r.$setValidity("response",!1),r.responseErrorMessage=o));return a}};

},{}],96:[function(require,module,exports){
"use strict";function formatAnnot(n){return{tag:n.$tag,msg:{document:n.document,target:n.target,uri:n.uri}}}function FrameSync(n,t,a,o,e){function r(){var n=[],t=[],a=0;o.subscribe(function(){var r=o.getState();if(r.annotations!==n||r.frames!==t){var i=0,c=new Set,u=[];r.annotations.forEach(function(n){metadata.isReply(n)||(metadata.isPublic(n)&&++i,c.add(n.$tag),s.has(n.$tag)||u.push(n))});var f=n.filter(function(n){return!c.has(n.$tag)});n=r.annotations,t=r.frames,u.length>0&&(e.call("loadAnnotations",u.map(formatAnnot)),u.forEach(function(n){s.add(n.$tag)})),f.forEach(function(n){e.call("deleteAnnotation",formatAnnot(n)),s["delete"](n.$tag)});var d=o.frames();d.length>0&&d.every(function(n){return n.isAnnotationFetchComplete})&&(0!==i&&i===a||(e.call(bridgeEvents.PUBLIC_ANNOTATION_COUNT_CHANGED,i),a=i))}})}function i(){e.on("beforeCreateAnnotation",function(t){s.add(t.tag);var a=Object.assign({},t.msg,{$tag:t.tag});n.$broadcast(events.BEFORE_ANNOTATION_CREATED,a)}),e.on("sync",function(t){t.forEach(function(t){s.add(t.tag),o.updateAnchorStatus(null,t.tag,t.msg.$orphan),n.$broadcast(events.ANNOTATIONS_SYNCED,[t.tag])})}),e.on("showAnnotations",function(n){o.selectAnnotations(o.findIDsForTags(n)),o.selectTab(uiConstants.TAB_ANNOTATIONS)}),e.on("focusAnnotations",function(n){o.focusAnnotations(n||[])}),e.on("toggleAnnotationSelection",function(n){o.toggleSelectedAnnotations(o.findIDsForTags(n))}),e.on("sidebarOpened",function(){n.$broadcast("sidebarOpened")})}function c(n){n.call("getDocumentInfo",function(t,a){var e=[];t?n.destroy():e=[a.uri];var r;a.metadata&&a.metadata.documentFingerprint&&(r=a.metadata.documentFingerprint,e=a.metadata.link.map(function(n){return n.href})),o.connectFrame({uri:a.uri,searchUris:e,documentFingerprint:r})})}var s=new Set;this.connect=function(){var n=new a(window,{server:!0});n.startDiscovery(e.createChannel.bind(e)),e.onConnect(c),r(),i()},this.focusAnnotations=function(n){e.call("focusAnnotations",n)},this.scrollToAnnotation=function(n){e.call("scrollToAnnotation",n)}}FrameSync.$inject=["$rootScope","$window","Discovery","annotationUI","bridge"];var events=require("./events"),bridgeEvents=require("../shared/bridge-events"),metadata=require("./annotation-metadata"),uiConstants=require("./ui-constants");module.exports={"default":FrameSync,formatAnnot:formatAnnot};

},{"../shared/bridge-events":38,"./annotation-metadata":45,"./events":90,"./ui-constants":159}],97:[function(require,module,exports){
"use strict";var loaded=!1;module.exports=function(e){loaded||(loaded=!0,function(e,t,a,o,c,n,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,n=t.createElement(a),s=t.getElementsByTagName(a)[0],n.async=1,n.src=o,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create",e,"auto"),ga("set","checkProtocolTask",null))};

},{}],98:[function(require,module,exports){
"use strict";function groups(e,t,r,n,o){function u(){return r.state.groups||[]}function s(e){for(var t=u(),r=0,n=t.length;n>r;r++)if(t[r].id===e)return t[r];return null}function i(e){var r=o({method:"POST",url:t("groups.leave",{id:e})});return r}function c(){if(v)return v;var t=s(e.getItem(STORAGE_KEY));return t?v=t:u()[0]}function a(t){var r=c(),o=s(t);o&&(v=o,e.setItem(STORAGE_KEY,o.id),r.id!==o.id&&n.$broadcast(events.GROUP_FOCUSED,o.id))}var v;return n.$on(events.GROUPS_CHANGED,function(){v&&(v=s(v.id),v||n.$broadcast(events.GROUP_FOCUSED,c()))}),{all:u,get:s,leave:i,focused:c,focus:a}}groups.$inject=["localStorage","serviceUrl","session","$rootScope","$http"];var STORAGE_KEY="hypothesis.groups.focus",events=require("./events");module.exports=groups;

},{"./events":90}],99:[function(require,module,exports){
"use strict";function hostPageConfig(e){var r=queryString.parse(e.location.search).config,n=JSON.parse(r||"{}"),i=["annotations","query","appType","openLoginForm","openSidebar","showHighlights","services","branding"];return Object.keys(n).reduce(function(e,r){return-1!==i.indexOf(r)&&(e[r]=n[r]),e},{})}var queryString=require("query-string");module.exports=hostPageConfig;

},{"query-string":13}],100:[function(require,module,exports){
var hasProp={}.hasOwnProperty;module.exports=["$window","bridge",function(n,r){var e,o,i,a,t;a={showSidebar:function(){return e("show")},hideSidebar:function(){return e("hide")}},e=function(e){var o,i,a,t,u,d,h;for(t=r.links,d=[],i=0,a=t.length;a>i;i++)if(u=t[i],o=u.channel,h=u.window,h===n.parent){o.call(e);break}return d},i={back:function(){return a.hideSidebar()},open:function(){return a.showSidebar()}};for(o in i)hasProp.call(i,o)&&(t=i[o],r.on(o,t));return a}];

},{}],101:[function(require,module,exports){
"use strict";function cacheBustURL(e){var n=e,t=queryString.parse({timestamp:Date.now()});return n+=-1!==e.indexOf("?")?"&"+t:"?"+t}function didAssetChange(e,n){return n.some(function(n){return-1!==e.indexOf(n)})}function maybeReloadElement(e,n){var t=e.parentNode,r=e.cloneNode(),o=["href","src"];o.forEach(function(t){t in e&&didAssetChange(e[t],n)&&(r[t]=cacheBustURL(e[t]))}),t.replaceChild(r,e)}function reloadExternalStyleSheets(e){var n=[].slice.apply(document.querySelectorAll("link"));n.forEach(function(n){maybeReloadElement(n,e)})}function connect(e){var n=new Socket(e);n.on("open",function(){console.log("Live reload client listening")}),n.on("message",function(e){var n=JSON.parse(e.data);if("assets-changed"===n.type){var t=n.changed.some(function(e){return e.match(/\.(html|js)$/)}),r=n.changed.some(function(e){return e.match(/\.css$/)});if(t)return void window.top.postMessage({type:"reloadrequest"},"*");r&&reloadExternalStyleSheets(n.changed)}}),n.on("error",function(e){console.error("Error connecting to live reload server:",e)})}var queryString=require("query-string"),Socket=require("./websocket");module.exports={connect:connect};

},{"./websocket":169,"query-string":13}],102:[function(require,module,exports){
module.exports=["$window",function(t){var e;return e=function(){var e,r;e="hypothesis.testKey";try{return t.localStorage.setItem(e,e),t.localStorage.removeItem(e),t.localStorage}catch(n){return r={},{getItem:function(t){return t in r?r[t]:null},setItem:function(t,e){return r[t]=e},removeItem:function(t){return delete r[t]}}}}(),{getItem:function(t){return e.getItem(t)},getObject:function(t){var r;return r=e.getItem(t),r?JSON.parse(r):null},setItem:function(t,r){return e.setItem(t,r)},setObject:function(t,r){var n;return n=JSON.stringify(r),e.setItem(t,n)},removeItem:function(t){return e.removeItem(t)}}}];

},{}],103:[function(require,module,exports){
"use strict";function replaceText(e,t,n,l){var r=e.selectionStart,i=e.selectionEnd;return r>=t+n?(r+=l.length-n,i+=l.length-n):t>=i||(t>=r&&i>=t+n?i+=l.length-n:t>r&&t+n>i?r=t:t+n>r&&i>t+n?i+=l.length-n:r>t&&t+n>i&&(r=t,i=t+n)),{text:e.text.slice(0,t)+l+e.text.slice(t+n),selectionStart:r,selectionEnd:i}}function convertSelectionToLink(e,t){"undefined"==typeof t&&(t=LinkType.ANCHOR_LINK);var n=e.text.slice(e.selectionStart,e.selectionEnd),l="";t===LinkType.IMAGE_LINK&&(l="!");var r;if(n.match(/[a-z]+:\/\/.*/)){var i="Description";return r=replaceText(e,e.selectionStart,n.length,l+"["+i+"]("+n+")"),r.selectionStart=e.selectionStart+l.length+1,r.selectionEnd=r.selectionStart+i.length,r}var c=l+"["+n+"](",o="http://insert-your-link-here.com";return r=replaceText(e,e.selectionStart,n.length,c+o+")"),r.selectionStart=e.selectionStart+c.length,r.selectionEnd=r.selectionStart+o.length,r}function toggleSpanStyle(e,t,n,l){"undefined"==typeof n&&(n=t);var r=e.text.slice(e.selectionStart-t.length,e.selectionStart),i=e.text.slice(e.selectionEnd,e.selectionEnd+t.length),c=e;return e.selectionStart===e.selectionEnd&&l&&(c=replaceText(e,e.selectionStart,0,l),c.selectionStart=c.selectionEnd-l.length),r===t&&i===n?(c=replaceText(c,c.selectionStart-t.length,t.length,""),c=replaceText(c,c.selectionEnd,n.length,"")):(c=replaceText(c,c.selectionStart,0,t),c=replaceText(c,c.selectionEnd,0,n)),c}function startOfLine(e,t){var n=e.lastIndexOf("\n",t);return 0>n?0:n+1}function endOfLine(e,t){var n=e.indexOf("\n",t);return 0>n?e.length:n}function transformLines(e,t,n,l){for(var r=startOfLine(e.text,t),i=endOfLine(e.text,t);i<=endOfLine(e.text,n);){var c=i===e.text.length,o=i-r;e=l(e,r,i);var a=endOfLine(e.text,r)-r;if(n+=a-o,c)break;r=r+a+1,i=endOfLine(e.text,r)}return e}function toggleBlockStyle(e,t){var n=e.selectionStart,l=e.selectionEnd,r=!0;return transformLines(e,n,l,function(e,n){return e.text.slice(n,n+t.length)!==t&&(r=!1),e}),r?transformLines(e,n,l,function(e,n){return replaceText(e,n,t.length,"")}):transformLines(e,n,l,function(e,n){return e.text.slice(n,n+t.length)===t?e:replaceText(e,n,0,t)})}var LinkType={ANCHOR_LINK:0,IMAGE_LINK:1};module.exports={toggleSpanStyle:toggleSpanStyle,toggleBlockStyle:toggleBlockStyle,convertSelectionToLink:convertSelectionToLink,LinkType:LinkType};

},{}],104:[function(require,module,exports){
"use strict";function iframe(e){var t=document.createElement("iframe");return t.src=e,t.classList.add("annotation-media-embed"),t.setAttribute("frameborder","0"),t.setAttribute("allowfullscreen",""),t}function youTubeEmbed(e){return iframe("https://www.youtube.com/embed/"+e)}function vimeoEmbed(e){return iframe("https://player.vimeo.com/video/"+e)}function embedForLink(e){var t,n;for(n=0;n<embedGenerators.length;n++)if(t=embedGenerators[n](e))return t;return null}function replaceLinkWithEmbed(e){if(e.href===e.textContent){var t=embedForLink(e);t&&e.parentElement.replaceChild(t,e)}}function replaceLinksWithEmbeds(e){var t=e.getElementsByTagName("a");t=Array.prototype.slice.call(t,0);var n;for(n=0;n<t.length;n++)replaceLinkWithEmbed(t[n])}var embedGenerators=[function(e){if("www.youtube.com"!==e.hostname)return null;if(!/\/watch\/?/.test(e.pathname))return null;var t=/[&\?]v=([^&#]+)/.exec(e.search);return t?youTubeEmbed(t[1]):null},function(e){if("youtu.be"!==e.hostname)return null;var t=/^\/([^\/]+)\/?$/.exec(e.pathname);return t?youTubeEmbed(t[1]):null},function(e){if("vimeo.com"!==e.hostname)return null;var t=/^\/([^\/\?#]+)\/?$/.exec(e.pathname);return t?vimeoEmbed(t[1]):null},function(e){if("vimeo.com"!==e.hostname)return null;var t=/^\/channels\/[^\/]+\/([^\/?#]+)\/?$/.exec(e.pathname);return t?vimeoEmbed(t[1]):null}];module.exports={replaceLinksWithEmbeds:replaceLinksWithEmbeds};

},{}],105:[function(require,module,exports){
"use strict";function auth(e,r){function t(e){var r=e.data;return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}function n(r){r=queryString.stringify(r);var t={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return e.post(f,r,t)}function o(e){var r={grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:e};return n(r).then(function(e){if(200!==e.status)throw new Error("Failed to retrieve access token");return t(e)})}function s(e){var r={grant_type:"refresh_token",refresh_token:e};n(r).then(function(e){var r=t(e);i(r),c=Promise.resolve(r.accessToken)})}function i(e){var r=1e3*e.expiresIn;r=Math.floor(.91*r),window.setTimeout(s,r,e.refreshToken)}function a(){if(!c){var e;Array.isArray(r.services)&&r.services.length>0&&(e=r.services[0].grantToken),c=e?o(e).then(function(e){return i(e),e.accessToken}):Promise.resolve(null)}return c}function u(){}var c,f=resolve("token",r.apiUrl);return{clearCache:u,tokenGetter:a}}auth.$inject=["$http","settings"];var queryString=require("query-string"),resolve=require("./util/url-util").resolve;module.exports=auth;

},{"./util/url-util":165,"query-string":13}],106:[function(require,module,exports){
var STORAGE_KEY,indexOf=[].indexOf||function(r){for(var t=0,e=this.length;e>t;t++)if(t in this&&this[t]===r)return t;return-1};STORAGE_KEY="hypothesis.privacy",module.exports=["session","localStorage",function(r,t){var e,n,i,a;return n={},i="group:__world__",e=[{allow:!0,principal:i,action:n}],a=function(r){var t,n,i,a,u;return n=function(){var e,n;e=r.permissions||[],n=[];for(t in e)u=e[t],n.push(function(){var r,e,n;for(n=[],r=0,e=u.length;e>r;r++)a=u[r],n.push({allow:!0,principal:a,action:t});return n}());return n}(),n.length?(i=Array.prototype).concat.apply(i,n):e},{"private":function(){return r.state.userid?{read:[r.state.userid],update:[r.state.userid],"delete":[r.state.userid],admin:[r.state.userid]}:null},shared:function(t){return r.state.userid?(t=null!=t?"group:"+t:i,{read:[t],update:[r.state.userid],"delete":[r.state.userid],admin:[r.state.userid]}):null},"default":function(r){var e;return e=t.getItem(STORAGE_KEY),"private"!==e&&"shared"!==e&&(e="shared"),"private"===e?this["private"]():this.shared(r)},setDefault:function(r){return t.setItem(STORAGE_KEY,r)},isShared:function(r,t){return t=null!=t?"group:"+t:i,indexOf.call((null!=r?r.read:void 0)||[],t)>=0},isPrivate:function(r,t){return t&&angular.equals((null!=r?r.read:void 0)||[],[t])},permits:function(r,t,e){var u,s,l,o,d,p;for(s=a(t),l=0,o=s.length;o>l;l++)if(u=s[l],!((d=u.principal)!==e&&d!==i||(p=u.action)!==r&&p!==n))return u.allow;return!1}}}];

},{}],107:[function(require,module,exports){
var QueryParser,bind=function(t,r){return function(){return t.apply(r,arguments)}};module.exports=QueryParser=function(){function t(){this.populateFilter=bind(this.populateFilter,this)}return t.prototype.rules={user:{path:"/user",and_or:"or"},text:{path:"/text",and_or:"and"},tag:{path:"/tags",and_or:"and"},quote:{path:"/quote",and_or:"and"},uri:{formatter:function(t){return t.toLowerCase()},path:"/uri",and_or:"or",options:{es:{query_type:"match",cutoff_frequency:.001,and_or:"and"}}},since:{formatter:function(t){var r;return r=function(){switch(t){case"5 min":return 300;case"30 min":return 1800;case"1 hour":return 3600;case"12 hours":return 43200;case"1 day":return 86400;case"1 week":return 604800;case"1 month":return 2592e3;case"1 year":return 31536e3}}(),new Date((new Date).valueOf()-1e3*r)},path:"/created",and_or:"and",operator:"ge"},any:{and_or:"and",path:["/quote","/tags","/text","/uri","/user"],options:{es:{query_type:"multi_match",match_type:"cross_fields",and_or:"and",fields:["quote","tags","text","uri.parts","user"]}}}},t.prototype.populateFilter=function(t,r){var e,a,n,o,u,s,i,p,l,c,h,d,f,_,m;p=[];for(n in r)if(_=r[n],null!=this.rules[n]&&(d=_.terms,d.length))if(l=this.rules[n],a=null!=l.case_sensitive?l.case_sensitive:!1,e=null!=l.and_or?l.and_or:"or",s=null!=l.path?l.path:"/"+n,"or"===e){for(i=null!=l.operator?l.operator:"match_of",m=[],o=0,u=d.length;u>o;o++)h=d[o],c=l.formatter?l.formatter(h):h,m.push(c);p.push(t.addClause(s,i,m,a,l.options))}else i=null!=l.operator?l.operator:"matches",p.push(function(){var r,e,n;for(n=[],r=0,e=d.length;e>r;r++)f=d[r],m=l.formatter?l.formatter(f):f,n.push(t.addClause(s,i,m,a,l.options));return n}());return p},t}();

},{}],108:[function(require,module,exports){
"use strict";function convertLocalURLsToFilenames(e){return e?e.match(/https?:/)?e:e.replace(/\?.*/,"").split("/").slice(-1)[0]:e}function translateSourceURLs(e){try{var n=e.exception.values[0].stacktrace.frames;n.forEach(function(e){e.filename=convertLocalURLsToFilenames(e.filename)}),e.culprit=n[0].filename}catch(a){console.warn("Failed to normalize error stack trace",a,e)}return e}function init(e){Raven.config(e.dsn,{release:"1.9.0",dataCallback:translateSourceURLs}).install(),installUnhandledPromiseErrorHandler()}function setUserInfo(e){e?Raven.setUserContext(e):Raven.setUserContext()}function angularModule(e){var n=Raven._globalOptions.dataCallback;angularPlugin(Raven,e);var a=Raven._globalOptions.dataCallback;return Raven.setDataCallback(function(e){return a(n(e))}),e.module("ngRaven")}function report(e,n,a){e instanceof Error||"object"==typeof e&&e.message&&(e=e.message);var r=Object.assign({when:n},a);Raven.captureException(e,{extra:r})}function installUnhandledPromiseErrorHandler(){window.addEventListener("unhandledrejection",function(e){e.reason&&report(e.reason,"Unhandled Promise rejection")})}var Raven=require("raven-js"),angularPlugin=require("raven-js/plugins/angular");module.exports={init:init,angularModule:angularModule,setUserInfo:setUserInfo,report:report};

},{"raven-js":"raven-js","raven-js/plugins/angular":15}],109:[function(require,module,exports){
"use strict";function excludeAnnotations(n,t){var a={},i={};return t.forEach(function(n){n.id&&(a[n.id]=!0),n.$tag&&(i[n.$tag]=!0)}),n.filter(function(n){var t=n.id&&n.id in a||n.$tag&&n.$tag in i;return!t})}function findByID(n,t){return n.find(function(n){return n.id===t})}function findByTag(n,t){return n.find(function(n){return n.$tag===t})}function initializeAnnot(n,t){var a=n.$orphan;return n.id||(a=!1),Object.assign({},n,{$anchorTimeout:!1,$tag:n.$tag||t,$orphan:a})}function init(){return{annotations:[],nextTag:1}}function addAnnotations(n,t){return t=t||new Date,n=n.map(function(n){return n.id?n:Object.assign({created:t.toISOString(),updated:t.toISOString()},n)}),function(t,a){var i=n.filter(function(n){return!findByID(a().annotations,n.id)});if(t({type:actions.ADD_ANNOTATIONS,annotations:n}),a().isSidebar){var o=500,r=i.filter(metadata.isWaitingToAnchor);r.length&&setTimeout(function(){arrayUtil.filterMap(r,function(n){return findByID(a().annotations,n.id)}).filter(metadata.isWaitingToAnchor).forEach(function(n){t({type:actions.UPDATE_ANCHOR_STATUS,anchorTimeout:!0,id:n.id,tag:n.$tag})})},o)}}}function removeAnnotations(n){return{type:actions.REMOVE_ANNOTATIONS,annotations:n}}function clearAnnotations(){return{type:actions.CLEAR_ANNOTATIONS}}function updateAnchorStatus(n,t,a){return{type:actions.UPDATE_ANCHOR_STATUS,id:n,tag:t,isOrphan:a}}function savedAnnotations(n){return n.annotations.filter(function(n){return!metadata.isNew(n)})}function annotationExists(n,t){return n.annotations.some(function(n){return n.id===t})}function findIDsForTags(n,t){var a=[];return t.forEach(function(t){var i=findByTag(n.annotations,t);i&&i.id&&a.push(i.id)}),a}var arrayUtil=require("../util/array-util"),metadata=require("../annotation-metadata"),uiConstants=require("../ui-constants"),selection=require("./selection"),util=require("./util"),update={ADD_ANNOTATIONS:function(n,t){var a={},i={},o=[],r=[],e=[],s=n.nextTag;return t.annotations.forEach(function(t){var r;t.id&&(r=findByID(n.annotations,t.id)),!r&&t.$tag&&(r=findByTag(n.annotations,t.$tag)),r?(e.push(Object.assign({},r,t)),t.id&&(a[t.id]=!0),r.$tag&&(i[r.$tag]=!0)):(o.push(initializeAnnot(t,"t"+s)),++s)}),n.annotations.forEach(function(n){a[n.id]||i[n.$tag]||r.push(n)}),{annotations:o.concat(e).concat(r),nextTag:s}},REMOVE_ANNOTATIONS:function(n,t){var a=excludeAnnotations(n.annotations,t.annotations),i=n.selectedTab;i===uiConstants.TAB_ORPHANS&&0===arrayUtil.countIf(a,metadata.isOrphan)&&(i=uiConstants.TAB_ANNOTATIONS);var o=selection.update.SELECT_TAB;return Object.assign({annotations:a},o(n,selection.actions.selectTab(i)))},CLEAR_ANNOTATIONS:function(){return{annotations:[]}},UPDATE_ANCHOR_STATUS:function(n,t){var a=n.annotations.map(function(n){var a=n.id&&n.id===t.id||n.$tag&&n.$tag===t.tag;return a?Object.assign({},n,{$anchorTimeout:t.anchorTimeout||n.$anchorTimeout,$orphan:t.isOrphan,$tag:t.tag}):n});return{annotations:a}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{addAnnotations:addAnnotations,clearAnnotations:clearAnnotations,removeAnnotations:removeAnnotations,updateAnchorStatus:updateAnchorStatus},annotationExists:annotationExists,findIDsForTags:findIDsForTags,savedAnnotations:savedAnnotations};

},{"../annotation-metadata":45,"../ui-constants":159,"../util/array-util":161,"./selection":114,"./util":116}],110:[function(require,module,exports){
"use strict";function debugMiddleware(e){var o=0;return function(t){return function(n){if(!window.debug)return void t(n);++o;var r=n.type+" ("+o.toString()+")";console.group(r),console.log("Prev State:",e.getState()),console.log("Action:",n),t(n),console.log("Next State:",e.getState()),console.groupEnd(r)}}}module.exports=debugMiddleware;

},{}],111:[function(require,module,exports){
"use strict";function init(){return{frames:[]}}function connectFrame(t){return{type:actions.CONNECT_FRAME,frame:t}}function updateFrameAnnotationFetchStatus(t,e){return{type:actions.UPDATE_FRAME_ANNOTATION_FETCH_STATUS,isAnnotationFetchComplete:e,uri:t}}function frames(t){return t.frames}var util=require("./util"),update={CONNECT_FRAME:function(t,e){return{frames:t.frames.concat(e.frame)}},UPDATE_FRAME_ANNOTATION_FETCH_STATUS:function(t,e){var n=t.frames.map(function(t){var n=t.uri&&t.uri===e.uri;return n?Object.assign({},t,{isAnnotationFetchComplete:e.isAnnotationFetchComplete}):t});return{frames:n}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{connectFrame:connectFrame,updateFrameAnnotationFetchStatus:updateFrameAnnotationFetchStatus},frames:frames};

},{"./util":116}],112:[function(require,module,exports){
"use strict";function init(e){return Object.assign({},annotations.init(),frames.init(),moderation.init(),selection.init(e),session.init(),viewer.init())}var annotations=require("./annotations"),frames=require("./frames"),moderation=require("./moderation"),selection=require("./selection"),session=require("./session"),viewer=require("./viewer"),util=require("./util"),update=util.createReducer(Object.assign(annotations.update,frames.update,moderation.update,selection.update,session.update,viewer.update));module.exports={init:init,update:update};

},{"./annotations":109,"./frames":111,"./moderation":113,"./selection":114,"./session":115,"./util":116,"./viewer":117}],113:[function(require,module,exports){
"use strict";function init(){return{flagCounts:{},hiddenByModerator:{}}}function toggle(t,n,e){var d=Object.assign({},t);return e?d[n]=!0:delete d[n],d}function fetchedFlagCounts(t){return{type:actions.FETCHED_FLAG_COUNTS,flagCounts:t}}function fetchedHiddenByModeratorIds(t){return{type:actions.FETCHED_HIDDEN_IDS,ids:t}}function annotationHiddenChanged(t,n){return{type:actions.ANNOTATION_HIDDEN_CHANGED,id:t,hidden:n}}function flagCount(t,n){return t.flagCounts[n]||0}function isHiddenByModerator(t,n){return!!t.hiddenByModerator[n]}var toSet=require("../util/array-util").toSet,util=require("./util"),update={ANNOTATION_HIDDEN_CHANGED:function(t,n){return{hiddenByModerator:toggle(t.hiddenByModerator,n.id,n.hidden)}},FETCHED_FLAG_COUNTS:function(t,n){return{flagCounts:n.flagCounts}},FETCHED_HIDDEN_IDS:function(t,n){return{hiddenByModerator:toSet(n.ids)}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{annotationHiddenChanged:annotationHiddenChanged,fetchedFlagCounts:fetchedFlagCounts,fetchedHiddenByModeratorIds:fetchedHiddenByModeratorIds},isHiddenByModerator:isHiddenByModerator,flagCount:flagCount};

},{"../util/array-util":161,"./util":116}],114:[function(require,module,exports){
"use strict";function initialSelection(t){var e={};return t.annotations&&!t.query&&(e[t.annotations]=!0),freeze(e)}function freeze(t){return Object.keys(t).length?immutable(t):null}function init(t){return{focusedAnnotationMap:null,selectedAnnotationMap:initialSelection(t),expanded:initialSelection(t)||{},forceVisible:{},highlighted:[],filterQuery:t.query||null,selectedTab:TAB_DEFAULT,sortKey:TAB_SORTKEY_DEFAULT[TAB_DEFAULT],sortKeysAvailable:TAB_SORTKEYS_AVAILABLE[TAB_DEFAULT]}}function select(t){return{type:actions.SELECT_ANNOTATIONS,selection:freeze(t)}}function selectAnnotations(t){return select(toSet(t))}function toggleSelectedAnnotations(t){return function(e,n){for(var o=Object.assign({},n().selectedAnnotationMap),i=0;i<t.length;i++){var s=t[i];o[s]?delete o[s]:o[s]=!0}e(select(o))}}function setForceVisible(t,e){return function(n,o){var i=Object.assign({},o().forceVisible);i[t]=e,n({type:actions.SET_FORCE_VISIBLE,forceVisible:i})}}function focusAnnotations(t){return{type:actions.FOCUS_ANNOTATIONS,focused:freeze(toSet(t))}}function setCollapsed(t,e){return function(n,o){var i=Object.assign({},o().expanded);i[t]=!e,n({type:actions.SET_EXPANDED,expanded:i})}}function highlightAnnotations(t){return{type:actions.HIGHLIGHT_ANNOTATIONS,highlighted:t}}function selectTab(t){return{type:actions.SELECT_TAB,tab:t}}function setFilterQuery(t){return{type:actions.SET_FILTER_QUERY,query:t}}function setSortKey(t){return{type:actions.SET_SORT_KEY,key:t}}function isAnnotationSelected(t,e){return(t.selectedAnnotationMap||{}).hasOwnProperty(e)}function hasSelectedAnnotations(t){return!!t.selectedAnnotationMap}function removeSelectedAnnotation(t){return function(e,n){var o=Object.assign({},n().selectedAnnotationMap);o&&t&&(delete o[t],e(select(o)))}}function clearSelectedAnnotations(){return{type:actions.CLEAR_SELECTION}}var immutable=require("seamless-immutable"),toSet=require("../util/array-util").toSet,uiConstants=require("../ui-constants"),util=require("./util"),TAB_DEFAULT=uiConstants.TAB_ANNOTATIONS,TAB_SORTKEY_DEFAULT={};TAB_SORTKEY_DEFAULT[uiConstants.TAB_ANNOTATIONS]="Location",TAB_SORTKEY_DEFAULT[uiConstants.TAB_NOTES]="Oldest",TAB_SORTKEY_DEFAULT[uiConstants.TAB_ORPHANS]="Location";var TAB_SORTKEYS_AVAILABLE={};TAB_SORTKEYS_AVAILABLE[uiConstants.TAB_ANNOTATIONS]=["Newest","Oldest","Location"],TAB_SORTKEYS_AVAILABLE[uiConstants.TAB_NOTES]=["Newest","Oldest"],TAB_SORTKEYS_AVAILABLE[uiConstants.TAB_ORPHANS]=["Newest","Oldest","Location"];var update={CLEAR_SELECTION:function(){return{filterQuery:null,selectedAnnotationMap:null}},SELECT_ANNOTATIONS:function(t,e){return{selectedAnnotationMap:e.selection}},FOCUS_ANNOTATIONS:function(t,e){return{focusedAnnotationMap:e.focused}},SET_FORCE_VISIBLE:function(t,e){return{forceVisible:e.forceVisible}},SET_EXPANDED:function(t,e){return{expanded:e.expanded}},HIGHLIGHT_ANNOTATIONS:function(t,e){return{highlighted:e.highlighted}},SELECT_TAB:function(t,e){return-1===[uiConstants.TAB_ANNOTATIONS,uiConstants.TAB_NOTES,uiConstants.TAB_ORPHANS].indexOf(e.tab)?{}:t.selectedTab===e.tab?{}:{selectedTab:e.tab,sortKey:TAB_SORTKEY_DEFAULT[e.tab],sortKeysAvailable:TAB_SORTKEYS_AVAILABLE[e.tab]}},SET_FILTER_QUERY:function(t,e){return{filterQuery:e.query,forceVisible:{},expanded:{}}},SET_SORT_KEY:function(t,e){return{sortKey:e.key}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{clearSelectedAnnotations:clearSelectedAnnotations,focusAnnotations:focusAnnotations,highlightAnnotations:highlightAnnotations,removeSelectedAnnotation:removeSelectedAnnotation,selectAnnotations:selectAnnotations,selectTab:selectTab,setCollapsed:setCollapsed,setFilterQuery:setFilterQuery,setForceVisible:setForceVisible,setSortKey:setSortKey,toggleSelectedAnnotations:toggleSelectedAnnotations},hasSelectedAnnotations:hasSelectedAnnotations,isAnnotationSelected:isAnnotationSelected};

},{"../ui-constants":159,"../util/array-util":161,"./util":116,"seamless-immutable":32}],115:[function(require,module,exports){
"use strict";function init(){return{session:{csrf:null,features:{},groups:[],userid:null}}}function updateSession(e){return{type:actions.UPDATE_SESSION,session:e}}function isFeatureEnabled(e,s){return!!e.session.features[s]}var util=require("./util"),update={UPDATE_SESSION:function(e,s){return{session:s.session}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{updateSession:updateSession},isFeatureEnabled:isFeatureEnabled};

},{"./util":116}],116:[function(require,module,exports){
"use strict";function actionTypes(e){return Object.keys(e).reduce(function(e,t){return e[t]=t,e},{})}function createReducer(e){return function(t,n){var r=e[n.type];return r?Object.assign({},t,r(t,n)):t}}function bindSelectors(e,t){return Object.keys(e).reduce(function(n,r){var c=e[r];return n[r]=function(){var e=[].slice.apply(arguments);return e.unshift(t()),c.apply(null,e)},n},{})}module.exports={actionTypes:actionTypes,bindSelectors:bindSelectors,createReducer:createReducer};

},{}],117:[function(require,module,exports){
"use strict";function init(){return{isSidebar:!0,visibleHighlights:!1}}function setAppIsSidebar(i){return{type:actions.SET_SIDEBAR,isSidebar:i}}function setShowHighlights(i){return{type:actions.SET_HIGHLIGHTS_VISIBLE,visible:i}}function isSidebar(i){return i.isSidebar}var util=require("./util"),update={SET_SIDEBAR:function(i,t){return{isSidebar:t.isSidebar}},SET_HIGHLIGHTS_VISIBLE:function(i,t){return{visibleHighlights:t.visible}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{setAppIsSidebar:setAppIsSidebar,setShowHighlights:setShowHighlights},isSidebar:isSidebar};

},{"./util":116}],118:[function(require,module,exports){
"use strict";function targetBlank(){function e(e){return e.replace(/<a href=/g,'<a target="_blank" href=')}return[{type:"output",filter:e}]}function renderMarkdown(e){return converter||(converter=new showdown.Converter({extensions:[targetBlank],simplifiedAutoLink:!0,literalMidWordUnderscores:!0})),converter.makeHtml(e)}function mathPlaceholder(e){return"{math:"+e.toString()+"}"}function extractMath(e){for(var r=[],n=0,t=e;;){var a=t.indexOf("$$",n),o=t.indexOf("\\(",n);if(-1===a&&-1===o)break;var i,c;if(-1!==a&&(-1===o||o>a)?(i=a,c=t.indexOf("$$",i+2)):(i=o,c=t.indexOf("\\)",i+2)),-1===c)break;c+=2;var d=r.length+1,s=mathPlaceholder(d);r.push({id:d,expression:t.slice(i+2,c-2),inline:-1!==o});var l;l=-1!==o?s:"\n\n"+s+"\n\n",t=t.slice(0,i)+l+t.slice(c),n=i+l.length}return{mathBlocks:r,content:t}}function insertMath(e,r){return r.reduce(function(e,r){var n;try{n=r.inline?katex.renderToString(r.expression):katex.renderToString(r.expression,{displayMode:!0})}catch(t){n=escapeHtml(r.expression)}return e.replace(mathPlaceholder(r.id),n)},e)}function renderMathAndMarkdown(e,r){var n=extractMath(e),t=r(renderMarkdown(n.content)),a=insertMath(t,n.mathBlocks);return a}var escapeHtml=require("escape-html"),katex=require("katex"),showdown=require("showdown"),converter;module.exports=renderMathAndMarkdown;

},{"escape-html":3,"katex":"katex","showdown":"showdown"}],119:[function(require,module,exports){
"use strict";function retryPromiseOperation(r,t){return new Promise(function(e,n){var o=retry.operation(t);o.attempt(function(){r().then(function(r){o.retry(),e(r)})["catch"](function(r){o.retry(r)||n(r)})})})}var retry=require("retry");module.exports={retryPromiseOperation:retryPromiseOperation};

},{"retry":28}],120:[function(require,module,exports){
"use strict";function truthyKeys(t){return Object.keys(t).filter(function(e){return!!t[e]})}function RootThread(t,e,n,a,o){function r(t){var e,n=sortFns[t.sortKey];if(t.filterQuery){var r=a.generateFacetedFilter(t.filterQuery);e=function(t){return o.filter([t],r).length>0}}var i;return t.isSidebar&&!t.filterQuery&&(i=function(e){if(!e.annotation)return!1;var n=tabs.shouldSeparateOrphans(t);return tabs.shouldShowInTab(e.annotation,t.selectedTab,n)}),buildThread(t.annotations,{forceVisible:truthyKeys(t.forceVisible),expanded:t.expanded,highlighted:t.highlighted,selected:truthyKeys(t.selectedAnnotationMap||{}),sortCompareFn:n,filterFn:e,threadFilterFn:i})}function i(){e.getState().annotations.filter(function(t){return metadata.isNew(t)&&!n.getIfNotEmpty(t)}).forEach(function(e){n.remove(e),t.$broadcast(events.ANNOTATION_DELETED,e)})}var s=[events.ANNOTATION_CREATED,events.ANNOTATION_UPDATED,events.ANNOTATIONS_LOADED];s.forEach(function(n){t.$on(n,function(t,n){e.addAnnotations([].concat(n))})}),t.$on(events.BEFORE_ANNOTATION_CREATED,function(t,n){i(),e.addAnnotations([n]),metadata.isPageNote(n)?e.selectTab(uiConstants.TAB_NOTES):metadata.isAnnotation(n)&&e.selectTab(uiConstants.TAB_ANNOTATIONS),(n.references||[]).forEach(function(t){e.setCollapsed(t,!1)})}),t.$on(events.ANNOTATION_DELETED,function(t,n){e.removeAnnotations([n]),n.id&&e.removeSelectedAnnotation(n.id)}),t.$on(events.ANNOTATIONS_UNLOADED,function(t,n){e.removeAnnotations(n)}),t.$on(events.GROUP_FOCUSED,function(t,n){var a=e.getState().annotations.filter(function(t){return metadata.isNew(t)&&!metadata.isReply(t)}).map(function(t){return Object.assign(t,{group:n})});a.length>0&&e.addAnnotations(a)}),this.thread=memoize(r)}RootThread.$inject=["$rootScope","annotationUI","drafts","searchFilter","viewFilter"];var buildThread=require("./build-thread"),events=require("./events"),memoize=require("./util/memoize"),metadata=require("./annotation-metadata"),tabs=require("./tabs"),uiConstants=require("./ui-constants"),sortFns={Newest:function(t,e){return t.updated>e.updated},Oldest:function(t,e){return t.updated<e.updated},Location:function(t,e){return metadata.location(t)<metadata.location(e)}};module.exports=RootThread;

},{"./annotation-metadata":45,"./build-thread":49,"./events":90,"./tabs":129,"./ui-constants":159,"./util/memoize":163}],121:[function(require,module,exports){
"use strict";function SearchClient(e,t){t=t||{};var n=200;this._searchFn=e,this._chunkSize=t.chunkSize||n,"undefined"!=typeof t.incremental?this._incremental=t.incremental:this._incremental=!0,this._canceled=!1}var EventEmitter=require("tiny-emitter"),inherits=require("inherits");inherits(SearchClient,EventEmitter),SearchClient.prototype._getBatch=function(e,t){var n=Object.assign({limit:this._chunkSize,offset:t,sort:"created",order:"asc",_separate_replies:!0},e),i=this;this._searchFn(n).then(function(n){if(!i._canceled){var r=n.rows.concat(n.replies||[]);i._incremental?i.emit("results",r):i._results=i._results.concat(r);var c=t+n.rows.length;n.total>c&&r.length>0?i._getBatch(e,c):(i._incremental||i.emit("results",i._results),i.emit("end"))}})["catch"](function(e){i._canceled||i.emit("error",e)}).then(function(){i._canceled||i.emit("end")})},SearchClient.prototype.get=function(e){this._results=[],this._getBatch(e,0)},SearchClient.prototype.cancel=function(){this._canceled=!0,this.emit("end")},module.exports=SearchClient;

},{"inherits":5,"tiny-emitter":36}],122:[function(require,module,exports){
var SearchFilter;module.exports=SearchFilter=function(){function e(){}return e.prototype._splitTerm=function(e){var t,r;return r=e.slice(0,e.indexOf(":")),null==r?[null,e]:"group"===r||"quote"===r||"result"===r||"since"===r||"tag"===r||"text"===r||"uri"===r||"user"===r?(t=e.slice(r.length+1),[r,t]):[null,e]},e.prototype._tokenize=function(e){var t,r,s,a,n,u,c,o,i;if(!e)return[];for(t=function(e){var t,r;return r=e.slice(0,1),t=e.slice(-1),'"'!==r&&"'"!==r||r!==t||(e=e.slice(1,e.length-1)),e},i=e.match(/(?:[^\s"']+|"[^"]*"|'[^']*')+/g),i=i.map(t),n=a=0,u=i.length;u>a;n=++a)o=i[n],c=this._splitTerm(o),s=c[0],r=c[1],null!=s&&(i[n]=s+":"+t(r));return i},e.prototype.toObject=function(e){var t,r,s,a,n,u,c,o,i,l;if(c={},a=function(e){return"tag"===e?"tags":e},t=function(e,t){return null!=c[e]?c[e].push(t):c[e]=[t]},e)for(l=this._tokenize(e),n=0,u=l.length;u>n;n++)i=l[n],o=this._splitTerm(i),s=o[0],r=o[1],null==s&&(s="any",r=i),t(a(s),r);return c},e.prototype.generateFacetedFilter=function(e){var t,r,s,a,n,u,c,o,i,l,h,p,d,m,f;if(t=[],n=[],u=[],c=[],i=[],p=[],m=[],f=[],e)for(h=this._tokenize(e),s=0,a=h.length;a>s;s++)switch(l=h[s],r=l.slice(0,l.indexOf(":")),null==r&&(r=""),r){case"quote":n.push(l.slice(6));break;case"result":u.push(l.slice(7));break;case"since":d=l.slice(6).toLowerCase(),d.match(/^\d+$/)&&c.push(d),d.match(/^\d+sec$/)&&(o=/^(\d+)sec$/.exec(d)[1],c.push(o)),d.match(/^\d+min$/)&&(o=/^(\d+)min$/.exec(d)[1],c.push(60*o)),d.match(/^\d+hour$/)&&(o=/^(\d+)hour$/.exec(d)[1],c.push(60*o*60)),d.match(/^\d+day$/)&&(o=/^(\d+)day$/.exec(d)[1],c.push(60*o*60*24)),d.match(/^\d+week$/)&&(o=/^(\d+)week$/.exec(d)[1],c.push(60*o*60*24*7)),d.match(/^\d+month$/)&&(o=/^(\d+)month$/.exec(d)[1],c.push(60*o*60*24*30)),d.match(/^\d+year$/)&&(o=/^(\d+)year$/.exec(d)[1],c.push(60*o*60*24*365));break;case"tag":i.push(l.slice(4));break;case"text":p.push(l.slice(5));break;case"uri":m.push(l.slice(4));break;case"user":f.push(l.slice(5));break;default:t.push(l)}return{any:{terms:t,operator:"and"},quote:{terms:n,operator:"and"},result:{terms:u,operator:"min"},since:{terms:c,operator:"and"},tag:{terms:i,operator:"and"},text:{terms:p,operator:"and"},uri:{terms:m,operator:"or"},user:{terms:f,operator:"or"}}},e}();

},{}],123:[function(require,module,exports){
"use strict";function serviceConfig(e){return Array.isArray(e.services)&&0!==e.services.length?e.services[0]:null}module.exports=serviceConfig;

},{}],124:[function(require,module,exports){
"use strict";function serviceUrl(r){return function(e,s){s=s||{};var t=ROUTES[e];if(!t)throw new Error("Unknown route "+e);var n=urlUtil.replaceURLParams(t,s),o=Object.keys(n.params);if(o.length>0)throw new Error("Unknown route parameters: "+o.join(", "));return r.serviceUrl+n.url}}serviceUrl.$inject=["settings"];var urlUtil=require("./util/url-util"),ROUTES={"account.settings":"account/settings","forgot-password":"forgot-password","groups.leave":"groups/:id/leave","groups.new":"groups/new",help:"docs/help",signup:"signup","search.tag":'search?q=tag:":tag"',user:"u/:user"};module.exports=serviceUrl;

},{"./util/url-util":165}],125:[function(require,module,exports){
"use strict";function sessionActions(e){var r={login:{method:"POST",params:{__formid__:"login"}},logout:{method:"POST",params:{__formid__:"logout"}},_load:{method:"GET"}};return Object.keys(r).forEach(function(t){Object.assign(r[t],e)}),r}function session(e,r,t,n,o,s,a,i,u,c,l){function f(){return Array.isArray(c.services)&&c.services.length>0?c.services[0].authority:null}function d(){return l.profile.update({},{preferences:{show_sidebar_tutorial:!1}}).then(h)}function h(r){var t=s.getState().session,o=!t.csrf,i=r.userid!==t.userid,c=!angular.equals(r.groups,t.groups);return s.updateSession(r),r.csrf&&(m[e.defaults.xsrfHeaderName]=r.csrf),v=Promise.resolve(r),_=Date.now(),i&&(f()||a.clearCache(),n.$broadcast(events.USER_CHANGED,{initialLoad:o,userid:r.userid}),r.userid?u.setUserInfo({id:r.userid}):u.setUserInfo(void 0)),c&&n.$broadcast(events.GROUPS_CHANGED,{initialLoad:o}),r}function p(e,r,t){if(200>t||t>=500)return null;e=angular.fromJson(e);var n=e.model||{};"undefined"!=typeof e.errors&&(n.errors=e.errors),"undefined"!=typeof e.reason&&(n.reason=e.reason);for(var o in e.flash)if(e.flash.hasOwnProperty(o))for(var s=e.flash[o],a=0,u=s.length;u>a;a++)i[o](s[a]);return h(n)}function g(){return O.logout().$promise.then(function(){a.clearCache()})["catch"](function(e){return i.error("Log out failed"),o.track(o.events.LOGOUT_FAILURE),r.reject(new Error(e))}).then(function(){o.track(o.events.LOGOUT_SUCCESS)})}var v,_,m={},y=sessionActions({headers:m,transformResponse:p,withCredentials:!0}),U=new URL("app/:path",c.serviceUrl).href,O=t(U,{},y);return O.load=function(){return(!_||Date.now()-_>CACHE_TTL)&&(_=Date.now(),v=retryUtil.retryPromiseOperation(function(){var e=f();return e?l.profile.read({authority:e}).then(h):O._load().$promise}).then(function(e){return _=Date.now(),e})["catch"](function(e){throw _=null,e})),v},{dismissSidebarTutorial:d,load:O.load,login:O.login,logout:g,get state(){return s.getState().session},update:h}}session.$inject=["$http","$q","$resource","$rootScope","analytics","annotationUI","auth","flash","raven","settings","store"];var angular=require("angular"),events=require("./events"),retryUtil=require("./retry-util"),CACHE_TTL=3e5;module.exports=session;

},{"./events":90,"./retry-util":119,"angular":"angular"}],126:[function(require,module,exports){
"use strict";function stripInternalProperties(e){var r={};for(var t in e)e.hasOwnProperty(t)&&"$"!==t[0]&&(r[t]=e[t]);return r}function forEachSorted(e,r,t){for(var n=Object.keys(e).sort(),a=0;a<n.length;a++)r.call(t,e[n[a]],n[a]);return n}function serializeValue(e){return"object"==typeof e?e instanceof Date?e.toISOString():JSON.stringify(e):e}function encodeUriQuery(e){return encodeURIComponent(e).replace(/%20/g,"+")}function serializeParams(e){if(!e)return"";var r=[];return forEachSorted(e,function(e,t){null!==e&&"undefined"!=typeof e&&(Array.isArray(e)?e.forEach(function(e){r.push(encodeUriQuery(t)+"="+encodeUriQuery(serializeValue(e)))}):r.push(encodeUriQuery(t)+"="+encodeUriQuery(serializeValue(e))))}),r.join("&")}function createAPICall(e,r,t,n,a){return function(i,o){return r.all([t,a()]).then(function(r){var t=r[0],a=r[1],u=get(t,n),l=urlUtil.replaceURLParams(u.url,i),c={};a&&(c.Authorization="Bearer "+a);var s={data:o?stripInternalProperties(o):null,headers:c,method:u.method,params:l.params,paramSerializer:serializeParams,url:l.url};return e(s)}).then(function(e){return e.data})}}function store(e,r,t,n){function a(n){return createAPICall(e,r,i,n,t.tokenGetter)}var i=retryUtil.retryPromiseOperation(function(){return e.get(n.apiUrl)}).then(function(e){return e.data.links});return{search:a("search"),annotation:{create:a("annotation.create"),"delete":a("annotation.delete"),get:a("annotation.read"),update:a("annotation.update"),flag:a("annotation.flag")},profile:{read:a("profile.read"),update:a("profile.update")}}}store.$inject=["$http","$q","auth","settings"];var get=require("lodash.get"),retryUtil=require("./retry-util"),urlUtil=require("./util/url-util");module.exports=store;

},{"./retry-util":119,"./util/url-util":165,"lodash.get":9}],127:[function(require,module,exports){
var StreamFilter;module.exports=StreamFilter=function(){function t(){}return t.prototype.strategies=["include_any","include_all","exclude_any","exclude_all"],t.prototype.filter={match_policy:"include_any",clauses:[],actions:{create:!0,update:!0,"delete":!0}},t.prototype.getFilter=function(){return this.filter},t.prototype.getMatchPolicy=function(){return this.filter.match_policy},t.prototype.getClauses=function(){return this.filter.clauses},t.prototype.getActions=function(){return this.filter.actions},t.prototype.getActionCreate=function(){return this.filter.actions.create},t.prototype.getActionUpdate=function(){return this.filter.actions.update},t.prototype.getActionDelete=function(){return this.filter.actions["delete"]},t.prototype.setMatchPolicy=function(t){return this.filter.match_policy=t,this},t.prototype.setMatchPolicyIncludeAny=function(){return this.filter.match_policy="include_any",this},t.prototype.setMatchPolicyIncludeAll=function(){return this.filter.match_policy="include_all",this},t.prototype.setMatchPolicyExcludeAny=function(){return this.filter.match_policy="exclude_any",this},t.prototype.setMatchPolicyExcludeAll=function(){return this.filter.match_policy="exclude_all",this},t.prototype.setActions=function(t){return this.filter.actions=t,this},t.prototype.setActionCreate=function(t){return this.filter.actions.create=t,this},t.prototype.setActionUpdate=function(t){return this.filter.actions.update=t,this},t.prototype.setActionDelete=function(t){return this.filter.actions["delete"]=t,this},t.prototype.noClauses=function(){return this.filter.clauses=[],this},t.prototype.addClause=function(t,e,i,o,n){return null==o&&(o=!1),null==n&&(n={}),this.filter.clauses.push({field:t,operator:e,value:i,case_sensitive:o,options:n}),this},t.prototype.resetFilter=function(){return this.setMatchPolicyIncludeAny(),this.setActionCreate(!0),this.setActionUpdate(!0),this.setActionDelete(!0),this.noClauses(),this},t}();

},{}],128:[function(require,module,exports){
"use strict";function Streamer(e,n,t,o,i,r,s){function c(e){var n=e.options.action,o=e.payload;switch(n){case"create":case"update":case"past":o.forEach(function(e){e.group!==i.focused().id&&t.isSidebar()||(m[e.id]=e)});break;case"delete":o.forEach(function(e){delete m[e.id],t.annotationExists(e.id)&&(E[e.id]=!0)})}t.isSidebar()||g()}function a(e){r.update(e.model)}function u(e){console.warn("Error connecting to H push notification service:",e);var n=new URL(s.websocketUrl).hostname;-1!==["localhost","127.0.0.1"].indexOf(n)&&console.warn("Check that your H service is configured to allow WebSocket connections from "+window.location.origin)}function d(n){e.$apply(function(){var e=JSON.parse(n.data);if(e)if("annotation-notification"===e.type)c(e);else if("session-change"===e.type)a(e);else if("whoyouare"===e.type){var o=t.getState().session.userid;e.userid!==o&&console.warn('WebSocket user ID "%s" does not match logged-in ID "%s"',e.userid,o)}else console.warn("received unsupported notification",e.type)})}function f(){Object.keys(b).forEach(function(e){b[e]&&S.send(b[e])})}function l(e,n){b[e]=n,S&&S.isConnected()&&S.send(n)}function h(){return S?Promise.resolve():U()}function p(){return S&&S.close(),U()}function g(){var e=Object.values(m),t=Object.keys(E).map(function(e){return{id:e}});e.length&&n.loadAnnotations(e),t.length&&n.unloadAnnotations(t),m={},E={}}function v(){return Object.keys(m).length+Object.keys(E).length}function y(e){return E.hasOwnProperty(e)}function k(e,n){Array.isArray(n)||(n=[n]),n.forEach(function(e){delete m[e.id],delete E[e.id]})}function w(){m={},E={}}var S,O=uuid.v4(),b={},m={},E={},U=function(){return s.websocketUrl?o.tokenGetter().then(function(e){var n;if(e){var t=new URL(s.websocketUrl),o=queryString.parse(t.search);o.access_token=e,t.search=queryString.stringify(o),n=t.toString()}else n=s.websocketUrl;S=new Socket(n),S.on("open",f),S.on("error",u),S.on("message",d),l("client-id",{messageType:"client_id",value:O}),l("auth-check",{type:"whoami",id:1})})["catch"](function(e){console.error("Failed to fetch token for WebSocket authentication",e)}):Promise.resolve()},A=[events.ANNOTATION_DELETED,events.ANNOTATION_UPDATED,events.ANNOTATIONS_UNLOADED];A.forEach(function(n){e.$on(n,k)}),e.$on(events.GROUP_FOCUSED,w),this.applyPendingUpdates=g,this.countPendingUpdates=v,this.hasPendingDeletion=y,this.clientId=O,this.configMessages=b,this.connect=h,this.reconnect=p,this.setConfig=l}Streamer.$inject=["$rootScope","annotationMapper","annotationUI","auth","groups","session","settings"];var queryString=require("query-string"),uuid=require("node-uuid"),events=require("./events"),Socket=require("./websocket");module.exports=Streamer;

},{"./events":90,"./websocket":169,"node-uuid":10,"query-string":13}],129:[function(require,module,exports){
"use strict";function shouldSeparateOrphans(t){return session.isFeatureEnabled(t,"orphans_tab")}function tabForAnnotation(t,n){return metadata.isOrphan(t)&&n?uiConstants.TAB_ORPHANS:metadata.isPageNote(t)?uiConstants.TAB_NOTES:uiConstants.TAB_ANNOTATIONS}function shouldShowInTab(t,n,a){return metadata.isWaitingToAnchor(t)&&a?!1:tabForAnnotation(t,a)===n}function counts(t,n){var a={notes:countIf(t,metadata.isPageNote),annotations:countIf(t,metadata.isAnnotation),orphans:countIf(t,metadata.isOrphan),anchoring:countIf(t,metadata.isWaitingToAnchor)};return n?a:Object.assign({},a,{annotations:a.annotations+a.orphans,orphans:0})}var countIf=require("./util/array-util").countIf,metadata=require("./annotation-metadata"),session=require("./reducers/session"),uiConstants=require("./ui-constants");module.exports={counts:counts,shouldSeparateOrphans:shouldSeparateOrphans,shouldShowInTab:shouldShowInTab,tabForAnnotation:tabForAnnotation};

},{"./annotation-metadata":45,"./reducers/session":115,"./ui-constants":159,"./util/array-util":161}],130:[function(require,module,exports){
module.exports=["localStorage",function(t){var e,n;return e="hypothesis.user.tags.list",n="hypothesis.user.tags.map",{filter:function(n){var o,r;return r=t.getObject(e),null==r&&(r=[]),o=function(t){return t.toLowerCase().indexOf(n.toLowerCase())>-1},r.filter(o)},store:function(o){var r,u,c,s,a,l;for(s=t.getObject(n),null==s&&(s={}),u=0,c=o.length;c>u;u++)a=o[u],null!=s[a.text]?(s[a.text].count+=1,s[a.text].updated=Date.now()):s[a.text]={text:a.text,count:1,updated:Date.now()};t.setObject(n,s),l=[];for(a in s)l[l.length]=a;return r=function(t,e){return s[t].count!==s[e].count?s[e].count-s[t].count:e>t?-1:t>e?1:0},l=l.sort(r),t.setObject(e,l)}}}];

},{}],131:[function(require,module,exports){
module.exports='<header class="annotation-header" ng-if="!vm.user()">\n  <strong>You must be logged in to create annotations.</strong>\n</header>\n\n<div ng-keydown="vm.onKeydown($event)" ng-if="vm.user()">\n  <header class="annotation-header">\n    <!-- User -->\n    <span ng-if="vm.user()">\n      <a class="annotation-header__user"\n        target="_blank"\n        ng-if="!vm.isThirdPartyUser()"\n        ng-href="{{vm.serviceUrl(\'user\',{user:vm.user()})}}"\n        >{{vm.username()}}</a>\n      <span class="annotation-header__user"\n        ng-if="vm.isThirdPartyUser()"\n        >{{vm.username()}}</span>\n      <span class="annotation-collapsed-replies">\n        <a class="annotation-link" href=""\n          ng-click="vm.onReplyCountClick()"\n          ng-pluralize count="vm.replyCount"\n          when="{\'0\': \'\', \'one\': \'1 reply\', \'other\': \'{} replies\'}"></a>\n      </span>\n      <br>\n      <span class="annotation-header__share-info">\n        <a class="annotation-header__group"\n          target="_blank" ng-if="vm.group() && vm.group().url" href="{{vm.group().url}}">\n          <i class="h-icon-group"></i><span class="annotation-header__group-name">{{vm.group().name}}</span>\n        </a>\n        <span ng-show="vm.state().isPrivate"\n          title="This annotation is visible only to you.">\n          <i class="h-icon-lock"></i><span class="annotation-header__group-name" ng-show="!vm.group().url">Only me</span>\n        </span>\n        <i class="h-icon-border-color" ng-show="vm.isHighlight() && !vm.editing()" title="This is a highlight. Click \'edit\' to add a note or tag."></i>\n        <span ng-if="::vm.showDocumentInfo">\n          <span class="annotation-citation" ng-if="vm.documentMeta().titleLink">\n            on "<a ng-href="{{vm.documentMeta().titleLink}}">{{vm.documentMeta().titleText}}</a>"\n          </span>\n          <span class="annotation-citation" ng-if="!vm.documentMeta().titleLink">\n            on "{{vm.documentMeta().titleText}}"\n          </span>\n          <span class="annotation-citation-domain"\n                ng-if="vm.documentMeta().domain">({{vm.documentMeta().domain}})</span>\n        </span>\n      </span>\n    </span>\n\n    <span class="u-flex-spacer"></span>\n\n    <timestamp\n      class-name="\'annotation-header__timestamp\'"\n      timestamp="vm.updated()"\n      href="vm.links().html"\n      ng-if="!vm.editing() && vm.updated()"></timestamp>\n  </header>\n\n  <!-- Excerpts -->\n  <section class="annotation-quote-list"\n    ng-class="{\'is-orphan\' : vm.isOrphan()}"\n    ng-repeat="target in vm.target() track by $index"\n    ng-if="vm.hasQuotes()">\n    <excerpt collapsed-height="35"\n      inline-controls="true"\n      overflow-hysteresis="20"\n      content-data="selector.exact">\n      <blockquote class="annotation-quote"\n        h-branding="selectionFontFamily"\n        ng-bind="selector.exact"\n        ng-repeat="selector in target.selector\n          | filter : {\'type\': \'TextQuoteSelector\'}\n          track by $index"></blockquote>\n    </excerpt>\n  </section>\n\n  <!-- / Excerpts -->\n\n  <!-- Body -->\n  <section name="text" class="annotation-body">\n    <excerpt enabled="!vm.editing()"\n      inline-controls="false"\n      on-collapsible-changed="vm.setBodyCollapsible(collapsible)"\n      collapse="vm.collapseBody"\n      collapsed-height="400"\n      overflow-hysteresis="20"\n      content-data="vm.state().text">\n      <markdown text="vm.state().text"\n                custom-text-class="{\'annotation-body is-hidden\':vm.isHiddenByModerator()}"\n                on-edit-text="vm.setText(text)"\n                read-only="!vm.editing()">\n      </markdown>\n    </excerpt>\n  </section>\n  <!-- / Body -->\n\n  <!-- Tags -->\n  <div class="annotation-body form-field" ng-if="vm.editing()">\n    <tag-editor tags="vm.state().tags"\n                on-edit-tags="vm.setTags(tags)"></tag-editor>\n  </div>\n\n  <div class="annotation-body u-layout-row tags tags-read-only"\n       ng-if="(vm.canCollapseBody || vm.state().tags.length) && !vm.editing()">\n    <ul class="tag-list">\n      <li class="tag-item" ng-repeat="tag in vm.state().tags">\n        <a ng-href="{{vm.tagSearchURL(tag)}}" target="_blank">{{tag}}</a>\n      </li>\n    </ul>\n    <div class="u-stretch"></div>\n    <a class="annotation-link u-strong" ng-show="vm.canCollapseBody"\n      ng-click="vm.toggleCollapseBody($event)"\n      ng-title="vm.collapseBody ? \'Show the full annotation text\' : \'Show the first few lines only\'"\n      ng-bind="vm.collapseBody ? \'More\' : \'Less\'"\n      h-branding="highlightColor"></a>\n  </div>\n  <!-- / Tags -->\n\n  <footer class="annotation-footer">\n    <div class="annotation-form-actions" ng-if="vm.editing()">\n      <publish-annotation-btn\n        class="publish-annotation-btn"\n        group="vm.group()"\n        can-post="vm.hasContent()"\n        is-shared="vm.isShared()"\n        on-cancel="vm.revert()"\n        on-save="vm.save()"\n        on-set-privacy="vm.setPrivacy(level)"></publish-annotation-btn>\n    </div>\n\n    <div class="annotation-section annotation-license"\n      ng-show="vm.isShared() && vm.editing()">\n      <a class="annotation-license__link" href="http://creativecommons.org/publicdomain/zero/1.0/"\n        title="View more information about the Creative Commons Public Domain dedication"\n        target="_blank">\n        <i class="h-icon-cc-logo"></i><i class="h-icon-cc-zero"></i>\n        Annotations can be freely reused by anyone for any purpose.\n      </a>\n    </div>\n\n    <div class="annotation-replies" ng-if="!vm.isReply() && vm.replyCount > 0">\n      <a href=""\n        ng-click="vm.onReplyCountClick()">\n        <span class="annotation-replies__link">{{ vm.isCollapsed ? \'Show replies\' : \'Hide replies\' }}</span>\n        <span class="annotation-replies__count">({{ vm.replyCount }})</span>\n      </a>\n    </div>\n\n    <div class="annotation-actions" ng-if="vm.isSaving">\n      Saving...\n    </div>\n\n    <div class="annotation-actions" ng-if="!vm.isSaving && !vm.editing() && vm.id()">\n      <div ng-show="vm.isSaving">Saving…</div>\n      <button class="btn btn-clean annotation-action-btn"\n        ng-show="vm.authorize(\'update\') && !vm.isSaving"\n        ng-click="vm.edit()"\n        ng-disabled="vm.isDeleted()"\n        aria-label="Edit"\n        h-tooltip>\n        <i class="h-icon-annotation-edit btn-icon "></i>\n      </button>\n      <button class="btn btn-clean annotation-action-btn"\n        ng-show="vm.authorize(\'delete\')"\n        ng-click="vm.delete()"\n        ng-disabled="vm.isDeleted()"\n        aria-label="Delete"\n        h-tooltip>\n        <i class="h-icon-annotation-delete btn-icon "></i>\n      </button>\n      <button class="btn btn-clean annotation-action-btn"\n        ng-click="vm.reply()"\n        ng-disabled="vm.isDeleted()"\n        aria-label="Reply"\n        h-tooltip>\n        <i class="h-icon-annotation-reply btn-icon "></i>\n      </button>\n      <span class="annotation-share-dialog-wrapper">\n        <button class="btn btn-clean annotation-action-btn"\n          ng-click="vm.showShareDialog = true"\n          ng-disabled="vm.isDeleted()"\n          aria-label="Share"\n          h-tooltip>\n          <i class="h-icon-annotation-share btn-icon "></i>\n        </button>\n        <annotation-share-dialog\n          group="vm.group()"\n          uri="vm.links().incontext"\n          is-private="vm.state().isPrivate"\n          is-open="vm.showShareDialog"\n          on-close="vm.showShareDialog = false">\n        </annotation-share-dialog>\n      </span>\n      <span ng-if="vm.isThirdPartyUser()">\n        <button class="btn btn-clean annotation-action-btn"\n          ng-if="!vm.isFlagged"\n          ng-click="vm.flag()"\n          ng-disabled="vm.isDeleted()"\n          aria-label="Flag"\n          h-tooltip>\n          <i class="h-icon-annotation-flag btn-icon"></i>\n        </button>\n        <button class="btn btn-clean annotation-action-btn"\n          ng-if="vm.isFlagged"\n          ng-disabled="vm.isDeleted()"\n          aria-label="Annotation has been flagged"\n          h-tooltip>\n          <i class="h-icon-annotation-flag annotation--flagged btn-icon"></i>\n        </button>\n      </span>\n    </div>\n  </footer>\n</div>\n';

},{}],132:[function(require,module,exports){
module.exports='<div class="annotation-share-dialog" ng-class="{\'is-open\': vm.isOpen}">\n  <div class="annotation-share-dialog-target">\n    <span class="annotation-share-dialog-target__label">Share:</span>\n    <a href="https://twitter.com/intent/tweet?url={{vm.uri | urlEncode}}&hashtags=annotated"\n      target="_blank"\n      title="Tweet link"\n      class="annotation-share-dialog-target__icon h-icon-twitter"\n      ng-click="onShareClick(\'twitter\')"></a>\n    <a href="https://www.facebook.com/sharer/sharer.php?u={{vm.uri | urlEncode}}"\n      target="_blank"\n      title="Share on Facebook"\n      class="annotation-share-dialog-target__icon h-icon-facebook"\n      ng-click="onShareClick(\'facebook\')"></a>\n    <a href="https://plus.google.com/share?url={{vm.uri | urlEncode}}"\n      target="_blank"\n      title="Post on Google Plus"\n      class="annotation-share-dialog-target__icon h-icon-google-plus"\n      ng-click="onShareClick(\'googlePlus\')"></a>\n    <a href="mailto:?subject=Let\'s%20Annotate&amp;body={{vm.uri}}"\n      target="_blank"\n      title="Share via email"\n      class="annotation-share-dialog-target__icon h-icon-mail"\n      ng-click="onShareClick(\'email\')"></a>\n  </div>\n  <div class="annotation-share-dialog-link" type="text">\n    <input class="annotation-share-dialog-link__text"\n      value="{{vm.uri}}" readonly>\n    <span class="annotation-share-dialog-link__feedback" ng-if="vm.copyToClipboardMessage">\n      {{vm.copyToClipboardMessage}}\n    </span>\n    <button class="btn btn-clean annotation-share-dialog-link__btn"\n      ng-click="vm.copyToClipboard($event)">\n      <i class="h-icon-clipboard btn-icon"></i>\n    </button>\n  </div>\n  <div class="annotation-share-dialog-msg" ng-if="vm.group && !vm.group.public && !vm.isPrivate">\n    <span class="annotation-share-dialog-msg__audience">\n      Group.\n    </span>\n    Only group members will be able to view this annotation.\n  </div>\n  <div class="annotation-share-dialog-msg" ng-if="vm.isPrivate">\n    <span class="annotation-share-dialog-msg__audience">\n      Only me.\n    </span>\n    No one else will be able to view this annotation.\n  </div>\n</div>\n';

},{}],133:[function(require,module,exports){
module.exports='<div ng-class="vm.threadClasses()">\n  <div class="annotation-thread__thread-edge" ng-if="!vm.isTopLevelThread()">\n    <a href=""\n       ng-class="vm.threadToggleClasses()"\n       title="{{vm.thread.collapsed && \'Expand\' || \'Collapse\'}}"\n       ng-click="vm.toggleCollapsed()">\n       <span ng-class="{\'h-icon-arrow-right\': vm.thread.collapsed,\n                        \'h-icon-arrow-drop-down\': !vm.thread.collapsed}"></span>\n    </a>\n    <div class="annotation-thread__thread-line"></div>\n  </div>\n  <div class="annotation-thread__content">\n    <moderation-banner is-reply="!vm.isTopLevelThread()"\n                       annotation-id="vm.thread.id">\n    </moderation-banner>\n    <annotation ng-class="vm.annotationClasses()"\n             annotation="vm.thread.annotation"\n             is-collapsed="vm.thread.collapsed"\n             name="annotation"\n             ng-mouseenter="vm.annotationHovered = true"\n             ng-mouseleave="vm.annotationHovered = false"\n             ng-if="vm.thread.annotation"\n             ng-show="vm.thread.visible"\n             show-document-info="vm.showDocumentInfo"\n             on-reply-count-click="vm.toggleCollapsed()"\n             reply-count="vm.thread.replyCount">\n    </annotation>\n\n    <div ng-if="!vm.thread.annotation" class="thread-deleted">\n      <p><em>Message not available.</em></p>\n    </div>\n\n    <div ng-if="vm.hiddenCount() > 0">\n      <a class="small"\n         href=""\n         ng-click="vm.showThreadAndReplies()"\n         ng-pluralize\n         count="vm.hiddenCount()"\n         when="{\'0\': \'\',\n               one: \'View one more in conversation\',\n               other: \'View {} more in conversation\'}"\n         ></a>\n    </div>\n\n    <!-- Replies -->\n    <ul ng-show="!vm.thread.collapsed">\n      <li ng-repeat="child in vm.thread.children track by child.id"\n          ng-show="vm.shouldShowReply(child)">\n        <annotation-thread\n          show-document-info="false"\n          thread="child"\n          on-change-collapsed="vm.onChangeCollapsed({id:id, collapsed:collapsed})"\n          on-force-visible="vm.onForceVisible({thread:thread})">\n        </annotation-thread>\n      </li>\n    </ul>\n  </div>\n</div>\n';

},{}],134:[function(require,module,exports){
module.exports='<thread-list\n  on-change-collapsed="vm.setCollapsed(id, collapsed)"\n  on-force-visible="vm.forceVisible(thread)"\n  show-document-info="true"\n  thread="vm.rootThread">\n</thread-list>\n';

},{}],135:[function(require,module,exports){
module.exports='<div class="dropdown-menu-btn" >\n  <button\n    class="dropdown-menu-btn__btn"\n    ng-bind="vm.label"\n    ng-click="vm.onClick($event)"\n    ng-disabled="vm.isDisabled"\n    h-branding="ctaTextColor, ctaBackgroundColor">\n  </button>\n  <button\n    class="dropdown-menu-btn__dropdown-arrow"\n    title="{{vm.dropdownMenuLabel}}"\n    ng-click="vm.toggleDropdown($event)">\n    <div class="dropdown-menu-btn__dropdown-arrow-separator"></div>\n    <div\n      class="dropdown-menu-btn__dropdown-arrow-indicator"\n      h-branding="ctaTextColor, ctaBackgroundColor">\n      <div>▼</div>\n    </div>\n  </button>\n</div>\n';

},{}],136:[function(require,module,exports){
module.exports='<div ng-transclude ng-if="!vm.enabled"></div>\n<div class="excerpt__container" ng-if="vm.enabled">\n  <div class="excerpt" ng-style="vm.contentStyle()">\n    <div ng-transclude></div>\n    <div ng-click="vm.expand()"\n         ng-class="vm.bottomShadowStyles()"\n         title="Show the full excerpt"></div>\n    <div class="excerpt__inline-controls"\n         ng-show="vm.showInlineControls()">\n      <span class="excerpt__toggle-link" ng-show="vm.isExpandable()">\n        … <a ng-click="vm.toggle($event)"\n            title="Show the full excerpt"\n            h-branding="highlightColor">More</a>\n      </span>\n      <span class="excerpt__toggle-link" ng-show="vm.isCollapsible()">\n        <a ng-click="vm.toggle($event)"\n            title="Show the first few lines only"\n            h-branding="highlightColor">Less</a>\n      </span>\n    </div>\n  </div>\n</div>\n';

},{}],137:[function(require,module,exports){
module.exports='<span ng-if="vm.auth.status === \'logged-out\'"\n      ng-switch on="vm.groups.focused().public">\n  <img class="group-list-label__icon group-list-label__icon--third-party"\n    ng-src="{{ vm.thirdPartyGroupIcon }}"\n    ng-if="vm.thirdPartyGroupIcon"\n    ng-switch-when="true"><!-- nospace\n  !--><i class="group-list-label__icon h-icon-public"\n    ng-if="!vm.thirdPartyGroupIcon"\n    ng-switch-when="true"></i><!-- nospace\n  !--><i class="group-list-label__icon h-icon-group" ng-switch-default></i>\n  <span class="group-list-label__label">{{vm.groups.focused().name}}</span>\n</span>\n\n<div class="pull-right"\n     ng-if="vm.auth.status === \'logged-in\'"\n     dropdown\n     keyboard-nav>\n  <div class="dropdown-toggle"\n        dropdown-toggle\n        data-toggle="dropdown"\n        role="button"\n        ng-switch on="vm.groups.focused().public"\n        title="Change the selected group">\n    <img class="group-list-label__icon group-list-label__icon--third-party"\n         ng-src="{{ vm.thirdPartyGroupIcon }}"\n         ng-if="vm.thirdPartyGroupIcon"\n         ng-switch-when="true"><!-- nospace\n    !--><i class="group-list-label__icon h-icon-public"\n           ng-switch-when="true"\n           ng-if="!vm.thirdPartyGroupIcon"></i><!-- nospace\n    !--><i class="group-list-label__icon h-icon-group"\n           ng-switch-default></i>\n    <span class="group-list-label__label">{{vm.groups.focused().name}}</span><!-- nospace\n    !--><i class="h-icon-arrow-drop-down"></i>\n  </div>\n  <div class="dropdown-menu__top-arrow"></div>\n  <ul class="dropdown-menu pull-none" role="menu">\n    <li class="dropdown-menu__row dropdown-menu__row--unpadded "\n        ng-repeat="group in vm.groups.all()">\n      <div ng-class="{\'group-item\': true, selected: group.id == vm.groups.focused().id}"\n           ng-click="vm.focusGroup(group.id)">\n        <!-- the group icon !-->\n        <div class="group-icon-container" ng-switch on="group.public">\n          <img class="group-list-label__icon group-list-label__icon--third-party"\n               ng-src="{{ vm.thirdPartyGroupIcon }}"\n               ng-if="vm.thirdPartyGroupIcon"\n               ng-switch-when="true">\n          <i class="h-icon-public" ng-if="!vm.thirdPartyGroupIcon" ng-switch-when="true"></i>\n          <i class="h-icon-group" ng-switch-default></i>\n        </div>\n        <!-- the group name and share link !-->\n        <div class="group-details">\n          <div class="group-name-container">\n            <a class="group-name-link"\n               href=""\n               title="{{ group.public ? \'Show public annotations\' : \'Show and create annotations in \' + group.name }}">\n               {{group.name}}\n            </a>\n          </div>\n          <div class="share-link-container" ng-click="$event.stopPropagation()" ng-if="!group.public">\n            <a class="share-link" href="{{group.url}}" target="_blank">\n              View group activity and invite others\n            </a>\n          </div>\n        </div>\n        <!-- the \'Leave group\' icon !-->\n        <div class="group-cancel-icon-container" ng-click="$event.stopPropagation()">\n          <i class="h-icon-cancel-outline btn--cancel"\n             ng-if="!group.public"\n             ng-click="vm.leaveGroup(group.id)"\n             title="Leave \'{{group.name}}\'"></i>\n        </div>\n      </div>\n    </li>\n    <li ng-if="!vm.isThirdPartyUser()" class="dropdown-menu__row dropdown-menu__row--unpadded new-group-btn">\n      <div class="group-item" ng-click="vm.createNewGroup()">\n        <div class="group-icon-container"><i class="h-icon-add"></i></div>\n        <div class="group-details">\n          <a href="" class="group-name-link" title="Create a new group to share annotations">\n            New group\n          </a>\n        </div>\n      </div>\n    </li>\n  </ul>\n</div>\n';

},{}],138:[function(require,module,exports){
module.exports="\n<a class=\"help-panel-content__link\"\n   href=\"mailto:support@hypothes.is?subject=Hypothesis%20support&amp;body=Version:%20{{ vm.version }}%0D%0AUser%20Agent:%20{{vm.userAgent}}%0D%0AURL:%20{{ vm.url }}%0D%0APDF%20fingerprint:%20{{ vm.documentFingerprint ? vm.documentFingerprint : '-' }}%0D%0AUsername:%20{{ vm.auth.username ? vm.auth.username : '-' }}%0D%0ADate:%20{{ vm.dateTime | date:'dd MMM yyyy HH:mm:ss Z' }} \"\n>Send us an email</a>\n";

},{}],139:[function(require,module,exports){
module.exports='<div class="help-panel">\n  <i class="close h-icon-close"\n    role="button"\n    title="Close"\n    ng-click="vm.onClose()"></i>\n\n  <header class="help-panel-title">\n    Help\n  </header>\n  <div class="help-panel-content">\n    <help-link\n      version="vm.version"\n      user-agent="vm.userAgent"\n      url="vm.url"\n      document-fingerprint="vm.documentFingerprint"\n      auth="vm.auth"\n      date-time="vm.dateTime">\n    </help-link> if you have any questions or want to give us feedback.\n    You can also send <a class="help-panel-content__link" href="https://hypothesis.zendesk.com/hc/en-us/requests/new" target="_blank">a support ticket</a>\n    or visit our <a class="help-panel-content__link" href="https://hypothesis.zendesk.com/hc/en-us" target="_blank"> help documents</a>.\n  </div>\n  <header class="help-panel-title">\n    About this version\n  </header>\n  <dl class="help-panel-content">\n    <dt class="help-panel-content__key">Version: </dt>\n    <dd class="help-panel-content__val">{{ vm.version }}</dd>\n    <dt class="help-panel-content__key">User agent: </dt>\n    <dd class="help-panel-content__val">{{ vm.userAgent }}</dd>\n    <div ng-if="vm.url">\n      <dt class="help-panel-content__key">URL: </dt>\n      <dd class="help-panel-content__val">{{ vm.url }}</dd>\n    </div>\n    <div ng-if="vm.documentFingerprint">\n      <dt class="help-panel-content__key">PDF fingerprint: </dt>\n      <dd class="help-panel-content__val">{{ vm.documentFingerprint }}</dd>\n    </div>\n    <div ng-if="vm.auth.userid">\n      <dt class="help-panel-content__key">Username: </dt>\n      <dd class="help-panel-content__val">{{ vm.auth.username }}</dd>\n    </div>\n    <dt class="help-panel-content__key">Date: </dt>\n    <dd class="help-panel-content__val">{{ vm.dateTime | date:\'dd MMM yyyy HH:mm:ss Z\' }}</dd>\n  </div>\n</div>\n';

},{}],140:[function(require,module,exports){
module.exports='<div class="app-content-wrapper" h-branding="appBackgroundColor">\n  <top-bar\n    auth="vm.auth"\n    on-login="vm.login()"\n    on-sign-up="vm.signUp()"\n    on-logout="vm.logout()"\n    on-share-page="vm.share()"\n    on-show-help-panel="vm.helpPanel.visible = true"\n    is-sidebar="::vm.isSidebar"\n    pending-update-count="vm.countPendingUpdates()"\n    on-apply-pending-updates="vm.applyPendingUpdates()"\n    search-controller="vm.search"\n    sort-key="vm.sortKey()"\n    sort-keys-available="vm.sortKeysAvailable()"\n    on-change-sort-key="vm.setSortKey(sortKey)">\n  </top-bar>\n\n  <div class="create-account-banner" ng-if="vm.isSidebar && vm.auth.status === \'logged-out\'">\n    To annotate this document\n    <a href="{{ vm.serviceUrl(\'signup\') }}" target="_blank">\n      create a free account\n    </a>\n    or <a href="" ng-click="vm.login()">log in</a>\n  </div>\n\n  <div class="content">\n    <login-form\n      ng-if="vm.accountDialog.visible"\n      on-close="vm.accountDialog.visible = false">\n    </login-form>\n    <sidebar-tutorial ng-if="vm.isSidebar"></sidebar-tutorial>\n    <share-dialog\n      ng-if="vm.shareDialog.visible"\n      on-close="vm.shareDialog.visible = false">\n    </share-dialog>\n    <help-panel ng-if="vm.helpPanel.visible"\n      on-close="vm.helpPanel.visible = false"\n      auth="vm.auth">\n    </help-panel>\n    <main ng-view=""></main>\n  </div>\n</div>\n';

},{}],141:[function(require,module,exports){
module.exports='<!-- message to display to loggedout users when they visit direct linked annotations -->\n<li class="loggedout-message">\n  <span>\n    This is a public annotation created with Hypothesis.\n    <br>\n    To reply or make your own annotations on this document,\n    <a class="loggedout-message__link" href="{{vm.serviceUrl(\'signup\')}}" target="_blank">create a free account</a>\n    or\n    <a class="loggedout-message__link" href="" ng-click="vm.onLogin()">log in</a>.\n  </span>\n  <span class="loggedout-message-logo">\n    <a href="https://hypothes.is">\n      <i class="h-icon-hypothesis-logo loggedout-message-logo__icon"></i>\n    </a>\n  </span>\n</li>\n';

},{}],142:[function(require,module,exports){
module.exports='<!-- New controls -->\n<span class="login-text"\n      ng-if="vm.newStyle && vm.auth.status === \'unknown\'">⋯</span>\n<span class="login-text"\n      ng-if="vm.newStyle && vm.auth.status === \'logged-out\'">\n  <a href="{{vm.serviceUrl(\'signup\')}}" ng-click="vm.onSignUp()" target="_blank" h-branding="highlightColor">Sign up</a>\n  / <a href="" ng-click="vm.onLogin()" h-branding="highlightColor">Log in</a>\n</span>\n<div ng-if="vm.newStyle"\n     class="pull-right login-control-menu"\n     dropdown\n     keyboard-nav>\n  <a role="button"\n     class="top-bar__btn"\n     data-toggle="dropdown"\n     dropdown-toggle\n     title="{{vm.auth.username}}">\n    <i class="h-icon-account" ng-if="vm.auth.status === \'logged-in\'"></i><!--\n    !--><i class="h-icon-arrow-drop-down top-bar__dropdown-arrow"></i>\n  </a>\n  <ul class="dropdown-menu pull-right" role="menu">\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <span ng-if="vm.isThirdPartyUser()"\n            class="dropdown-menu__link dropdown-menu__link--disabled">\n        {{vm.auth.username}}</span>\n      <a ng-if="!vm.isThirdPartyUser()"\n         href="{{vm.serviceUrl(\'user\',{user: vm.auth.username})}}"\n         class="dropdown-menu__link"\n         title="View all your annotations"\n         target="_blank">{{vm.auth.username}}</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\' && !vm.isThirdPartyUser()">\n      <a class="dropdown-menu__link" href="{{vm.serviceUrl(\'account.settings\')}}" target="_blank">Account settings</a>\n    </li>\n    <li class="dropdown-menu__row">\n      <a class="dropdown-menu__link" ng-click="vm.onShowHelpPanel()">Help</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\' && !vm.isThirdPartyUser()">\n      <a class="dropdown-menu__link dropdown-menu__link--subtle"\n         href="" ng-click="vm.onLogout()">Log out</a>\n    </li>\n  </ul>\n</div>\n\n<!-- Old controls -->\n<span ng-if="!vm.newStyle && vm.auth.status === \'unknown\'">⋯</span>\n<span ng-if="!vm.newStyle && vm.auth.status === \'logged-out\'">\n  <a href="" ng-click="vm.onLogin()">Log in</a>\n</span>\n<div ng-if="!vm.newStyle"\n     class="pull-right login-control-menu"\n     dropdown\n     keyboard-nav>\n  <span role="button" data-toggle="dropdown" dropdown-toggle>\n    {{vm.auth.username}}<!--\n    --><span class="provider"\n             ng-if="vm.auth.provider">/{{vm.auth.provider}}</span><!--\n    --><i class="h-icon-arrow-drop-down"></i>\n  </span>\n  <ul class="dropdown-menu pull-right" role="menu">\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <a class="dropdown-menu__link" href="{{vm.serviceUrl(\'account.settings\')}}" target="_blank">Account</a>\n    </li>\n    <li class="dropdown-menu__row" >\n      <a class="dropdown-menu__link" ng-click="vm.onShowHelpPanel()">Help</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <a class="dropdown-menu__link" href="{{vm.serviceUrl(\'user\',{user: vm.auth.username})}}"\n         target="_blank">My Annotations</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <a class="dropdown-menu__link" href="" ng-click="vm.onLogout()">Log out</a>\n    </li>\n  </ul>\n</div>\n';

},{}],143:[function(require,module,exports){
module.exports='<div class="sheet">\n  <i class="close h-icon-close"\n     role="button"\n     title="Close"\n     ng-click="vm.onClose()"></i>\n  <div class="form-vertical"\n       ng-form="form"\n       ng-submit="vm.submit(form[\'login\'])">\n    <div class="tab-content">\n      <form data-value="login"\n            class="form"\n            name="login"\n            form-validate\n            novalidate>\n\n        <p class="form-description form-error"\n           ng-show="login.responseErrorMessage">\n          {{login.responseErrorMessage}}\n        </p>\n\n        <div class="form-field">\n          <label class="form-label" for="field-login-username">Username or email address:</label>\n          <input class="form-input" type="text" id="field-login-username"\n                 name="username" value=""\n                 ng-model="model.username"\n                 required autocapitalize="false" h-autofocus />\n          <ul class="form-error-list">\n            <li class="form-error"\n                ng-show="login.username.$error.required"\n                >Please enter your username or email address.</li>\n            <li class="form-error"\n                ng-show="login.username.$error.response"\n                ng-bind-html="login.username.responseErrorMessage">\n            </li>\n          </ul>\n        </div>\n\n        <div class="form-field">\n          <label class="form-label" for="field-login-password">Password:</label>\n          <input class="form-input" id="field-login-password"\n                 type="password" name="password" value=""\n                 ng-model="model.password"\n                 required autocapitalize="false" autocorrect="false" />\n          <ul class="form-error-list">\n            <li class="form-error"\n                ng-show="login.password.$error.required"\n                >Please enter your password.</li>\n            <li class="form-error"\n                ng-show="login.password.$error.response"\n                >{{login.password.responseErrorMessage}}</li>\n          </ul>\n        </div>\n\n        <div class="form-actions">\n          <div class="form-actions-message">\n            <a href="{{vm.serviceUrl(\'forgot-password\')}}" target="_blank" h-branding="highlightColor">Forgot your password?</a>\n          </div>\n          <div class="form-actions-buttons">\n            <button class="btn btn-primary" type="submit" name="login"\n                    status-button="login">Log in</button>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n';

},{}],144:[function(require,module,exports){
module.exports='<div ng-if="!vm.readOnly" class="markdown-tools" ng-class="vm.preview && \'disable\'">\n  <span class="markdown-preview-toggle">\n    <a class="markdown-tools-badge h-icon-markdown" href="https://help.github.com/articles/markdown-basics" title="Parsed as Markdown" target="_blank"></a>\n    <a href="" class="markdown-tools-toggle" ng-click="vm.togglePreview()"\n      ng-show="!vm.preview">Preview</a>\n    <a href="" class="markdown-tools-toggle" ng-click="vm.togglePreview()"\n      ng-show="vm.preview">Write</a>\n  </span>\n  <i class="h-icon-format-bold markdown-tools-button" ng-click="vm.insertBold()" title="Embolden text"></i>\n  <i class="h-icon-format-italic markdown-tools-button" ng-click="vm.insertItalic()" title="Italicize text"></i>\n  <i class="h-icon-format-quote markdown-tools-button" ng-click="vm.insertQuote()" title="Quote text"></i>\n  <i class="h-icon-insert-link markdown-tools-button" ng-click="vm.insertLink()" title="Insert link"></i>\n  <i class="h-icon-insert-photo markdown-tools-button" ng-click="vm.insertIMG()" title="Insert image"></i>\n  <i class="h-icon-functions markdown-tools-button" ng-click="vm.insertMath()" title="Insert mathematical notation (LaTex is supported)"></i>\n  <i class="h-icon-format-list-numbered markdown-tools-button" ng-click="vm.insertNumList()" title="Insert numbered list"></i>\n  <i class="h-icon-format-list-bulleted markdown-tools-button" ng-click="vm.insertList()" title="Insert list"></i>\n</div>\n<textarea class="form-input form-textarea js-markdown-input"\n          ng-show="vm.showEditor()"\n          ng-click="$event.stopPropagation()"\n          h-branding="annotationFontFamily"></textarea>\n<div class="markdown-body js-markdown-preview"\n     ng-class="(vm.preview && \'markdown-preview\') || vm.customTextClass"\n     ng-dblclick="vm.togglePreview()"\n     ng-show="!vm.showEditor()"\n     h-branding="annotationFontFamily"></div>\n';

},{}],145:[function(require,module,exports){
module.exports='<div class="moderation-banner"\n     ng-if="vm.flagCount() > 0 || vm.isHidden()"\n     ng-class="{\'is-flagged\': vm.flagCount() > 0,\n                \'is-hidden\': vm.isHidden(),\n                \'is-reply\': vm.isReply}">\n  <span ng-if="vm.flagCount() > 0 && !vm.isHidden()">\n    Flagged for review x{{ vm.flagCount() }}\n  </span>\n  <span ng-if="vm.isHidden()">\n    Hidden from users. Flagged x{{ vm.flagCount() }}\n  </span>\n  <span class="u-stretch"></span>\n  <button ng-if="!vm.isHidden()"\n          ng-click="vm.hideAnnotation()"\n          title="Hide this annotation from non-moderators">\n    Hide\n  </button>\n  <button ng-if="vm.isHidden()"\n          ng-click="vm.unhideAnnotation()"\n          title="Make this annotation visible to everyone">\n    Unhide\n  </button>\n</div>\n';

},{}],146:[function(require,module,exports){
module.exports='<div dropdown="" class="publish-annotation-btn__btn" is-open="vm.showDropdown" keyboard-nav>\n  <dropdown-menu-btn\n    label="\'Post to \' + vm.publishDestination()"\n    on-click="vm.onSave()"\n    on-toggle-dropdown="vm.showDropdown = !vm.showDropdown"\n    title="Publish this annotation to {{vm.publishDestination()}}"\n    dropdown-menu-label="Change annotation sharing setting"\n    is-disabled="!vm.canPost">\n  </dropdown-menu-btn>\n  <div class="publish-annotation-btn__dropdown-container">\n    <ul class="dropdown-menu pull-center group-list publish-annotation-btn__dropdown-menu" role="menu">\n      <li class="dropdown-menu__row" ng-click="vm.setPrivacy(\'shared\')">\n        <div class="group-item">\n          <div class="group-icon-container">\n            <i class="small" ng-class="\'h-icon-\' + vm.groupType()"></i>\n          </div>\n          <div class="group-details">\n            <div class="group-name-container">\n              <a href="" class="group-name-link" ng-bind="vm.group.name"></a>\n            </div>\n          </div>\n        </div>\n      </li>\n      <li class="dropdown-menu__row" ng-click="vm.setPrivacy(\'private\')">\n        <div class="group-item">\n          <div class="group-icon-container">\n            <i class="small h-icon-lock"></i>\n          </div>\n          <div class="group-details">\n            <div class="group-name-container">\n              <a href="" class="group-name-link" ng-bind="vm.privateLabel"></a>\n            </div>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n<button class="publish-annotation-cancel-btn btn-clean"\n        ng-click="vm.onCancel()"\n        title="Cancel changes to this annotation"\n        >\n  <i class="h-icon-cancel-outline publish-annotation-cancel-btn__icon btn-icon"></i> Cancel\n</button>\n';

},{}],147:[function(require,module,exports){
module.exports='<form class="simple-search-form"\n      name="searchForm"\n      ng-class="!vm.query && \'simple-search-inactive\'">\n  <input class="simple-search-input"\n         type="text"\n         name="query"\n         placeholder="{{vm.loading && \'Loading\' || \'Search\'}}…"\n         ng-disabled="vm.loading"\n         ng-class="vm.inputClasses()"/>\n  <button type="button" class="simple-search-icon top-bar__btn" ng-hide="vm.loading">\n    <i class="h-icon-search"></i>\n  </button>\n  <button type="button" class="simple-search-icon btn btn-clean" ng-show="vm.loading" disabled>\n    <span class="btn-icon"><span class="spinner"></span></span>\n  </button>\n</form>\n';

},{}],148:[function(require,module,exports){
module.exports='<div class="search-status-bar" ng-if="vm.filterActive">\n  <button class="primary-action-btn primary-action-btn--short"\n          ng-click="vm.onClearSelection()"\n          title="Clear the search filter and show all annotations"\n  >\n    <i class="primary-action-btn__icon h-icon-close"></i> Clear search\n  </button>\n  <span ng-pluralize\n           count="vm.filterMatchCount"\n           when="{\'0\': \'No results for “{{vm.searchQuery}}”\',\n                  \'one\': \'1 search result\',\n                  \'other\': \'{} search results\'}"></span>\n</div>\n<div class="search-status-bar" ng-if="!vm.filterActive && vm.selectionCount > 0">\n  <button class="primary-action-btn primary-action-btn--short"\n          ng-click="vm.onClearSelection()"\n          title="Clear the selection and show all annotations">\n    <span ng-if="!vm.selectedTab || vm.selectedTab === vm.TAB_ORPHANS">\n      Show all annotations and notes\n    </span>\n    <span ng-if="vm.selectedTab === vm.TAB_ANNOTATIONS">\n      Show all annotations\n      <span ng-if="vm.totalAnnotations > 1">\n        ({{vm.totalAnnotations}})\n      </span>\n    </span>\n    <span ng-if="vm.selectedTab === vm.TAB_NOTES">\n      Show all notes\n      <span ng-if="vm.totalNotes > 1">\n        ({{vm.totalNotes}})\n      </span>\n    </span>\n  </button>\n\n</div>\n';

},{}],149:[function(require,module,exports){
module.exports='<!-- Tabbed display of annotations and notes. -->\n<div class="selection-tabs">\n  <a class="selection-tabs__type"\n     href="#"\n     ng-class="{\'is-selected\': vm.selectedTab === vm.TAB_ANNOTATIONS}"\n     h-on-touch="vm.selectTab(vm.TAB_ANNOTATIONS)">\n    Annotations\n    <span class="selection-tabs__count"\n      ng-if="vm.totalAnnotations > 0 && !vm.isWaitingToAnchorAnnotations">\n      {{ vm.totalAnnotations }}\n    </span>\n  </a>\n  <a class="selection-tabs__type"\n     href="#"\n     ng-class="{\'is-selected\': vm.selectedTab === vm.TAB_NOTES}"\n     h-on-touch="vm.selectTab(vm.TAB_NOTES)">\n    Page Notes\n    <span class="selection-tabs__count"\n      ng-if="vm.totalNotes > 0 && !vm.isWaitingToAnchorAnnotations">\n      {{ vm.totalNotes }}\n    </span>\n  </a>\n  <a class="selection-tabs__type selection-tabs__type--orphan"\n    ng-if="vm.orphansTabFlagEnabled() && vm.totalOrphans > 0"\n    href="#"\n    ng-class="{\'is-selected\': vm.selectedTab === vm.TAB_ORPHANS}"\n    h-on-touch="vm.selectTab(vm.TAB_ORPHANS)">\n    Orphans\n    <span class="selection-tabs__count"\n      ng-if="vm.totalOrphans > 0 && !vm.isWaitingToAnchorAnnotations">\n      {{ vm.totalOrphans }}\n    </span>\n  </a>\n</div>\n<div ng-if="!vm.isLoading()" class="selection-tabs__empty-message">\n  <div ng-if="vm.showNotesUnavailableMessage()"  class="annotation-unavailable-message">\n    <p class="annotation-unavailable-message__label">\n      There are no page notes in this group.\n      <br />\n      Create one by clicking the\n      <i class="help-icon h-icon-note"></i>\n      button.\n    </p>\n  </div>\n  <div ng-if="vm.showAnnotationsUnavailableMessage()"  class="annotation-unavailable-message">\n    <p class="annotation-unavailable-message__label">\n      There are no annotations in this group.\n      <br />\n      Create one by selecting some text and clicking the\n      <i class="help-icon h-icon-annotate"></i> button.\n    </p>\n  </div>\n</div>\n';

},{}],150:[function(require,module,exports){
module.exports='<div class="sheet">\n  <i class="close h-icon-close"\n     role="button"\n     title="Close"\n     ng-click="vm.onClose()"></i>\n  <div class="form-vertical">\n    <ul class="nav nav-tabs">\n      <li class="active"><a href="">Share</a></li>\n    </ul>\n    <div class="tab-content">\n      <p>Share the link below to show anyone these annotations and invite them to contribute their own.</p>\n      <p><input class="js-via form-input"\n          type="text"\n          ng-value="vm.viaPageLink"\n          readonly /></p>\n      <p class="share-link-icons">\n      <a href="https://twitter.com/intent/tweet?url={{vm.viaPageLink | urlEncode}}&hashtags=annotated"\n         target="_blank"\n         title="Tweet link"\n         class="share-link-icon h-icon-twitter"\n         ng-click="onShareClick(\'twitter\')"></a>\n      <a href="https://www.facebook.com/sharer/sharer.php?u={{vm.viaPageLink | urlEncode}}"\n         target="_blank"\n         title="Share on Facebook"\n         class="share-link-icon h-icon-facebook"\n         ng-click="onShareClick(\'facebook\')"></a>\n      <a href="https://plus.google.com/share?url={{vm.viaPageLink | urlEncode}}"\n         target="_blank"\n         title="Post on Google Plus"\n         class="share-link-icon h-icon-google-plus"\n         ng-click="onShareClick(\'googlePlus\')"></a>\n      <a href="mailto:?subject=Let\'s%20Annotate&amp;body={{vm.viaPageLink}}"\n         target="_blank"\n         title="Share via email"\n         class="share-link-icon h-icon-mail"\n         ng-click="onShareClick(\'email\')"></a>\n      </p>\n    </div>\n  </div>\n</div>\n';

},{}],151:[function(require,module,exports){
module.exports='<selection-tabs\n  ng-if="!vm.search.query() && vm.selectedAnnotationCount() === 0"\n  is-waiting-to-anchor-annotations="vm.waitingToAnchorAnnotations"\n  is-loading="vm.isLoading"\n  selected-tab="vm.selectedTab"\n  total-annotations="vm.totalAnnotations"\n  total-notes="vm.totalNotes"\n  total-orphans="vm.totalOrphans">\n</selection-tabs>\n\n<search-status-bar\n  ng-show="!vm.isLoading()"\n  filter-active="!!vm.search.query()"\n  filter-match-count="vm.visibleCount()"\n  on-clear-selection="vm.clearSelection()"\n  search-query="vm.search ? vm.search.query : \'\'"\n  selection-count="vm.selectedAnnotationCount()"\n  total-count="vm.topLevelThreadCount()"\n  selected-tab="vm.selectedTab"\n  total-annotations="vm.totalAnnotations"\n  total-notes="vm.totalNotes">\n</search-status-bar>\n\n<div class="annotation-unavailable-message"\n    ng-if="vm.selectedAnnotationUnavailable()">\n  <div class="annotation-unavailable-message__icon"></div>\n  <p class="annotation-unavailable-message__label">\n    <span ng-if="vm.auth.status === \'logged-out\'">\n      This annotation is not available.\n      <br>\n      You may need to\n      <a class="loggedout-message__link" href="" ng-click="vm.login()">log in</a>\n      to see it.\n    </span>\n    <span ng-if="vm.auth.status === \'logged-in\'">\n      You do not have permission to view this annotation.\n    </span>\n  </p>\n</div>\n\n<thread-list\n  on-change-collapsed="vm.setCollapsed(id, collapsed)"\n  on-clear-selection="vm.clearSelection()"\n  on-focus="vm.focus(annotation)"\n  on-force-visible="vm.forceVisible(thread)"\n  on-select="vm.scrollTo(annotation)"\n  show-document-info="false"\n  thread="vm.rootThread">\n</thread-list>\n\n<loggedout-message ng-if="vm.shouldShowLoggedOutMessage()" on-login="vm.login()">\n</loggedout-message>\n';

},{}],152:[function(require,module,exports){
module.exports='<div class="sheet" ng-if="vm.showSidebarTutorial()">\n  <i class="close h-icon-close" role="button" title="Close"\n     ng-click="vm.dismiss()"></i>\n  <h1 class="sidebar-tutorial__header">How to get started</h1>\n  <ol class="sidebar-tutorial__list">\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content">\n        To create an annotation, select text and click the\n        <i class="h-icon-annotate"></i>&nbsp;button.\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content">\n        To add a note to the page you are viewing, click the\n        <i class="h-icon-note"></i>&nbsp;button.\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content">\n        To create a highlight, select text and click the\n        <i class="h-icon-highlight"></i>&nbsp;button.\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content">\n        To reply to an annotation, click the\n        <i class="h-icon-annotation-reply"></i>&nbsp;<strong>Reply</strong>&nbsp;link.\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content">\n        To share an annotated page, click the\n        <i class="h-icon-annotation-share"></i>&nbsp;button at the top.\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content">\n        To create a private group, select <strong>Public</strong>,\n        open the dropdown, click&nbsp;<strong>+&nbsp;New&nbsp;group</strong>.\n      </p>\n    </li>\n  </ol>\n</div>\n';

},{}],153:[function(require,module,exports){
module.exports='<span dropdown keyboard-nav>\n  <button\n    type="button"\n    class="top-bar__btn"\n    dropdown-toggle\n    title="Sort by {{vm.sortKey}}">\n    <i class="h-icon-sort"></i>\n  </button>\n  <div class="dropdown-menu__top-arrow"></div>\n  <ul class="dropdown-menu pull-right" role="menu">\n    <li class="dropdown-menu__row"\n        ng-repeat="key in vm.sortKeysAvailable"\n        ng-click="vm.onChangeSortKey({sortKey: key})"\n        ><span class="dropdown-menu-radio"\n               ng-class="{\'is-selected\' : vm.sortKey === key}"\n        ></span><a class="dropdown-menu__link" href="">{{key}}</a></li>\n  </ul>\n</span>\n';

},{}],154:[function(require,module,exports){
module.exports='<span window-scroll="vm.loadMore(20)">\n  <thread-list\n    on-change-collapsed="vm.setCollapsed(id, collapsed)"\n    on-force-visible="vm.forceVisible(thread)"\n    show-document-info="true"\n    thread="vm.rootThread">\n  </thread-list>\n</span>\n';

},{}],155:[function(require,module,exports){
module.exports='<tags-input ng-model="vm.tagList"\n  name="tags"\n  class="tags"\n  placeholder="Add tags…"\n  min-length="1"\n  replace-spaces-with-dashes="false"\n  enable-editing-last-tag="true"\n  on-tag-added="vm.onTagsChanged()"\n  on-tag-removed="vm.onTagsChanged()">\n  <auto-complete source="vm.autocomplete($query)"\n    min-length="1"\n    max-results-to-show="10"></auto-complete>\n</tags-input>\n';

},{}],156:[function(require,module,exports){
module.exports='<ul class="thread-list">\n  <li class="thread-list__spacer"\n      ng-style="{height: vm.virtualThreadList.offscreenUpperHeight}"></li>\n  <li id="{{child.id}}"\n      class="thread-list__card"\n      ng-mouseenter="vm.onFocus({annotation: child.annotation})"\n      ng-click="vm.onSelect({annotation: child.annotation})"\n      ng-mouseleave="vm.onFocus({annotation: null})"\n      ng-repeat="child in vm.virtualThreadList.visibleThreads track by child.id">\n      <annotation-thread\n        thread="child"\n        show-document-info="vm.showDocumentInfo"\n        on-change-collapsed="vm.onChangeCollapsed({id: id, collapsed: collapsed})"\n        on-force-visible="vm.onForceVisible({thread: thread})">\n      </annotation-thread>\n  </li>\n  <li id="{{child.id}}"\n      ng-show="false"\n      ng-repeat="child in vm.virtualThreadList.invisibleThreads track by child.id">\n      <annotation-thread thread="child" />\n  </li>\n  <li class="thread-list__spacer"\n      ng-style="{height: vm.virtualThreadList.offscreenLowerHeight}"></li>\n</ul>\n';

},{}],157:[function(require,module,exports){
module.exports='<!-- top bar for the sidebar and the stream.\n!-->\n<div class="top-bar">\n  <!-- Legacy design for top bar, as used in the stream !-->\n  <div class="top-bar__inner content" ng-if="::!vm.isSidebar">\n    <search-input\n      class="search-input"\n      query="vm.searchController.query()"\n      on-search="vm.searchController.update($query)"\n      always-expanded="true">\n    </search-input>\n    <div class="top-bar__expander"></div>\n    <login-control\n      auth="vm.auth"\n      new-style="false"\n      on-show-help-panel="vm.onShowHelpPanel()"\n      on-login="vm.onLogin()"\n      on-logout="vm.onLogout()">\n    </login-control>\n  </div>\n  <!-- New design for the top bar, as used in the sidebar.\n\n       The inner div is styled with \'content\' to center it in\n       the stream view.\n  !-->\n  <div class="top-bar__inner content" ng-if="::vm.isSidebar">\n    <group-list class="group-list" auth="vm.auth"></group-list>\n    <div class="top-bar__expander"></div>\n    <a class="top-bar__apply-update-btn"\n       ng-if="vm.pendingUpdateCount > 0"\n       ng-click="vm.onApplyPendingUpdates()"\n       h-tooltip\n       tooltip-direction="up"\n       aria-label="Show {{vm.pendingUpdateCount}} new/updated annotation(s)">\n       <svg-icon class="top-bar__apply-icon" name="\'refresh\'"></svg-icon>\n    </a>\n    <search-input\n      class="search-input"\n      query="vm.searchController.query()"\n      on-search="vm.searchController.update($query)"\n      title="Filter the annotation list">\n    </search-input>\n    <sort-dropdown\n      sort-keys-available="vm.sortKeysAvailable"\n      sort-key="vm.sortKey"\n      on-change-sort-key="vm.onChangeSortKey({sortKey: sortKey})">\n    </sort-dropdown>\n    <a class="top-bar__btn"\n       ng-click="vm.onSharePage()"\n       title="Share this page">\n      <i class="h-icon-annotation-share"></i>\n    </a>\n    <login-control\n      class="login-control"\n      auth="vm.auth"\n      new-style="true"\n      on-show-help-panel="vm.onShowHelpPanel()"\n      on-login="vm.onLogin()"\n      on-logout="vm.onLogout()"\n      on-sign-up="vm.onSignUp()">\n    </login-control>\n  </div>\n</div>\n';

},{}],158:[function(require,module,exports){
"use strict";function lessThanThirtySecondsAgo(t,n){return 3e4>n-t}function lessThanOneMinuteAgo(t,n){return 6e4>n-t}function lessThanOneHourAgo(t,n){return 36e5>n-t}function lessThanOneDayAgo(t,n){return 864e5>n-t}function thisYear(t,n){return t.getFullYear()===n.getFullYear()}function delta(t,n){return Math.round((n-t)/1e3)}function nSec(t,n){return"{} secs".replace("{}",Math.floor(delta(t,n)))}function nMin(t,n){var e=Math.floor(delta(t,n)/minute),r="{} min";return e>1&&(r+="s"),r.replace("{}",e)}function nHr(t,n){var e=Math.floor(delta(t,n)/hour),r="{} hr";return e>1&&(r+="s"),r.replace("{}",e)}function format(t,n,e){if("undefined"==typeof e&&(e=window.Intl),e&&e.DateTimeFormat){var r=JSON.stringify(n),a=formatters[r];return a||(a=formatters[r]=new e.DateTimeFormat(void 0,n)),a.format(t)}return t.toDateString()}function dayAndMonth(t,n,e){return format(t,{month:"short",day:"numeric"},e)}function dayAndMonthAndYear(t,n,e){return format(t,{day:"numeric",month:"short",year:"numeric"},e)}function getBreakpoint(t,n){t=new Date(t);for(var e,r=0;r<BREAKPOINTS.length;r++)if(e=BREAKPOINTS[r],e.test(t,n))return e;return null}function nextFuzzyUpdate(t){if(!t)return null;var n=getBreakpoint(t,new Date).nextUpdate;return null===n?null:(n=Math.max(n,5),n=Math.min(n,2073600))}function decayingInterval(t,n){var e,r=function(){var a=nextFuzzyUpdate(t);if(null!==a){var o=1e3*a+500;e=setTimeout(function(){n(t),r()},o)}};return r(),function(){clearTimeout(e)}}function toFuzzyString(t,n){if(!t)return"";var e=new Date;return getBreakpoint(t,e).format(new Date(t),e,n)}var minute=60,hour=60*minute,formatters={},BREAKPOINTS=[{test:lessThanThirtySecondsAgo,format:function(){return"Just now"},nextUpdate:1},{test:lessThanOneMinuteAgo,format:nSec,nextUpdate:1},{test:lessThanOneHourAgo,format:nMin,nextUpdate:minute},{test:lessThanOneDayAgo,format:nHr,nextUpdate:hour},{test:thisYear,format:dayAndMonth,nextUpdate:null},{test:function(){return!0},format:dayAndMonthAndYear,nextUpdate:null}];module.exports={decayingInterval:decayingInterval,nextFuzzyUpdate:nextFuzzyUpdate,toFuzzyString:toFuzzyString};

},{}],159:[function(require,module,exports){
"use strict";module.exports={TAB_ANNOTATIONS:"annotation",TAB_NOTES:"note",TAB_ORPHANS:"orphan"};

},{}],160:[function(require,module,exports){
var COMBINING_MARKS,unorm;unorm=require("unorm"),COMBINING_MARKS=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u08FE\u0900-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C01-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C82\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D02\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1DC0-\u1DE6\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE26]/g,module.exports=function(){return{normalize:function(u){return unorm.nfkd(u)},fold:function(u){return u.replace(COMBINING_MARKS,"")}}};

},{"unorm":"unorm"}],161:[function(require,module,exports){
"use strict";function countIf(t,e){return t.reduce(function(t,n){return e(n)?t+1:t},0)}function filterMap(t,e){return t.reduce(function(t,n){var r=e(n);return r&&t.push(r),t},[])}function toSet(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}module.exports={countIf:countIf,filterMap:filterMap,toSet:toSet};

},{}],162:[function(require,module,exports){
"use strict";function toPx(t){return t.toString()+"px"}function ExcerptOverflowMonitor(t,e){function o(){var e=t.getState();if(a){a=!1;var o=!1;if(e.enabled){var n=e.overflowHysteresis||0;o=t.contentHeight()>e.collapsedHeight+n}o!==i&&(i=o,t.onOverflowChanged(o))}}function n(){a||(a=!0,e(o))}function r(){var e=t.getState();if(!e.enabled)return{};var o="";return i?e.collapse?o=toPx(e.collapsedHeight):e.animate&&(o=toPx(t.contentHeight())):"undefined"==typeof i&&e.collapse&&(o=toPx(e.collapsedHeight)),{"max-height":o}}var i,a=!1;this.contentStyle=r,this.check=n}module.exports=ExcerptOverflowMonitor;

},{}],163:[function(require,module,exports){
"use strict";function memoize(e){if(1!==e.length)throw new Error("Memoize input must be a function of one argument");var n,t;return function(o){return o===n?t:(n=o,t=e(o))}}module.exports=memoize;

},{}],164:[function(require,module,exports){
"use strict";module.exports=function(t,o,e,n,u){n=n||setTimeout,u=u||clearTimeout;var i,c=n(function(){i(),o()},e);i=t.$on("$destroy",function(){u(c)})};

},{}],165:[function(require,module,exports){
"use strict";function replaceURLParams(e,r){var a={};for(var n in r)if(r.hasOwnProperty(n)){var o=r[n],s=":"+n;-1!==e.indexOf(s)?e=e.replace(s,encodeURIComponent(o)):a[n]=o}return{url:e,params:a}}function resolve(e,r){return new URL(e,r).href}module.exports={replaceURLParams:replaceURLParams,resolve:resolve};

},{}],166:[function(require,module,exports){
angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.dropdown","ui.bootstrap.position"]),angular.module("ui.bootstrap.tpls",[]),angular.module("ui.bootstrap.dropdown",["ui.bootstrap.position"]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$rootScope",function(e,t){var n=null;this.open=function(t){n||(e.bind("click",o),e.bind("keydown",i)),n&&n!==t&&(n.isOpen=!1),n=t},this.close=function(t){n===t&&(n=null,e.unbind("click",o),e.unbind("keydown",i))};var o=function(e){if(n&&(!e||"disabled"!==n.getAutoClose())){var o=n.getToggleElement();if(!(e&&o&&o[0].contains(e.target))){var i=n.getDropdownElement();e&&"outsideClick"===n.getAutoClose()&&i&&i[0].contains(e.target)||(n.isOpen=!1,t.$$phase||n.$apply())}}},i=function(e){27===e.which?(n.focusToggleElement(),o()):n.isKeynavEnabled()&&/(38|40)/.test(e.which)&&n.isOpen&&(e.preventDefault(),e.stopPropagation(),n.focusDropdownEntry(e.which))}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate","$position","$document","$compile","$templateRequest",function(e,t,n,o,i,r,l,d,p,s){var u,a,c=this,f=e.$new(),g=o.openClass,w=angular.noop,h=t.onToggle?n(t.onToggle):angular.noop,m=!1,O=!1,$=d.find("body");this.init=function(o){c.$element=o,t.isOpen&&(a=n(t.isOpen),w=a.assign,e.$watch(a,function(e){f.isOpen=!!e})),m=angular.isDefined(t.dropdownAppendToBody),O=angular.isDefined(t.keyboardNav),m&&c.dropdownMenu&&($.append(c.dropdownMenu),$.addClass("dropdown"),o.on("$destroy",function(){c.dropdownMenu.remove()}))},this.toggle=function(e){return f.isOpen=arguments.length?!!e:!f.isOpen},this.isOpen=function(){return f.isOpen},f.getToggleElement=function(){return c.toggleElement},f.getAutoClose=function(){return t.autoClose||"always"},f.getElement=function(){return c.$element},f.isKeynavEnabled=function(){return O},f.focusDropdownEntry=function(e){var t=c.dropdownMenu?angular.element(c.dropdownMenu).find("a"):angular.element(c.$element).find("ul").eq(0).find("a");switch(e){case 40:angular.isNumber(c.selectedOption)?c.selectedOption=c.selectedOption===t.length-1?c.selectedOption:c.selectedOption+1:c.selectedOption=0;break;case 38:angular.isNumber(c.selectedOption)?c.selectedOption=0===c.selectedOption?0:c.selectedOption-1:c.selectedOption=t.length-1}t[c.selectedOption].focus()},f.getDropdownElement=function(){return c.dropdownMenu},f.focusToggleElement=function(){c.toggleElement&&c.toggleElement[0].focus()},f.$watch("isOpen",function(t,n){if(m&&c.dropdownMenu){var o=l.positionElements(c.$element,c.dropdownMenu,"bottom-left",!0),d={top:o.top+"px",display:t?"block":"none"},a=c.dropdownMenu.hasClass("dropdown-menu-right");a?(d.left="auto",d.right=window.innerWidth-(o.left+c.$element.prop("offsetWidth"))+"px"):(d.left=o.left+"px",d.right="auto"),c.dropdownMenu.css(d)}var O=m?$:c.$element;if(r[t?"addClass":"removeClass"](O,g).then(function(){angular.isDefined(t)&&t!==n&&h(e,{open:!!t})}),t)c.dropdownMenuTemplateUrl&&s(c.dropdownMenuTemplateUrl).then(function(e){u=f.$new(),p(e.trim())(u,function(e){var t=e;c.dropdownMenu.replaceWith(t),c.dropdownMenu=t})}),f.focusToggleElement(),i.open(f);else{if(c.dropdownMenuTemplateUrl){u&&u.$destroy();var b=angular.element('<ul class="dropdown-menu"></ul>');c.dropdownMenu.replaceWith(b),c.dropdownMenu=b}i.close(f),c.selectedOption=null}angular.isFunction(w)&&w(e,t)}),e.$on("$locationChangeSuccess",function(){"disabled"!==f.getAutoClose()&&(f.isOpen=!1)});var b=e.$on("$destroy",function(){f.$destroy()});f.$on("$destroy",b)}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(e,t,n,o){o.init(t),t.addClass("dropdown")}}}).directive("dropdownMenu",function(){return{restrict:"AC",require:"?^dropdown",link:function(e,t,n,o){if(o){var i=n.templateUrl;i&&(o.dropdownMenuTemplateUrl=i),o.dropdownMenu||(o.dropdownMenu=t)}}}}).directive("keyboardNav",function(){return{restrict:"A",require:"?^dropdown",link:function(e,t,n,o){t.bind("keydown",function(e){if(-1!==[38,40].indexOf(e.which)){e.preventDefault(),e.stopPropagation();var t=o.dropdownMenu.find("a");switch(e.which){case 40:angular.isNumber(o.selectedOption)?o.selectedOption=o.selectedOption===t.length-1?o.selectedOption:o.selectedOption+1:o.selectedOption=0;break;case 38:angular.isNumber(o.selectedOption)?o.selectedOption=0===o.selectedOption?0:o.selectedOption-1:o.selectedOption=t.length-1}t[o.selectedOption].focus()}})}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(e,t,n,o){if(o){t.addClass("dropdown-toggle"),o.toggleElement=t;var i=function(i){i.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){o.toggle()})};t.bind("click",i),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(o.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",i)})}}}}),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(e,t){function n(e,n){return e.currentStyle?e.currentStyle[n]:t.getComputedStyle?t.getComputedStyle(e)[n]:e.style[n]}function o(e){return"static"===(n(e,"position")||"static")}var i=function(t){for(var n=e[0],i=t.offsetParent||n;i&&i!==n&&o(i);)i=i.offsetParent;return i||n};return{position:function(t){var n=this.offset(t),o={top:0,left:0},r=i(t[0]);r!=e[0]&&(o=this.offset(angular.element(r)),o.top+=r.clientTop-r.scrollTop,o.left+=r.clientLeft-r.scrollLeft);var l=t[0].getBoundingClientRect();return{width:l.width||t.prop("offsetWidth"),height:l.height||t.prop("offsetHeight"),top:n.top-o.top,left:n.left-o.left}},offset:function(n){var o=n[0].getBoundingClientRect();return{width:o.width||n.prop("offsetWidth"),height:o.height||n.prop("offsetHeight"),top:o.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:o.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}},positionElements:function(e,t,n,o){var i,r,l,d,p=n.split("-"),s=p[0],u=p[1]||"center";i=o?this.offset(e):this.position(e),r=t.prop("offsetWidth"),l=t.prop("offsetHeight");var a={center:function(){return i.left+i.width/2-r/2},left:function(){return i.left},right:function(){return i.left+i.width}},c={center:function(){return i.top+i.height/2-l/2},top:function(){return i.top},bottom:function(){return i.top+i.height}};switch(s){case"right":d={top:c[u](),left:a[s]()};break;case"left":d={top:c[u](),left:i.left-r};break;case"bottom":d={top:c[s](),left:a[u]()};break;default:d={top:i.top-l,left:a[u]()}}return d}}}]);

},{}],167:[function(require,module,exports){
var indexOf=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};module.exports=["unicode",function(t){var n,e,r,u;return u=function(n){var e;return"string"==typeof n?(e=t.normalize(n),t.fold(e)):n},r=function(t,n,e){var r,u,a,o,i;for(a=!0,o=t.terms,r=0,u=o.length;u>r;r++)if(i=o[r],e(i,n)){if(a=!0,"or"===t.operator)break}else if(a=!1,"and"===t.operator)break;return a},n=function(t,n,e){var r,u;return u=!0,r=t.terms.slice(),r=r.filter(function(t){return e(n,t)}),("and"===t.operator&&r.length<t.terms.length||"or"===t.operator&&!r.length)&&(u=!1),u},e=function(t,e,a){var o,i;return o=a.autofalse,null!=o&&o(e)?!1:(i=a.value(e),angular.isArray(i)?(i=i.map(function(t){return t.toLowerCase()}),i=i.map(function(t){return function(t){return u(t)}}(this)),n(t,i,a.match)):(i=i.toLowerCase(),i=u(i),r(t,i,a.match)))},{fields:{quote:{autofalse:function(t){return null!=t.references},value:function(t){var n,e,r,u;return n=function(){var n,e,a,o;for(a=t.target||[],o=[],n=0,e=a.length;e>n;n++)u=a[n],o.push(function(){var t,n,e,a;for(e=u.selector||[],a=[],t=0,n=e.length;n>t;t++)r=e[t],"TextQuoteSelector"===r.type&&r.exact&&a.push(r.exact);return a}());return o}(),n=(e=Array.prototype).concat.apply(e,n),n.join("\n")},match:function(t,n){return n.indexOf(t)>-1}},since:{autofalse:function(t){return null==t.updated},value:function(t){return t.updated},match:function(t,n){var e;return e=Math.round((+new Date-new Date(n))/1e3),t>=e}},tag:{autofalse:function(t){return null==t.tags},value:function(t){return t.tags},match:function(t,n){return indexOf.call(t,n)>=0}},text:{autofalse:function(t){return null==t.text},value:function(t){return t.text},match:function(t,n){return n.indexOf(t)>-1}},uri:{autofalse:function(t){return null==t.uri},value:function(t){return t.uri},match:function(t,n){return n.indexOf(t)>-1}},user:{autofalse:function(t){return null==t.user},value:function(t){return t.user},match:function(t,n){return n.indexOf(t)>-1}},any:{fields:["quote","text","tag","user"]}},filter:function(t,n){var r,a,o,i,f,l,c,s,h,d,m,p,v,g,x,y,O,w,b,k,C;g=Math.min.apply(Math,(null!=(y=n.result)?y.terms:void 0)||[]),f=0;for(r in n)c=n[r],c.terms&&(c.terms=c.terms.map(function(t){return function(t){return t=t.toLowerCase(),t=u(t)}}(this)));for(b=[],s=0,m=t.length;m>s&&(a=t[s],!(f>=g));s++){x=!0;for(o in n){if(c=n[o],!x)break;if(c.terms.length)switch(o){case"any":for(i=!1,O=this.fields.any.fields,h=0,p=O.length;p>h;h++)for(l=O[h],w=c.terms,d=0,v=w.length;v>d;d++)if(k=w[d],C={terms:[k],operator:"and"},e(C,a,this.fields[l])){i=!0;break}x=i;break;default:x=e(c,a,this.fields[o])}}x&&(f++,b.push(a.id))}return b}}}];

},{}],168:[function(require,module,exports){
"use strict";function VirtualThreadList(t,e,i,r){var s=this;this._rootThread=i,this._options=Object.assign({},r),this._heights={},this.window=e,this.scrollRoot=r.scrollRoot||document.body;var o=debounce(function(){s._updateVisibleThreads(),t.$digest()},20);this.scrollRoot.addEventListener("scroll",o),this.window.addEventListener("resize",o),this._detach=function(){this.scrollRoot.removeEventListener("scroll",o),this.window.removeEventListener("resize",o)}}var EventEmitter=require("tiny-emitter"),debounce=require("lodash.debounce"),inherits=require("inherits");inherits(VirtualThreadList,EventEmitter),VirtualThreadList.prototype.detach=function(){this._detach()},VirtualThreadList.prototype.setRootThread=function(t){t!==this._rootThread&&(this._rootThread=t,this._updateVisibleThreads())},VirtualThreadList.prototype.setThreadHeight=function(t,e){if(isNaN(e)||0>=e)throw new Error("Invalid thread height %d",e);this._heights[t]=e},VirtualThreadList.prototype._height=function(t){var e=200;return this._heights[t]||e},VirtualThreadList.prototype.yOffsetOf=function(t){var e=this,i=this._rootThread.children,r=i.findIndex(function(e){return e.id===t});return-1===r?0:i.slice(0,r).reduce(function(t,i){return t+e._height(i.id)},0)},VirtualThreadList.prototype._updateVisibleThreads=function(){for(var t,e=800,i=800,r=0,s=0,o=[],h=[],n=this._rootThread.children,d=this.window.innerHeight,a=0,l=0;l<n.length;l++){t=n[l];var u=this._height(t.id),c=!1;a+u<this.scrollRoot.scrollTop-e?s+=u:a<this.scrollRoot.scrollTop+d+i?(o.push(t),c=!0):r+=u,!c&&this._options.invisibleThreadFilter&&this._options.invisibleThreadFilter(t)&&h.push(t),a+=u}this.emit("changed",{offscreenLowerHeight:r,offscreenUpperHeight:s,visibleThreads:o,invisibleThreads:h})},module.exports=VirtualThreadList;

},{"inherits":5,"lodash.debounce":8,"tiny-emitter":36}],169:[function(require,module,exports){
"use strict";function Socket(e){function t(){for(;u.length>0;){var e=JSON.stringify(u.shift());i.send(e)}}function n(){c||(c=retry.operation({minTimeout:2*RECONNECT_MIN_DELAY,retries:10,randomize:!0}),c.attempt(function(){i=new WebSocket(e),i.onopen=function(e){o(),s.emit("open",e)},i.onclose=function(e){if(e.code===CLOSE_NORMAL)return void s.emit("close",e);var t=new Error("WebSocket closed abnormally, code: "+e.code);console.warn(t),r(t)},i.onerror=function(e){s.emit("error",e)},i.onmessage=function(e){s.emit("message",e)}}))}function o(){c=null,t()}function r(e){if(c)return void(c.retry(e)||console.error("reached max retries attempting to reconnect websocket"));var t=RECONNECT_MIN_DELAY;t+=Math.floor(Math.random()*t),c=setTimeout(function(){c=null,n()},t)}var i,c,s=this,u=[];this.close=function(){i.close()},this.send=function(e){u.push(e),this.isConnected()&&t()},this.isConnected=function(){return i.readyState===WebSocket.OPEN},n()}var retry=require("retry"),EventEmitter=require("tiny-emitter"),inherits=require("inherits"),CLOSE_NORMAL=1e3,RECONNECT_MIN_DELAY=1e3;inherits(Socket,EventEmitter),module.exports=Socket;

},{"inherits":5,"retry":28,"tiny-emitter":36}]},{},[47])
//# sourceMappingURL=app.bundle.js.map
